{"version":3,"file":"jsmind.js","sources":["../src/jsmind.common.js","../src/jsmind.dom.js","../src/jsmind.util.js","../src/jsmind.option.js","../src/jsmind.node.js","../src/jsmind.mind.js","../src/jsmind.format.js","../src/jsmind.data_provider.js","../src/jsmind.layout_provider.js","../src/jsmind.graph.js","../src/jsmind.view_provider.js","../src/jsmind.shortcut_provider.js","../src/jsmind.plugin.js","../src/jsmind.js"],"sourcesContent":["/**\n * @license BSD\n * @copyright 2014-2022 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\n\nexport const __version__ = '0.5.0';\nexport const __author__ = 'hizzgdev@163.com';\n\nif (typeof String.prototype.startsWith != 'function') {\n    String.prototype.startsWith = function (p) {\n        return this.slice(0, p.length) === p;\n    };\n}\n\nexport const Direction = { left: -1, center: 0, right: 1 };\nexport const EventType = { show: 1, resize: 2, edit: 3, select: 4 };\nexport const Key = { meta: 1 << 13, ctrl: 1 << 12, alt: 1 << 11, shift: 1 << 10 };\nexport const LogLevel = { debug: 1, info: 2, warn: 3, error: 4, disable: 9 };\n\n// an noop function define\nvar _noop = function () {};\nexport let logger =\n    typeof console === 'undefined'\n        ? {\n              level: _noop,\n              log: _noop,\n              debug: _noop,\n              info: _noop,\n              warn: _noop,\n              error: _noop,\n          }\n        : {\n              level: setup_logger_level,\n              log: console.log,\n              debug: console.debug,\n              info: console.info,\n              warn: console.warn,\n              error: console.error,\n          };\n\nfunction setup_logger_level(log_level) {\n    if (log_level > LogLevel.debug) {\n        logger.debug = _noop;\n    } else {\n        logger.debug = console.debug;\n    }\n    if (log_level > LogLevel.info) {\n        logger.info = _noop;\n    } else {\n        logger.info = console.info;\n    }\n    if (log_level > LogLevel.warn) {\n        logger.warn = _noop;\n    } else {\n        logger.warn = console.warn;\n    }\n    if (log_level > LogLevel.error) {\n        logger.error = _noop;\n    } else {\n        logger.error = console.error;\n    }\n}\n","/**\n * @license BSD\n * @copyright 2014-2022 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\n\nclass Dom {\n    constructor(w) {\n        this.w = w;\n        this.d = w.document;\n        this.g = function (id) {\n            return this.d.getElementById(id);\n        };\n        this.c = function (tag) {\n            return this.d.createElement(tag);\n        };\n        this.t = function (n, t) {\n            if (n.hasChildNodes()) {\n                n.firstChild.nodeValue = t;\n            } else {\n                n.appendChild(this.d.createTextNode(t));\n            }\n        };\n\n        this.h = function (n, t) {\n            if (t instanceof HTMLElement) {\n                n.innerHTML = '';\n                n.appendChild(t);\n            } else {\n                n.innerHTML = t;\n            }\n        };\n        // detect isElement\n        this.i = function (el) {\n            return (\n                !!el &&\n                typeof el === 'object' &&\n                el.nodeType === 1 &&\n                typeof el.style === 'object' &&\n                typeof el.ownerDocument === 'object'\n            );\n        };\n\n        //target,eventType,handler\n        this.on = function (t, e, h) {\n            if (!!t.addEventListener) {\n                t.addEventListener(e, h, false);\n            } else {\n                t.attachEvent('on' + e, h);\n            }\n        };\n    }\n}\n\nexport const $ = new Dom(window);\n","/**\n * @license BSD\n * @copyright 2014-2022 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\n\nimport { $ } from './jsmind.dom.js';\nimport { logger } from './jsmind.common.js';\n\nexport const util = {\n    ajax: {\n        request: function (url, param, method, callback, fail_callback) {\n            var p = Object.keys(param)\n                .map(k => encodeURIComponent(k) + '=' + encodeURIComponent(param[k]))\n                .join('&');\n            var xhr = new XMLHttpRequest();\n            if (!xhr) {\n                return;\n            }\n            xhr.onreadystatechange = function () {\n                if (xhr.readyState == 4) {\n                    if (xhr.status == 200 || xhr.status == 0) {\n                        if (typeof callback === 'function') {\n                            var data = util.json.string2json(xhr.responseText);\n                            if (data != null) {\n                                callback(data);\n                            } else {\n                                callback(xhr.responseText);\n                            }\n                        }\n                    } else {\n                        if (typeof fail_callback === 'function') {\n                            fail_callback(xhr);\n                        } else {\n                            logger.error('xhr request failed.', xhr);\n                        }\n                    }\n                }\n            };\n            method = method || 'GET';\n            xhr.open(method, url, true);\n            xhr.setRequestHeader('If-Modified-Since', '0');\n            if (method == 'POST') {\n                xhr.setRequestHeader(\n                    'Content-Type',\n                    'application/x-www-form-urlencoded;charset=utf-8'\n                );\n                xhr.send(p);\n            } else {\n                xhr.send();\n            }\n        },\n        get: function (url, callback) {\n            return util.ajax.request(url, {}, 'GET', callback);\n        },\n        post: function (url, param, callback) {\n            return util.ajax.request(url, param, 'POST', callback);\n        },\n    },\n\n    file: {\n        read: function (file_data, fn_callback) {\n            var reader = new FileReader();\n            reader.onload = function () {\n                if (typeof fn_callback === 'function') {\n                    fn_callback(this.result, file_data.name);\n                }\n            };\n            reader.readAsText(file_data);\n        },\n\n        save: function (file_data, type, name) {\n            var blob;\n            if (typeof $.w.Blob === 'function') {\n                blob = new Blob([file_data], { type: type });\n            } else {\n                var BlobBuilder =\n                    $.w.BlobBuilder ||\n                    $.w.MozBlobBuilder ||\n                    $.w.WebKitBlobBuilder ||\n                    $.w.MSBlobBuilder;\n                var bb = new BlobBuilder();\n                bb.append(file_data);\n                blob = bb.getBlob(type);\n            }\n            if (navigator.msSaveBlob) {\n                navigator.msSaveBlob(blob, name);\n            } else {\n                var URL = $.w.URL || $.w.webkitURL;\n                var blob_url = URL.createObjectURL(blob);\n                var anchor = $.c('a');\n                if ('download' in anchor) {\n                    anchor.style.visibility = 'hidden';\n                    anchor.href = blob_url;\n                    anchor.download = name;\n                    $.d.body.appendChild(anchor);\n                    var evt = $.d.createEvent('MouseEvents');\n                    evt.initEvent('click', true, true);\n                    anchor.dispatchEvent(evt);\n                    $.d.body.removeChild(anchor);\n                } else {\n                    location.href = blob_url;\n                }\n            }\n        },\n    },\n\n    json: {\n        json2string: function (json) {\n            return JSON.stringify(json);\n        },\n        string2json: function (json_str) {\n            return JSON.parse(json_str);\n        },\n        merge: function (b, a) {\n            for (var o in a) {\n                if (o in b) {\n                    if (\n                        typeof b[o] === 'object' &&\n                        Object.prototype.toString.call(b[o]).toLowerCase() == '[object object]' &&\n                        !b[o].length\n                    ) {\n                        util.json.merge(b[o], a[o]);\n                    } else {\n                        b[o] = a[o];\n                    }\n                } else {\n                    b[o] = a[o];\n                }\n            }\n            return b;\n        },\n    },\n\n    uuid: {\n        newid: function () {\n            return (\n                new Date().getTime().toString(16) + Math.random().toString(16).substring(2)\n            ).substring(2, 18);\n        },\n    },\n\n    text: {\n        is_empty: function (s) {\n            if (!s) {\n                return true;\n            }\n            return s.replace(/\\s*/, '').length == 0;\n        },\n    },\n};\n","/**\n * @license BSD\n * @copyright 2014-2022 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\n\nimport { util } from './jsmind.util.js';\n\nconst default_options = {\n    container: '', // id of the container\n    editable: false, // you can change it in your options\n    theme: null,\n    mode: 'full', // full or side\n    support_html: true,\n    log_level: 'info',\n\n    view: {\n        engine: 'canvas',\n        hmargin: 100,\n        vmargin: 50,\n        line_width: 2,\n        line_color: '#555',\n        draggable: false, // drag the mind map with your mouse, when it's larger that the container\n        hide_scrollbars_when_draggable: false, // hide container scrollbars, when mind map is larger than container and draggable option is true.\n    },\n    layout: {\n        hspace: 30,\n        vspace: 20,\n        pspace: 13,\n    },\n    default_event_handle: {\n        enable_mousedown_handle: true,\n        enable_click_handle: true,\n        enable_dblclick_handle: true,\n        enable_mousewheel_handle: true,\n    },\n    shortcut: {\n        enable: true,\n        handles: {},\n        mapping: {\n            addchild: [45, 4096 + 13], // Insert, Ctrl+Enter\n            addbrother: 13, // Enter\n            editnode: 113, // F2\n            delnode: 46, // Delete\n            toggle: 32, // Space\n            left: 37, // Left\n            up: 38, // Up\n            right: 39, // Right\n            down: 40, // Down\n        },\n    },\n};\n\nexport function merge_option(options) {\n    var opts = {};\n    util.json.merge(opts, default_options);\n    util.json.merge(opts, options);\n\n    if (!opts.container) {\n        throw new Error('the options.container should not be null or empty.');\n    }\n    return opts;\n}\n","/**\n * @license BSD\n * @copyright 2014-2022 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\n\nimport { logger } from './jsmind.common.js';\nexport class Node {\n    constructor(sId, iIndex, sTopic, oData, bIsRoot, oParent, eDirection, bExpanded) {\n        if (!sId) {\n            logger.error('invalid node id');\n            return;\n        }\n        if (typeof iIndex != 'number') {\n            logger.error('invalid node index');\n            return;\n        }\n        if (typeof bExpanded === 'undefined') {\n            bExpanded = true;\n        }\n        this.id = sId;\n        this.index = iIndex;\n        this.topic = sTopic;\n        this.data = oData || {};\n        this.isroot = bIsRoot;\n        this.parent = oParent;\n        this.direction = eDirection;\n        this.expanded = !!bExpanded;\n        this.children = [];\n        this._data = {};\n    }\n\n    get_location() {\n        var vd = this._data.view;\n        return {\n            x: vd.abs_x,\n            y: vd.abs_y,\n        };\n    }\n    get_size() {\n        var vd = this._data.view;\n        return {\n            w: vd.width,\n            h: vd.height,\n        };\n    }\n\n    static compare(node1, node2) {\n        // '-1' is always the latest\n        var r = 0;\n        var i1 = node1.index;\n        var i2 = node2.index;\n        if (i1 >= 0 && i2 >= 0) {\n            r = i1 - i2;\n        } else if (i1 == -1 && i2 == -1) {\n            r = 0;\n        } else if (i1 == -1) {\n            r = 1;\n        } else if (i2 == -1) {\n            r = -1;\n        } else {\n            r = 0;\n        }\n        return r;\n    }\n    static inherited(parent_node, node) {\n        if (!!parent_node && !!node) {\n            if (parent_node.id === node.id) {\n                return true;\n            }\n            if (parent_node.isroot) {\n                return true;\n            }\n            var pid = parent_node.id;\n            var p = node;\n            while (!p.isroot) {\n                p = p.parent;\n                if (p.id === pid) {\n                    return true;\n                }\n            }\n        }\n        return false;\n    }\n    static is_node(n) {\n        return !!n && n instanceof Node;\n    }\n}\n","/**\n * @license BSD\n * @copyright 2014-2022 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\n\nimport { Node } from './jsmind.node.js';\nimport { logger, Direction } from './jsmind.common.js';\n\nexport class Mind {\n    constructor() {\n        this.name = null;\n        this.author = null;\n        this.version = null;\n        this.root = null;\n        this.selected = null;\n        this.nodes = {};\n    }\n    get_node(node_id) {\n        if (node_id in this.nodes) {\n            return this.nodes[node_id];\n        } else {\n            logger.warn('the node[id=' + node_id + '] can not be found');\n            return null;\n        }\n    }\n    set_root(node_id, topic, data) {\n        if (this.root == null) {\n            this.root = new Node(node_id, 0, topic, data, true);\n            this._put_node(this.root);\n            return this.root;\n        } else {\n            logger.error('root node is already exist');\n            return null;\n        }\n    }\n    add_node(parent_node, node_id, topic, data, direction, expanded, idx) {\n        if (!Node.is_node(parent_node)) {\n            logger.error('the parent_node ' + parent_node + ' is not a node.');\n            return null;\n        }\n        var node_index = idx || -1;\n        var node = new Node(\n            node_id,\n            node_index,\n            topic,\n            data,\n            false,\n            parent_node,\n            parent_node.direction,\n            expanded\n        );\n        if (parent_node.isroot) {\n            node.direction = direction || Direction.right;\n        }\n        if (this._put_node(node)) {\n            parent_node.children.push(node);\n            this._update_index(parent_node);\n        } else {\n            logger.error(\"fail, the node id '\" + node.id + \"' has been already exist.\");\n            node = null;\n        }\n        return node;\n    }\n    insert_node_before(node_before, node_id, topic, data, direction) {\n        if (!Node.is_node(node_before)) {\n            logger.error('the node_before ' + node_before + ' is not a node.');\n            return null;\n        }\n        var node_index = node_before.index - 0.5;\n        return this.add_node(node_before.parent, node_id, topic, data, direction, true, node_index);\n    }\n    get_node_before(node) {\n        if (!Node.is_node(node)) {\n            var the_node = this.get_node(node);\n            if (!the_node) {\n                logger.error('the node[id=' + node + '] can not be found.');\n                return null;\n            } else {\n                return this.get_node_before(the_node);\n            }\n        }\n        if (node.isroot) {\n            return null;\n        }\n        var idx = node.index - 2;\n        if (idx >= 0) {\n            return node.parent.children[idx];\n        } else {\n            return null;\n        }\n    }\n    insert_node_after(node_after, node_id, topic, data, direction) {\n        if (!Node.is_node(node_after)) {\n            logger.error('the node_after ' + node_after + ' is not a node.');\n            return null;\n        }\n        var node_index = node_after.index + 0.5;\n        return this.add_node(node_after.parent, node_id, topic, data, direction, true, node_index);\n    }\n    get_node_after(node) {\n        if (!Node.is_node(node)) {\n            var the_node = this.get_node(node);\n            if (!the_node) {\n                logger.error('the node[id=' + node + '] can not be found.');\n                return null;\n            } else {\n                return this.get_node_after(the_node);\n            }\n        }\n        if (node.isroot) {\n            return null;\n        }\n        var idx = node.index;\n        var brothers = node.parent.children;\n        if (brothers.length > idx) {\n            return node.parent.children[idx];\n        } else {\n            return null;\n        }\n    }\n    move_node(node, before_id, parent_id, direction) {\n        if (!Node.is_node(node)) {\n            logger.error('the parameter node ' + node + ' is not a node.');\n            return null;\n        }\n        if (!parent_id) {\n            parent_id = node.parent.id;\n        }\n        return this._move_node(node, before_id, parent_id, direction);\n    }\n    _flow_node_direction(node, direction) {\n        if (typeof direction === 'undefined') {\n            direction = node.direction;\n        } else {\n            node.direction = direction;\n        }\n        var len = node.children.length;\n        while (len--) {\n            this._flow_node_direction(node.children[len], direction);\n        }\n    }\n    _move_node_internal(node, before_id) {\n        if (!!node && !!before_id) {\n            if (before_id == '_last_') {\n                node.index = -1;\n                this._update_index(node.parent);\n            } else if (before_id == '_first_') {\n                node.index = 0;\n                this._update_index(node.parent);\n            } else {\n                var node_before = !!before_id ? this.get_node(before_id) : null;\n                if (\n                    node_before != null &&\n                    node_before.parent != null &&\n                    node_before.parent.id == node.parent.id\n                ) {\n                    node.index = node_before.index - 0.5;\n                    this._update_index(node.parent);\n                }\n            }\n        }\n        return node;\n    }\n    _move_node(node, before_id, parent_id, direction) {\n        if (!!node && !!parent_id) {\n            var parent_node = this.get_node(parent_id);\n            if (Node.inherited(node, parent_node)) {\n                logger.error('can not move a node to its children');\n                return null;\n            }\n            if (node.parent.id != parent_id) {\n                // remove from parent's children\n                var sibling = node.parent.children;\n                var si = sibling.length;\n                while (si--) {\n                    if (sibling[si].id == node.id) {\n                        sibling.splice(si, 1);\n                        break;\n                    }\n                }\n                node.parent = parent_node;\n                parent_node.children.push(node);\n            }\n\n            if (node.parent.isroot) {\n                if (direction == Direction.left) {\n                    node.direction = direction;\n                } else {\n                    node.direction = Direction.right;\n                }\n            } else {\n                node.direction = node.parent.direction;\n            }\n            this._move_node_internal(node, before_id);\n            this._flow_node_direction(node);\n        }\n        return node;\n    }\n    remove_node(node) {\n        if (!Node.is_node(node)) {\n            logger.error('the parameter node ' + node + ' is not a node.');\n            return false;\n        }\n        if (node.isroot) {\n            logger.error('fail, can not remove root node');\n            return false;\n        }\n        if (this.selected != null && this.selected.id == node.id) {\n            this.selected = null;\n        }\n        // clean all subordinate nodes\n        var children = node.children;\n        var ci = children.length;\n        while (ci--) {\n            this.remove_node(children[ci]);\n        }\n        // clean all children\n        children.length = 0;\n        // remove from parent's children\n        var sibling = node.parent.children;\n        var si = sibling.length;\n        while (si--) {\n            if (sibling[si].id == node.id) {\n                sibling.splice(si, 1);\n                break;\n            }\n        }\n        // remove from global nodes\n        delete this.nodes[node.id];\n        // clean all properties\n        for (var k in node) {\n            delete node[k];\n        }\n        // remove it's self\n        node = null;\n        //delete node;\n        return true;\n    }\n    _put_node(node) {\n        if (node.id in this.nodes) {\n            logger.warn(\"the node_id '\" + node.id + \"' has been already exist.\");\n            return false;\n        } else {\n            this.nodes[node.id] = node;\n            return true;\n        }\n    }\n    _update_index(node) {\n        if (node instanceof Node) {\n            node.children.sort(Node.compare);\n            for (var i = 0; i < node.children.length; i++) {\n                node.children[i].index = i + 1;\n            }\n        }\n    }\n}\n","/**\n * @license BSD\n * @copyright 2014-2022 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\n\nimport { __author__, __version__, logger, Direction } from './jsmind.common.js';\nimport { Mind } from './jsmind.mind.js';\nimport { Node } from './jsmind.node.js';\nimport { util } from './jsmind.util.js';\n\nexport const format = {\n    node_tree: {\n        example: {\n            meta: {\n                name: 'jsMind node_tree simple',\n                author: __author__,\n                version: __version__,\n            },\n            format: 'node_tree',\n            data: { id: 'root', topic: 'jsMind Example' },\n        },\n        get_mind: function (source) {\n            var df = format.node_tree;\n            var mind = new Mind();\n            mind.name = source.meta.name;\n            mind.author = source.meta.author;\n            mind.version = source.meta.version;\n            df._parse(mind, source.data);\n            return mind;\n        },\n        get_data: function (mind) {\n            var df = format.node_tree;\n            var json = {};\n            json.meta = {\n                name: mind.name,\n                author: mind.author,\n                version: mind.version,\n            };\n            json.format = 'node_tree';\n            json.data = df._build_node(mind.root);\n            return json;\n        },\n\n        _parse: function (mind, node_root) {\n            var df = format.node_tree;\n            var data = df._extract_data(node_root);\n            mind.set_root(node_root.id, node_root.topic, data);\n            if ('children' in node_root) {\n                var children = node_root.children;\n                for (var i = 0; i < children.length; i++) {\n                    df._extract_subnode(mind, mind.root, children[i]);\n                }\n            }\n        },\n\n        _extract_data: function (node_json) {\n            var data = {};\n            for (var k in node_json) {\n                if (\n                    k == 'id' ||\n                    k == 'topic' ||\n                    k == 'children' ||\n                    k == 'direction' ||\n                    k == 'expanded'\n                ) {\n                    continue;\n                }\n                data[k] = node_json[k];\n            }\n            return data;\n        },\n\n        _extract_subnode: function (mind, node_parent, node_json) {\n            var df = format.node_tree;\n            var data = df._extract_data(node_json);\n            var d = null;\n            if (node_parent.isroot) {\n                d = node_json.direction == 'left' ? Direction.left : Direction.right;\n            }\n            var node = mind.add_node(\n                node_parent,\n                node_json.id,\n                node_json.topic,\n                data,\n                d,\n                node_json.expanded\n            );\n            if (!!node_json['children']) {\n                var children = node_json.children;\n                for (var i = 0; i < children.length; i++) {\n                    df._extract_subnode(mind, node, children[i]);\n                }\n            }\n        },\n\n        _build_node: function (node) {\n            var df = format.node_tree;\n            if (!(node instanceof Node)) {\n                return;\n            }\n            var o = {\n                id: node.id,\n                topic: node.topic,\n                expanded: node.expanded,\n            };\n            if (!!node.parent && node.parent.isroot) {\n                o.direction = node.direction == Direction.left ? 'left' : 'right';\n            }\n            if (node.data != null) {\n                var node_data = node.data;\n                for (var k in node_data) {\n                    o[k] = node_data[k];\n                }\n            }\n            var children = node.children;\n            if (children.length > 0) {\n                o.children = [];\n                for (var i = 0; i < children.length; i++) {\n                    o.children.push(df._build_node(children[i]));\n                }\n            }\n            return o;\n        },\n    },\n\n    node_array: {\n        example: {\n            meta: {\n                name: 'jsMind node_array simple',\n                author: __author__,\n                version: __version__,\n            },\n            format: 'node_array',\n            data: [{ id: 'root', topic: 'jsMind Example', isroot: true }],\n        },\n\n        get_mind: function (source) {\n            var df = format.node_array;\n            var mind = new Mind();\n            mind.name = source.meta.name;\n            mind.author = source.meta.author;\n            mind.version = source.meta.version;\n            df._parse(mind, source.data);\n            return mind;\n        },\n\n        get_data: function (mind) {\n            var df = format.node_array;\n            var json = {};\n            json.meta = {\n                name: mind.name,\n                author: mind.author,\n                version: mind.version,\n            };\n            json.format = 'node_array';\n            json.data = [];\n            df._array(mind, json.data);\n            return json;\n        },\n\n        _parse: function (mind, node_array) {\n            var df = format.node_array;\n            var nodes = node_array.slice(0);\n            // reverse array for improving looping performance\n            nodes.reverse();\n            var root_node = df._extract_root(mind, nodes);\n            if (!!root_node) {\n                df._extract_subnode(mind, root_node, nodes);\n            } else {\n                logger.error('root node can not be found');\n            }\n        },\n\n        _extract_root: function (mind, node_array) {\n            var df = format.node_array;\n            var i = node_array.length;\n            while (i--) {\n                if ('isroot' in node_array[i] && node_array[i].isroot) {\n                    var root_json = node_array[i];\n                    var data = df._extract_data(root_json);\n                    var node = mind.set_root(root_json.id, root_json.topic, data);\n                    node_array.splice(i, 1);\n                    return node;\n                }\n            }\n            return null;\n        },\n\n        _extract_subnode: function (mind, parent_node, node_array) {\n            var df = format.node_array;\n            var i = node_array.length;\n            var node_json = null;\n            var data = null;\n            var extract_count = 0;\n            while (i--) {\n                node_json = node_array[i];\n                if (node_json.parentid == parent_node.id) {\n                    data = df._extract_data(node_json);\n                    var d = null;\n                    var node_direction = node_json.direction;\n                    if (!!node_direction) {\n                        d = node_direction == 'left' ? Direction.left : Direction.right;\n                    }\n                    var node = mind.add_node(\n                        parent_node,\n                        node_json.id,\n                        node_json.topic,\n                        data,\n                        d,\n                        node_json.expanded\n                    );\n                    node_array.splice(i, 1);\n                    extract_count++;\n                    var sub_extract_count = df._extract_subnode(mind, node, node_array);\n                    if (sub_extract_count > 0) {\n                        // reset loop index after extract subordinate node\n                        i = node_array.length;\n                        extract_count += sub_extract_count;\n                    }\n                }\n            }\n            return extract_count;\n        },\n\n        _extract_data: function (node_json) {\n            var data = {};\n            for (var k in node_json) {\n                if (\n                    k == 'id' ||\n                    k == 'topic' ||\n                    k == 'parentid' ||\n                    k == 'isroot' ||\n                    k == 'direction' ||\n                    k == 'expanded'\n                ) {\n                    continue;\n                }\n                data[k] = node_json[k];\n            }\n            return data;\n        },\n\n        _array: function (mind, node_array) {\n            var df = format.node_array;\n            df._array_node(mind.root, node_array);\n        },\n\n        _array_node: function (node, node_array) {\n            var df = format.node_array;\n            if (!(node instanceof Node)) {\n                return;\n            }\n            var o = {\n                id: node.id,\n                topic: node.topic,\n                expanded: node.expanded,\n            };\n            if (!!node.parent) {\n                o.parentid = node.parent.id;\n            }\n            if (node.isroot) {\n                o.isroot = true;\n            }\n            if (!!node.parent && node.parent.isroot) {\n                o.direction = node.direction == Direction.left ? 'left' : 'right';\n            }\n            if (node.data != null) {\n                var node_data = node.data;\n                for (var k in node_data) {\n                    o[k] = node_data[k];\n                }\n            }\n            node_array.push(o);\n            var ci = node.children.length;\n            for (var i = 0; i < ci; i++) {\n                df._array_node(node.children[i], node_array);\n            }\n        },\n    },\n\n    freemind: {\n        example: {\n            meta: {\n                name: 'jsMind freemind example',\n                author: __author__,\n                version: __version__,\n            },\n            format: 'freemind',\n            data: '<map version=\"1.0.1\"><node ID=\"root\" TEXT=\"freemind Example\"/></map>',\n        },\n        get_mind: function (source) {\n            var df = format.freemind;\n            var mind = new Mind();\n            mind.name = source.meta.name;\n            mind.author = source.meta.author;\n            mind.version = source.meta.version;\n            var xml = source.data;\n            var xml_doc = df._parse_xml(xml);\n            var xml_root = df._find_root(xml_doc);\n            df._load_node(mind, null, xml_root);\n            return mind;\n        },\n\n        get_data: function (mind) {\n            var df = format.freemind;\n            var json = {};\n            json.meta = {\n                name: mind.name,\n                author: mind.author,\n                version: mind.version,\n            };\n            json.format = 'freemind';\n            var xml_lines = [];\n            xml_lines.push('<map version=\"1.0.1\">');\n            df._build_map(mind.root, xml_lines);\n            xml_lines.push('</map>');\n            json.data = xml_lines.join(' ');\n            return json;\n        },\n\n        _parse_xml: function (xml) {\n            var xml_doc = null;\n            if (window.DOMParser) {\n                var parser = new DOMParser();\n                xml_doc = parser.parseFromString(xml, 'text/xml');\n            } else {\n                // Internet Explorer\n                xml_doc = new ActiveXObject('Microsoft.XMLDOM');\n                xml_doc.async = false;\n                xml_doc.loadXML(xml);\n            }\n            return xml_doc;\n        },\n\n        _find_root: function (xml_doc) {\n            var nodes = xml_doc.childNodes;\n            var node = null;\n            var root = null;\n            var n = null;\n            for (var i = 0; i < nodes.length; i++) {\n                n = nodes[i];\n                if (n.nodeType == 1 && n.tagName == 'map') {\n                    node = n;\n                    break;\n                }\n            }\n            if (!!node) {\n                var ns = node.childNodes;\n                node = null;\n                for (var i = 0; i < ns.length; i++) {\n                    n = ns[i];\n                    if (n.nodeType == 1 && n.tagName == 'node') {\n                        node = n;\n                        break;\n                    }\n                }\n            }\n            return node;\n        },\n\n        _load_node: function (mind, parent_node, xml_node) {\n            var df = format.freemind;\n            var node_id = xml_node.getAttribute('ID');\n            var node_topic = xml_node.getAttribute('TEXT');\n            // look for richcontent\n            if (node_topic == null) {\n                var topic_children = xml_node.childNodes;\n                var topic_child = null;\n                for (var i = 0; i < topic_children.length; i++) {\n                    topic_child = topic_children[i];\n                    if (topic_child.nodeType == 1 && topic_child.tagName === 'richcontent') {\n                        node_topic = topic_child.textContent;\n                        break;\n                    }\n                }\n            }\n            var node_data = df._load_attributes(xml_node);\n            var node_expanded = 'expanded' in node_data ? node_data.expanded == 'true' : true;\n            delete node_data.expanded;\n\n            var node_position = xml_node.getAttribute('POSITION');\n            var node_direction = null;\n            if (!!node_position) {\n                node_direction = node_position == 'left' ? Direction.left : Direction.right;\n            }\n            var node = null;\n            if (!!parent_node) {\n                node = mind.add_node(\n                    parent_node,\n                    node_id,\n                    node_topic,\n                    node_data,\n                    node_direction,\n                    node_expanded\n                );\n            } else {\n                node = mind.set_root(node_id, node_topic, node_data);\n            }\n            var children = xml_node.childNodes;\n            var child = null;\n            for (var i = 0; i < children.length; i++) {\n                child = children[i];\n                if (child.nodeType == 1 && child.tagName == 'node') {\n                    df._load_node(mind, node, child);\n                }\n            }\n        },\n\n        _load_attributes: function (xml_node) {\n            var children = xml_node.childNodes;\n            var attr = null;\n            var attr_data = {};\n            for (var i = 0; i < children.length; i++) {\n                attr = children[i];\n                if (attr.nodeType == 1 && attr.tagName === 'attribute') {\n                    attr_data[attr.getAttribute('NAME')] = attr.getAttribute('VALUE');\n                }\n            }\n            return attr_data;\n        },\n\n        _build_map: function (node, xml_lines) {\n            var df = format.freemind;\n            var pos = null;\n            if (!!node.parent && node.parent.isroot) {\n                pos = node.direction === Direction.left ? 'left' : 'right';\n            }\n            xml_lines.push('<node');\n            xml_lines.push('ID=\"' + node.id + '\"');\n            if (!!pos) {\n                xml_lines.push('POSITION=\"' + pos + '\"');\n            }\n            xml_lines.push('TEXT=\"' + node.topic + '\">');\n\n            // store expanded status as an attribute\n            xml_lines.push('<attribute NAME=\"expanded\" VALUE=\"' + node.expanded + '\"/>');\n\n            // for attributes\n            var node_data = node.data;\n            if (node_data != null) {\n                for (var k in node_data) {\n                    xml_lines.push('<attribute NAME=\"' + k + '\" VALUE=\"' + node_data[k] + '\"/>');\n                }\n            }\n\n            // for children\n            var children = node.children;\n            for (var i = 0; i < children.length; i++) {\n                df._build_map(children[i], xml_lines);\n            }\n\n            xml_lines.push('</node>');\n        },\n    },\n    text: {\n        example: {\n            meta: {\n                name: 'jsMind text example',\n                author: __author__,\n                version: __version__,\n            },\n            format: 'text',\n            data: 'Text Example\\n node1\\n  node1-sub\\n  node1-sub\\n node2',\n        },\n        _line_regex: /\\s*/,\n        get_mind: function (source) {\n            var df = format.text;\n            var mind = new Mind();\n            mind.name = source.meta.name;\n            mind.author = source.meta.author;\n            mind.version = source.meta.version;\n            var lines = source.data.split(/\\n|\\r/);\n            df._fill_nodes(mind, lines, 0, 0);\n            return mind;\n        },\n\n        _fill_nodes: function (mind, lines) {\n            let node_path = [];\n            let i = 0;\n            while (i < lines.length) {\n                let line = lines[i];\n                let level = line.match(/\\s*/)[0].length;\n                let topic = line.substr(level);\n\n                if (level == 0 && node_path.length > 0) {\n                    log.error('more than 1 root node was found: ' + topic);\n                    return;\n                }\n                if (level > node_path.length) {\n                    log.error('a suspended node was found: ' + topic);\n                    return;\n                }\n                let diff = node_path.length - level;\n                while (diff--) {\n                    node_path.pop();\n                }\n\n                if (level == 0 && node_path.length == 0) {\n                    let node = mind.set_root(util.uuid.newid(), topic);\n                    node_path.push(node);\n                } else {\n                    let node = mind.add_node(\n                        node_path[level - 1],\n                        util.uuid.newid(),\n                        topic,\n                        {},\n                        null\n                    );\n                    node_path.push(node);\n                }\n                i++;\n            }\n            node_path.length = 0;\n        },\n\n        get_data: function (mind) {\n            var df = format.text;\n            var json = {};\n            json.meta = {\n                name: mind.name,\n                author: mind.author,\n                version: mind.version,\n            };\n            json.format = 'text';\n            let lines = [];\n            df._build_lines(lines, [mind.root], 0);\n            json.data = lines.join('\\n');\n            return json;\n        },\n\n        _build_lines: function (lines, nodes, level) {\n            let prefix = new Array(level + 1).join(' ');\n            for (let node of nodes) {\n                lines.push(prefix + node.topic);\n                if (!!node.children) {\n                    format.text._build_lines(lines, node.children, level + 1);\n                }\n            }\n        },\n    },\n};\n","/**\n * @license BSD\n * @copyright 2014-2022 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\n\nimport { logger } from './jsmind.common.js';\nimport { format } from './jsmind.format.js';\n\nexport class DataProvider {\n    constructor(jm) {\n        this.jm = jm;\n    }\n\n    init() {\n        logger.debug('data.init');\n    }\n    reset() {\n        logger.debug('data.reset');\n    }\n    load(mind_data) {\n        var df = null;\n        var mind = null;\n        if (typeof mind_data === 'object') {\n            if (!!mind_data.format) {\n                df = mind_data.format;\n            } else {\n                df = 'node_tree';\n            }\n        } else {\n            df = 'freemind';\n        }\n\n        if (df == 'node_array') {\n            mind = format.node_array.get_mind(mind_data);\n        } else if (df == 'node_tree') {\n            mind = format.node_tree.get_mind(mind_data);\n        } else if (df == 'freemind') {\n            mind = format.freemind.get_mind(mind_data);\n        } else if (df == 'text') {\n            mind = format.text.get_mind(mind_data);\n        } else {\n            logger.warn('unsupported format');\n        }\n        return mind;\n    }\n    get_data(data_format) {\n        var data = null;\n        if (data_format == 'node_array') {\n            data = format.node_array.get_data(this.jm.mind);\n        } else if (data_format == 'node_tree') {\n            data = format.node_tree.get_data(this.jm.mind);\n        } else if (data_format == 'freemind') {\n            data = format.freemind.get_data(this.jm.mind);\n        } else if (data_format == 'text') {\n            data = format.text.get_data(this.jm.mind);\n        } else {\n            logger.error('unsupported ' + data_format + ' format');\n        }\n        return data;\n    }\n}\n","/**\n * @license BSD\n * @copyright 2014-2022 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\nimport { logger, Direction, EventType } from './jsmind.common.js';\n\nexport class LayoutProvider {\n    constructor(jm, options) {\n        this.opts = options;\n        this.jm = jm;\n        this.isside = this.opts.mode == 'side';\n        this.bounds = null;\n\n        this.cache_valid = false;\n    }\n    init() {\n        logger.debug('layout.init');\n    }\n    reset() {\n        logger.debug('layout.reset');\n        this.bounds = { n: 0, s: 0, w: 0, e: 0 };\n    }\n    calculate_next_child_direction(node) {\n        if (this.isside) {\n            return Direction.right;\n        }\n        var children = node.children || [];\n        var children_len = children.length;\n        var r = 0;\n        for (var i = 0; i < children_len; i++) {\n            if (children[i].direction === Direction.left) {\n                r--;\n            } else {\n                r++;\n            }\n        }\n        return children_len > 1 && r > 0 ? Direction.left : Direction.right;\n    }\n    layout() {\n        logger.debug('layout.layout');\n        this.layout_direction();\n        this.layout_offset();\n    }\n    layout_direction() {\n        this._layout_direction_root();\n    }\n    _layout_direction_root() {\n        var node = this.jm.mind.root;\n        var layout_data = null;\n        if ('layout' in node._data) {\n            layout_data = node._data.layout;\n        } else {\n            layout_data = {};\n            node._data.layout = layout_data;\n        }\n        var children = node.children;\n        var children_count = children.length;\n        layout_data.direction = Direction.center;\n        layout_data.side_index = 0;\n        if (this.isside) {\n            var i = children_count;\n            while (i--) {\n                this._layout_direction_side(children[i], Direction.right, i);\n            }\n        } else {\n            var i = children_count;\n            var subnode = null;\n            while (i--) {\n                subnode = children[i];\n                if (subnode.direction == Direction.left) {\n                    this._layout_direction_side(subnode, Direction.left, i);\n                } else {\n                    this._layout_direction_side(subnode, Direction.right, i);\n                }\n            }\n        }\n    }\n    _layout_direction_side(node, direction, side_index) {\n        var layout_data = null;\n        if ('layout' in node._data) {\n            layout_data = node._data.layout;\n        } else {\n            layout_data = {};\n            node._data.layout = layout_data;\n        }\n        var children = node.children;\n        var children_count = children.length;\n\n        layout_data.direction = direction;\n        layout_data.side_index = side_index;\n        var i = children_count;\n        while (i--) {\n            this._layout_direction_side(children[i], direction, i);\n        }\n    }\n    layout_offset() {\n        var node = this.jm.mind.root;\n        var layout_data = node._data.layout;\n        layout_data.offset_x = 0;\n        layout_data.offset_y = 0;\n        layout_data.outer_height = 0;\n        var children = node.children;\n        var i = children.length;\n        var left_nodes = [];\n        var right_nodes = [];\n        var subnode = null;\n        while (i--) {\n            subnode = children[i];\n            if (subnode._data.layout.direction == Direction.right) {\n                right_nodes.unshift(subnode);\n            } else {\n                left_nodes.unshift(subnode);\n            }\n        }\n        layout_data.left_nodes = left_nodes;\n        layout_data.right_nodes = right_nodes;\n        layout_data.outer_height_left = this._layout_offset_subnodes(left_nodes);\n        layout_data.outer_height_right = this._layout_offset_subnodes(right_nodes);\n        this.bounds.e = node._data.view.width / 2;\n        this.bounds.w = 0 - this.bounds.e;\n        this.bounds.n = 0;\n        this.bounds.s = Math.max(layout_data.outer_height_left, layout_data.outer_height_right);\n    }\n    // layout both the x and y axis\n    _layout_offset_subnodes(nodes) {\n        var total_height = 0;\n        var nodes_count = nodes.length;\n        var i = nodes_count;\n        var node = null;\n        var node_outer_height = 0;\n        var layout_data = null;\n        var base_y = 0;\n        var pd = null; // parent._data\n        while (i--) {\n            node = nodes[i];\n            layout_data = node._data.layout;\n            if (pd == null) {\n                pd = node.parent._data;\n            }\n\n            node_outer_height = this._layout_offset_subnodes(node.children);\n            if (!node.expanded) {\n                node_outer_height = 0;\n                this.set_visible(node.children, false);\n            }\n            node_outer_height = Math.max(node._data.view.height, node_outer_height);\n\n            layout_data.outer_height = node_outer_height;\n            layout_data.offset_y = base_y - node_outer_height / 2;\n            layout_data.offset_x =\n                this.opts.hspace * layout_data.direction +\n                (pd.view.width * (pd.layout.direction + layout_data.direction)) / 2;\n            if (!node.parent.isroot) {\n                layout_data.offset_x += this.opts.pspace * layout_data.direction;\n            }\n\n            base_y = base_y - node_outer_height - this.opts.vspace;\n            total_height += node_outer_height;\n        }\n        if (nodes_count > 1) {\n            total_height += this.opts.vspace * (nodes_count - 1);\n        }\n        i = nodes_count;\n        var middle_height = total_height / 2;\n        while (i--) {\n            node = nodes[i];\n            node._data.layout.offset_y += middle_height;\n        }\n        return total_height;\n    }\n    // layout the y axis only, for collapse/expand a node\n    _layout_offset_subnodes_height(nodes) {\n        var total_height = 0;\n        var nodes_count = nodes.length;\n        var i = nodes_count;\n        var node = null;\n        var node_outer_height = 0;\n        var layout_data = null;\n        var base_y = 0;\n        var pd = null; // parent._data\n        while (i--) {\n            node = nodes[i];\n            layout_data = node._data.layout;\n            if (pd == null) {\n                pd = node.parent._data;\n            }\n\n            node_outer_height = this._layout_offset_subnodes_height(node.children);\n            if (!node.expanded) {\n                node_outer_height = 0;\n            }\n            node_outer_height = Math.max(node._data.view.height, node_outer_height);\n\n            layout_data.outer_height = node_outer_height;\n            layout_data.offset_y = base_y - node_outer_height / 2;\n            base_y = base_y - node_outer_height - this.opts.vspace;\n            total_height += node_outer_height;\n        }\n        if (nodes_count > 1) {\n            total_height += this.opts.vspace * (nodes_count - 1);\n        }\n        i = nodes_count;\n        var middle_height = total_height / 2;\n        while (i--) {\n            node = nodes[i];\n            node._data.layout.offset_y += middle_height;\n        }\n        return total_height;\n    }\n    get_node_offset(node) {\n        var layout_data = node._data.layout;\n        var offset_cache = null;\n        if ('_offset_' in layout_data && this.cache_valid) {\n            offset_cache = layout_data._offset_;\n        } else {\n            offset_cache = { x: -1, y: -1 };\n            layout_data._offset_ = offset_cache;\n        }\n        if (offset_cache.x == -1 || offset_cache.y == -1) {\n            var x = layout_data.offset_x;\n            var y = layout_data.offset_y;\n            if (!node.isroot) {\n                var offset_p = this.get_node_offset(node.parent);\n                x += offset_p.x;\n                y += offset_p.y;\n            }\n            offset_cache.x = x;\n            offset_cache.y = y;\n        }\n        return offset_cache;\n    }\n    get_node_point(node) {\n        var view_data = node._data.view;\n        var offset_p = this.get_node_offset(node);\n        var p = {};\n        p.x = offset_p.x + (view_data.width * (node._data.layout.direction - 1)) / 2;\n        p.y = offset_p.y - view_data.height / 2;\n        return p;\n    }\n    get_node_point_in(node) {\n        var p = this.get_node_offset(node);\n        return p;\n    }\n    get_node_point_out(node) {\n        var layout_data = node._data.layout;\n        var pout_cache = null;\n        if ('_pout_' in layout_data && this.cache_valid) {\n            pout_cache = layout_data._pout_;\n        } else {\n            pout_cache = { x: -1, y: -1 };\n            layout_data._pout_ = pout_cache;\n        }\n        if (pout_cache.x == -1 || pout_cache.y == -1) {\n            if (node.isroot) {\n                pout_cache.x = 0;\n                pout_cache.y = 0;\n            } else {\n                var view_data = node._data.view;\n                var offset_p = this.get_node_offset(node);\n                pout_cache.x =\n                    offset_p.x + (view_data.width + this.opts.pspace) * node._data.layout.direction;\n                pout_cache.y = offset_p.y;\n            }\n        }\n        return pout_cache;\n    }\n    get_expander_point(node) {\n        var p = this.get_node_point_out(node);\n        var ex_p = {};\n        if (node._data.layout.direction == Direction.right) {\n            ex_p.x = p.x - this.opts.pspace;\n        } else {\n            ex_p.x = p.x;\n        }\n        ex_p.y = p.y - Math.ceil(this.opts.pspace / 2);\n        return ex_p;\n    }\n    get_min_size() {\n        var nodes = this.jm.mind.nodes;\n        var node = null;\n        var pout = null;\n        for (var node_id in nodes) {\n            node = nodes[node_id];\n            pout = this.get_node_point_out(node);\n            if (pout.x > this.bounds.e) {\n                this.bounds.e = pout.x;\n            }\n            if (pout.x < this.bounds.w) {\n                this.bounds.w = pout.x;\n            }\n        }\n        return {\n            w: this.bounds.e - this.bounds.w,\n            h: this.bounds.s - this.bounds.n,\n        };\n    }\n    toggle_node(node) {\n        if (node.isroot) {\n            return;\n        }\n        if (node.expanded) {\n            this.collapse_node(node);\n        } else {\n            this.expand_node(node);\n        }\n    }\n    expand_node(node) {\n        node.expanded = true;\n        this.part_layout(node);\n        this.set_visible(node.children, true);\n        this.jm.invoke_event_handle(EventType.show, {\n            evt: 'expand_node',\n            data: [],\n            node: node.id,\n        });\n    }\n    collapse_node(node) {\n        node.expanded = false;\n        this.part_layout(node);\n        this.set_visible(node.children, false);\n        this.jm.invoke_event_handle(EventType.show, {\n            evt: 'collapse_node',\n            data: [],\n            node: node.id,\n        });\n    }\n    expand_all() {\n        var nodes = this.jm.mind.nodes;\n        var c = 0;\n        var node;\n        for (var node_id in nodes) {\n            node = nodes[node_id];\n            if (!node.expanded) {\n                node.expanded = true;\n                c++;\n            }\n        }\n        if (c > 0) {\n            var root = this.jm.mind.root;\n            this.part_layout(root);\n            this.set_visible(root.children, true);\n        }\n    }\n    collapse_all() {\n        var nodes = this.jm.mind.nodes;\n        var c = 0;\n        var node;\n        for (var node_id in nodes) {\n            node = nodes[node_id];\n            if (node.expanded && !node.isroot) {\n                node.expanded = false;\n                c++;\n            }\n        }\n        if (c > 0) {\n            var root = this.jm.mind.root;\n            this.part_layout(root);\n            this.set_visible(root.children, true);\n        }\n    }\n    expand_to_depth(target_depth, curr_nodes, curr_depth) {\n        if (target_depth < 1) {\n            return;\n        }\n        var nodes = curr_nodes || this.jm.mind.root.children;\n        var depth = curr_depth || 1;\n        var i = nodes.length;\n        var node = null;\n        while (i--) {\n            node = nodes[i];\n            if (depth < target_depth) {\n                if (!node.expanded) {\n                    this.expand_node(node);\n                }\n                this.expand_to_depth(target_depth, node.children, depth + 1);\n            }\n            if (depth == target_depth) {\n                if (node.expanded) {\n                    this.collapse_node(node);\n                }\n            }\n        }\n    }\n    part_layout(node) {\n        var root = this.jm.mind.root;\n        if (!!root) {\n            var root_layout_data = root._data.layout;\n            if (node.isroot) {\n                root_layout_data.outer_height_right = this._layout_offset_subnodes_height(\n                    root_layout_data.right_nodes\n                );\n                root_layout_data.outer_height_left = this._layout_offset_subnodes_height(\n                    root_layout_data.left_nodes\n                );\n            } else {\n                if (node._data.layout.direction == Direction.right) {\n                    root_layout_data.outer_height_right = this._layout_offset_subnodes_height(\n                        root_layout_data.right_nodes\n                    );\n                } else {\n                    root_layout_data.outer_height_left = this._layout_offset_subnodes_height(\n                        root_layout_data.left_nodes\n                    );\n                }\n            }\n            this.bounds.s = Math.max(\n                root_layout_data.outer_height_left,\n                root_layout_data.outer_height_right\n            );\n            this.cache_valid = false;\n        } else {\n            logger.warn('can not found root node');\n        }\n    }\n    set_visible(nodes, visible) {\n        var i = nodes.length;\n        var node = null;\n        var layout_data = null;\n        while (i--) {\n            node = nodes[i];\n            layout_data = node._data.layout;\n            if (node.expanded) {\n                this.set_visible(node.children, visible);\n            } else {\n                this.set_visible(node.children, false);\n            }\n            if (!node.isroot) {\n                node._data.layout.visible = visible;\n            }\n        }\n    }\n    is_expand(node) {\n        return node.expanded;\n    }\n    is_visible(node) {\n        var layout_data = node._data.layout;\n        if ('visible' in layout_data && !layout_data.visible) {\n            return false;\n        } else {\n            return true;\n        }\n    }\n}\n","/**\n * @license BSD\n * @copyright 2014-2022 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\n\nimport { $ } from './jsmind.dom.js';\n\nclass SvgGraph {\n    constructor(view) {\n        this.view = view;\n        this.opts = view.opts;\n        this.e_svg = SvgGraph.c('svg');\n        this.e_svg.setAttribute('class', 'jsmind');\n        this.size = { w: 0, h: 0 };\n        this.lines = [];\n    }\n    static c(tag) {\n        return $.d.createElementNS('http://www.w3.org/2000/svg', tag);\n    }\n    element() {\n        return this.e_svg;\n    }\n    set_size(w, h) {\n        this.size.w = w;\n        this.size.h = h;\n        this.e_svg.setAttribute('width', w);\n        this.e_svg.setAttribute('height', h);\n    }\n    clear() {\n        var len = this.lines.length;\n        while (len--) {\n            this.e_svg.removeChild(this.lines[len]);\n        }\n        this.lines.length = 0;\n    }\n    draw_line(pout, pin, offset, color) {\n        var line = SvgGraph.c('path');\n        line.setAttribute('stroke', color || this.opts.line_color);\n        line.setAttribute('stroke-width', this.opts.line_width);\n        line.setAttribute('fill', 'transparent');\n        this.lines.push(line);\n        this.e_svg.appendChild(line);\n        this._bezier_to(\n            line,\n            pin.x + offset.x,\n            pin.y + offset.y,\n            pout.x + offset.x,\n            pout.y + offset.y\n        );\n    }\n    copy_to(dest_canvas_ctx, callback) {\n        var img = new Image();\n        img.onload = function () {\n            dest_canvas_ctx.drawImage(img, 0, 0);\n            !!callback && callback();\n        };\n        img.src =\n            'data:image/svg+xml;base64,' + btoa(new XMLSerializer().serializeToString(this.e_svg));\n    }\n    _bezier_to(path, x1, y1, x2, y2) {\n        path.setAttribute(\n            'd',\n            'M ' +\n                x1 +\n                ' ' +\n                y1 +\n                ' C ' +\n                (x1 + ((x2 - x1) * 2) / 3) +\n                ' ' +\n                y1 +\n                ', ' +\n                x1 +\n                ' ' +\n                y2 +\n                ', ' +\n                x2 +\n                ' ' +\n                y2\n        );\n    }\n    _line_to(path, x1, y1, x2, y2) {\n        path.setAttribute('d', 'M ' + x1 + ' ' + y1 + ' L ' + x2 + ' ' + y2);\n    }\n}\n\nclass CanvasGraph {\n    constructor(view) {\n        this.opts = view.opts;\n        this.e_canvas = $.c('canvas');\n        this.e_canvas.className = 'jsmind';\n        this.canvas_ctx = this.e_canvas.getContext('2d');\n        this.size = { w: 0, h: 0 };\n    }\n    element() {\n        return this.e_canvas;\n    }\n    set_size(w, h) {\n        this.size.w = w;\n        this.size.h = h;\n        this.e_canvas.width = w;\n        this.e_canvas.height = h;\n    }\n    clear() {\n        this.canvas_ctx.clearRect(0, 0, this.size.w, this.size.h);\n    }\n    draw_line(pout, pin, offset, color) {\n        var ctx = this.canvas_ctx;\n        ctx.strokeStyle = color || this.opts.line_color;\n        ctx.lineWidth = this.opts.line_width;\n        ctx.lineCap = 'round';\n\n        this._bezier_to(\n            ctx,\n            pin.x + offset.x,\n            pin.y + offset.y,\n            pout.x + offset.x,\n            pout.y + offset.y\n        );\n    }\n    copy_to(dest_canvas_ctx, callback) {\n        dest_canvas_ctx.drawImage(this.e_canvas, 0, 0);\n        !!callback && callback();\n    }\n    _bezier_to(ctx, x1, y1, x2, y2) {\n        ctx.beginPath();\n        ctx.moveTo(x1, y1);\n        ctx.bezierCurveTo(x1 + ((x2 - x1) * 2) / 3, y1, x1, y2, x2, y2);\n        ctx.stroke();\n    }\n    _line_to(ctx, x1, y1, x2, y2) {\n        ctx.beginPath();\n        ctx.moveTo(x1, y1);\n        ctx.lineTo(x2, y2);\n        ctx.stroke();\n    }\n}\n\nexport function init_graph(view, engine) {\n    return engine.toLowerCase() === 'svg' ? new SvgGraph(view) : new CanvasGraph(view);\n}\n","/**\n * @license BSD\n * @copyright 2014-2022 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\nimport { logger, EventType } from './jsmind.common.js';\nimport { $ } from './jsmind.dom.js';\nimport { init_graph } from './jsmind.graph.js';\nimport { util } from './jsmind.util.js';\n\nexport class ViewProvider {\n    constructor(jm, options) {\n        this.opts = options;\n        this.jm = jm;\n        this.layout = jm.layout;\n\n        this.container = null;\n        this.e_panel = null;\n        this.e_nodes = null;\n\n        this.size = { w: 0, h: 0 };\n\n        this.selected_node = null;\n        this.editing_node = null;\n\n        this.graph = null;\n        this._initialized = false;\n    }\n    init() {\n        logger.debug('view.init');\n\n        this.container = $.i(this.opts.container) ? this.opts.container : $.g(this.opts.container);\n        if (!this.container) {\n            logger.error('the options.view.container was not be found in dom');\n            return;\n        }\n        this.graph = init_graph(this, this.opts.engine);\n\n        this.e_panel = $.c('div');\n        this.e_nodes = $.c('jmnodes');\n        this.e_editor = $.c('input');\n        this.e_panel.className = 'jsmind-inner';\n        this.e_panel.tabIndex = 1;\n        this.e_panel.appendChild(this.graph.element());\n        this.e_panel.appendChild(this.e_nodes);\n\n        this.e_editor.className = 'jsmind-editor';\n        this.e_editor.type = 'text';\n\n        this.actualZoom = 1;\n        this.zoomStep = 0.1;\n        this.minZoom = 0.5;\n        this.maxZoom = 2;\n\n        var v = this;\n        $.on(this.e_editor, 'keydown', function (e) {\n            var evt = e || event;\n            if (evt.keyCode == 13) {\n                v.edit_node_end();\n                evt.stopPropagation();\n            }\n        });\n        $.on(this.e_editor, 'blur', function (e) {\n            v.edit_node_end();\n        });\n\n        this.container.appendChild(this.e_panel);\n    }\n    add_event(obj, event_name, event_handle) {\n        $.on(this.e_nodes, event_name, function (e) {\n            var evt = e || event;\n            event_handle.call(obj, evt);\n        });\n    }\n    get_binded_nodeid(element) {\n        if (element == null) {\n            return null;\n        }\n        var tagName = element.tagName.toLowerCase();\n        if (tagName == 'jmnodes' || tagName == 'body' || tagName == 'html') {\n            return null;\n        }\n        if (tagName == 'jmnode' || tagName == 'jmexpander') {\n            return element.getAttribute('nodeid');\n        } else {\n            return this.get_binded_nodeid(element.parentElement);\n        }\n    }\n    is_expander(element) {\n        return element.tagName.toLowerCase() == 'jmexpander';\n    }\n    reset() {\n        logger.debug('view.reset');\n        this.selected_node = null;\n        this.clear_lines();\n        this.clear_nodes();\n        this.reset_theme();\n    }\n    reset_theme() {\n        var theme_name = this.jm.options.theme;\n        if (!!theme_name) {\n            this.e_nodes.className = 'theme-' + theme_name;\n        } else {\n            this.e_nodes.className = '';\n        }\n    }\n    reset_custom_style() {\n        var nodes = this.jm.mind.nodes;\n        for (var nodeid in nodes) {\n            this.reset_node_custom_style(nodes[nodeid]);\n        }\n    }\n    load() {\n        logger.debug('view.load');\n        this.setup_canvas_draggable(this.opts.draggable);\n        this.init_nodes();\n        this._initialized = true;\n    }\n    expand_size() {\n        var min_size = this.layout.get_min_size();\n        var min_width = min_size.w + this.opts.hmargin * 2;\n        var min_height = min_size.h + this.opts.vmargin * 2;\n        var client_w = this.e_panel.clientWidth;\n        var client_h = this.e_panel.clientHeight;\n        if (client_w < min_width) {\n            client_w = min_width;\n        }\n        if (client_h < min_height) {\n            client_h = min_height;\n        }\n        this.size.w = client_w;\n        this.size.h = client_h;\n    }\n    init_nodes_size(node) {\n        var view_data = node._data.view;\n        view_data.width = view_data.element.clientWidth;\n        view_data.height = view_data.element.clientHeight;\n    }\n    init_nodes() {\n        var nodes = this.jm.mind.nodes;\n        var doc_frag = $.d.createDocumentFragment();\n        for (var nodeid in nodes) {\n            this.create_node_element(nodes[nodeid], doc_frag);\n        }\n        this.e_nodes.appendChild(doc_frag);\n        for (var nodeid in nodes) {\n            this.init_nodes_size(nodes[nodeid]);\n        }\n    }\n    add_node(node) {\n        this.create_node_element(node, this.e_nodes);\n        this.init_nodes_size(node);\n    }\n    create_node_element(node, parent_node) {\n        var view_data = null;\n        if ('view' in node._data) {\n            view_data = node._data.view;\n        } else {\n            view_data = {};\n            node._data.view = view_data;\n        }\n\n        var d = $.c('jmnode');\n        if (node.isroot) {\n            d.className = 'root';\n        } else {\n            var d_e = $.c('jmexpander');\n            $.t(d_e, '-');\n            d_e.setAttribute('nodeid', node.id);\n            d_e.style.visibility = 'hidden';\n            parent_node.appendChild(d_e);\n            view_data.expander = d_e;\n        }\n        if (!!node.topic) {\n            if (this.opts.support_html) {\n                $.h(d, node.topic);\n            } else {\n                $.t(d, node.topic);\n            }\n        }\n        d.setAttribute('nodeid', node.id);\n        d.style.visibility = 'hidden';\n        this._reset_node_custom_style(d, node.data);\n\n        parent_node.appendChild(d);\n        view_data.element = d;\n    }\n    remove_node(node) {\n        if (this.selected_node != null && this.selected_node.id == node.id) {\n            this.selected_node = null;\n        }\n        if (this.editing_node != null && this.editing_node.id == node.id) {\n            node._data.view.element.removeChild(this.e_editor);\n            this.editing_node = null;\n        }\n        var children = node.children;\n        var i = children.length;\n        while (i--) {\n            this.remove_node(children[i]);\n        }\n        if (node._data.view) {\n            var element = node._data.view.element;\n            var expander = node._data.view.expander;\n            this.e_nodes.removeChild(element);\n            this.e_nodes.removeChild(expander);\n            node._data.view.element = null;\n            node._data.view.expander = null;\n        }\n    }\n    update_node(node) {\n        var view_data = node._data.view;\n        var element = view_data.element;\n        if (!!node.topic) {\n            if (this.opts.support_html) {\n                $.h(element, node.topic);\n            } else {\n                $.t(element, node.topic);\n            }\n        }\n        if (this.layout.is_visible(node)) {\n            view_data.width = element.clientWidth;\n            view_data.height = element.clientHeight;\n        } else {\n            let origin_style = element.getAttribute('style');\n            element.style = 'visibility: visible; left:0; top:0;';\n            view_data.width = element.clientWidth;\n            view_data.height = element.clientHeight;\n            element.style = origin_style;\n        }\n    }\n    select_node(node) {\n        if (!!this.selected_node) {\n            var element = this.selected_node._data.view.element;\n            element.className = element.className.replace(/\\s*selected\\b/i, '');\n            this.restore_selected_node_custom_style(this.selected_node);\n        }\n        if (!!node) {\n            this.selected_node = node;\n            node._data.view.element.className += ' selected';\n            this.clear_selected_node_custom_style(node);\n        }\n    }\n    select_clear() {\n        this.select_node(null);\n    }\n    get_editing_node() {\n        return this.editing_node;\n    }\n    is_editing() {\n        return !!this.editing_node;\n    }\n    edit_node_begin(node) {\n        if (!node.topic) {\n            logger.warn(\"don't edit image nodes\");\n            return;\n        }\n        if (this.editing_node != null) {\n            this.edit_node_end();\n        }\n        this.editing_node = node;\n        var view_data = node._data.view;\n        var element = view_data.element;\n        var topic = node.topic;\n        var ncs = getComputedStyle(element);\n        this.e_editor.value = topic;\n        this.e_editor.style.width =\n            element.clientWidth -\n            parseInt(ncs.getPropertyValue('padding-left')) -\n            parseInt(ncs.getPropertyValue('padding-right')) +\n            'px';\n        element.innerHTML = '';\n        element.appendChild(this.e_editor);\n        element.style.zIndex = 5;\n        this.e_editor.focus();\n        this.e_editor.select();\n    }\n    edit_node_end() {\n        if (this.editing_node != null) {\n            var node = this.editing_node;\n            this.editing_node = null;\n            var view_data = node._data.view;\n            var element = view_data.element;\n            var topic = this.e_editor.value;\n            element.style.zIndex = 'auto';\n            element.removeChild(this.e_editor);\n            if (util.text.is_empty(topic) || node.topic === topic) {\n                if (this.opts.support_html) {\n                    $.h(element, node.topic);\n                } else {\n                    $.t(element, node.topic);\n                }\n            } else {\n                this.jm.update_node(node.id, topic);\n            }\n        }\n        this.e_panel.focus();\n    }\n    get_view_offset() {\n        var bounds = this.layout.bounds;\n        var _x = (this.size.w - bounds.e - bounds.w) / 2;\n        var _y = this.size.h / 2;\n        return { x: _x, y: _y };\n    }\n    resize() {\n        this.graph.set_size(1, 1);\n        this.e_nodes.style.width = '1px';\n        this.e_nodes.style.height = '1px';\n\n        this.expand_size();\n        this._show();\n    }\n    _show() {\n        this.graph.set_size(this.size.w, this.size.h);\n        this.e_nodes.style.width = this.size.w + 'px';\n        this.e_nodes.style.height = this.size.h + 'px';\n        this.show_nodes();\n        this.show_lines();\n        //this.layout.cache_valid = true;\n        this.jm.invoke_event_handle(EventType.resize, { data: [] });\n    }\n    zoomIn() {\n        return this.setZoom(this.actualZoom + this.zoomStep);\n    }\n    zoomOut() {\n        return this.setZoom(this.actualZoom - this.zoomStep);\n    }\n    setZoom(zoom) {\n        if (zoom < this.minZoom || zoom > this.maxZoom) {\n            return false;\n        }\n        this.actualZoom = zoom;\n        for (var i = 0; i < this.e_panel.children.length; i++) {\n            this.e_panel.children[i].style.zoom = zoom;\n        }\n        this.show(true);\n        return true;\n    }\n    _center_root() {\n        // center root node\n        var outer_w = this.e_panel.clientWidth;\n        var outer_h = this.e_panel.clientHeight;\n        if (this.size.w > outer_w) {\n            var _offset = this.get_view_offset();\n            this.e_panel.scrollLeft = _offset.x * this.actualZoom - outer_w / 2;\n        }\n        if (this.size.h > outer_h) {\n            this.e_panel.scrollTop = (this.size.h * this.actualZoom - outer_h) / 2;\n        }\n    }\n    show(keep_center) {\n        logger.debug('view.show');\n        this.expand_size();\n        this._show();\n        if (!!keep_center) {\n            this._center_root();\n        }\n    }\n    relayout() {\n        this.expand_size();\n        this._show();\n    }\n    save_location(node) {\n        var vd = node._data.view;\n        vd._saved_location = {\n            x: parseInt(vd.element.style.left) - this.e_panel.scrollLeft,\n            y: parseInt(vd.element.style.top) - this.e_panel.scrollTop,\n        };\n    }\n    restore_location(node) {\n        var vd = node._data.view;\n        this.e_panel.scrollLeft = parseInt(vd.element.style.left) - vd._saved_location.x;\n        this.e_panel.scrollTop = parseInt(vd.element.style.top) - vd._saved_location.y;\n    }\n    clear_nodes() {\n        var mind = this.jm.mind;\n        if (mind == null) {\n            return;\n        }\n        var nodes = mind.nodes;\n        var node = null;\n        for (var nodeid in nodes) {\n            node = nodes[nodeid];\n            node._data.view.element = null;\n            node._data.view.expander = null;\n        }\n        this.e_nodes.innerHTML = '';\n    }\n    show_nodes() {\n        var nodes = this.jm.mind.nodes;\n        var node = null;\n        var node_element = null;\n        var expander = null;\n        var p = null;\n        var p_expander = null;\n        var expander_text = '-';\n        var view_data = null;\n        var _offset = this.get_view_offset();\n        for (var nodeid in nodes) {\n            node = nodes[nodeid];\n            view_data = node._data.view;\n            node_element = view_data.element;\n            expander = view_data.expander;\n            if (!this.layout.is_visible(node)) {\n                node_element.style.display = 'none';\n                expander.style.display = 'none';\n                continue;\n            }\n            this.reset_node_custom_style(node);\n            p = this.layout.get_node_point(node);\n            view_data.abs_x = _offset.x + p.x;\n            view_data.abs_y = _offset.y + p.y;\n            node_element.style.left = _offset.x + p.x + 'px';\n            node_element.style.top = _offset.y + p.y + 'px';\n            node_element.style.display = '';\n            node_element.style.visibility = 'visible';\n            if (!node.isroot && node.children.length > 0) {\n                expander_text = node.expanded ? '-' : '+';\n                p_expander = this.layout.get_expander_point(node);\n                expander.style.left = _offset.x + p_expander.x + 'px';\n                expander.style.top = _offset.y + p_expander.y + 'px';\n                expander.style.display = '';\n                expander.style.visibility = 'visible';\n                $.t(expander, expander_text);\n            }\n            // hide expander while all children have been removed\n            if (!node.isroot && node.children.length == 0) {\n                expander.style.display = 'none';\n                expander.style.visibility = 'hidden';\n            }\n        }\n    }\n    reset_node_custom_style(node) {\n        this._reset_node_custom_style(node._data.view.element, node.data);\n    }\n    _reset_node_custom_style(node_element, node_data) {\n        if ('background-color' in node_data) {\n            node_element.style.backgroundColor = node_data['background-color'];\n        }\n        if ('foreground-color' in node_data) {\n            node_element.style.color = node_data['foreground-color'];\n        }\n        if ('width' in node_data) {\n            node_element.style.width = node_data['width'] + 'px';\n        }\n        if ('height' in node_data) {\n            node_element.style.height = node_data['height'] + 'px';\n        }\n        if ('font-size' in node_data) {\n            node_element.style.fontSize = node_data['font-size'] + 'px';\n        }\n        if ('font-weight' in node_data) {\n            node_element.style.fontWeight = node_data['font-weight'];\n        }\n        if ('font-style' in node_data) {\n            node_element.style.fontStyle = node_data['font-style'];\n        }\n        if ('background-image' in node_data) {\n            var backgroundImage = node_data['background-image'];\n            if (backgroundImage.startsWith('data') && node_data['width'] && node_data['height']) {\n                var img = new Image();\n\n                img.onload = function () {\n                    var c = $.c('canvas');\n                    c.width = node_element.clientWidth;\n                    c.height = node_element.clientHeight;\n                    var img = this;\n                    if (c.getContext) {\n                        var ctx = c.getContext('2d');\n                        ctx.drawImage(\n                            img,\n                            2,\n                            2,\n                            node_element.clientWidth,\n                            node_element.clientHeight\n                        );\n                        var scaledImageData = c.toDataURL();\n                        node_element.style.backgroundImage = 'url(' + scaledImageData + ')';\n                    }\n                };\n                img.src = backgroundImage;\n            } else {\n                node_element.style.backgroundImage = 'url(' + backgroundImage + ')';\n            }\n            node_element.style.backgroundSize = '99%';\n\n            if ('background-rotation' in node_data) {\n                node_element.style.transform =\n                    'rotate(' + node_data['background-rotation'] + 'deg)';\n            }\n        }\n    }\n    restore_selected_node_custom_style(node) {\n        var node_element = node._data.view.element;\n        var node_data = node.data;\n        if ('background-color' in node_data) {\n            node_element.style.backgroundColor = node_data['background-color'];\n        }\n        if ('foreground-color' in node_data) {\n            node_element.style.color = node_data['foreground-color'];\n        }\n    }\n    clear_selected_node_custom_style(node) {\n        var node_element = node._data.view.element;\n        node_element.style.backgroundColor = '';\n        node_element.style.color = '';\n    }\n    clear_lines() {\n        this.graph.clear();\n    }\n    show_lines() {\n        this.clear_lines();\n        var nodes = this.jm.mind.nodes;\n        var node = null;\n        var pin = null;\n        var pout = null;\n        var color = null;\n        var _offset = this.get_view_offset();\n        for (var nodeid in nodes) {\n            node = nodes[nodeid];\n            if (!!node.isroot) {\n                continue;\n            }\n            if ('visible' in node._data.layout && !node._data.layout.visible) {\n                continue;\n            }\n            pin = this.layout.get_node_point_in(node);\n            pout = this.layout.get_node_point_out(node.parent);\n            color = node.data['leading-line-color'];\n            this.graph.draw_line(pout, pin, _offset, color);\n        }\n    }\n    // Drag the whole mind map with your mouse, when it's larger that the container\n    setup_canvas_draggable(enabled) {\n        this.opts.draggable = enabled;\n        if (!this._initialized) {\n            let dragging = false;\n            let x, y;\n            if (this.opts.hide_scrollbars_when_draggable) {\n                // Avoid scrollbars when mind map is larger than the container (e_panel = id jsmind-inner)\n                this.e_panel.style = 'overflow: hidden';\n            }\n            // Move the whole mind map with mouse moves, while button is down.\n            $.on(this.container, 'mousedown', eventDown => {\n                if (this.opts.draggable) {\n                    dragging = true;\n                    // Record current mouse position.\n                    x = eventDown.clientX;\n                    y = eventDown.clientY;\n                }\n            });\n            // Stop moving mind map once mouse button is released.\n            $.on(this.container, 'mouseup', () => {\n                dragging = false;\n            });\n            // Follow current mouse position and move mind map accordingly.\n            $.on(this.container, 'mousemove', eventMove => {\n                if (this.opts.draggable) {\n                    if (dragging) {\n                        this.e_panel.scrollBy(x - eventMove.clientX, y - eventMove.clientY);\n                        // Record new current position.\n                        x = eventMove.clientX;\n                        y = eventMove.clientY;\n                    }\n                }\n            });\n        }\n    }\n}\n","/**\n * @license BSD\n * @copyright 2014-2022 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\n\nimport { $ } from './jsmind.dom.js';\nimport { util } from './jsmind.util.js';\nimport { Direction } from './jsmind.common.js';\n\nexport class ShortcutProvider {\n    constructor(jm, options) {\n        this.jm = jm;\n        this.opts = options;\n        this.mapping = options.mapping;\n        this.handles = options.handles;\n        this._newid = null;\n        this._mapping = {};\n    }\n    init() {\n        $.on(this.jm.view.e_panel, 'keydown', this.handler.bind(this));\n\n        this.handles['addchild'] = this.handle_addchild;\n        this.handles['addbrother'] = this.handle_addbrother;\n        this.handles['editnode'] = this.handle_editnode;\n        this.handles['delnode'] = this.handle_delnode;\n        this.handles['toggle'] = this.handle_toggle;\n        this.handles['up'] = this.handle_up;\n        this.handles['down'] = this.handle_down;\n        this.handles['left'] = this.handle_left;\n        this.handles['right'] = this.handle_right;\n\n        for (var handle in this.mapping) {\n            if (!!this.mapping[handle] && handle in this.handles) {\n                let keys = this.mapping[handle];\n                if (!Array.isArray(keys)) {\n                    keys = [keys];\n                }\n                for (let key of keys) {\n                    this._mapping[key] = this.handles[handle];\n                }\n            }\n        }\n\n        if (typeof this.opts.id_generator === 'function') {\n            this._newid = this.opts.id_generator;\n        } else {\n            this._newid = util.uuid.newid;\n        }\n    }\n    enable_shortcut() {\n        this.opts.enable = true;\n    }\n    disable_shortcut() {\n        this.opts.enable = false;\n    }\n    handler(e) {\n        if (e.which == 9) {\n            e.preventDefault();\n        } //prevent tab to change focus in browser\n        if (this.jm.view.is_editing()) {\n            return;\n        }\n        var evt = e || event;\n        if (!this.opts.enable) {\n            return true;\n        }\n        var kc =\n            evt.keyCode +\n            (evt.metaKey << 13) +\n            (evt.ctrlKey << 12) +\n            (evt.altKey << 11) +\n            (evt.shiftKey << 10);\n        if (kc in this._mapping) {\n            this._mapping[kc].call(this, this.jm, e);\n        }\n    }\n    handle_addchild(_jm, e) {\n        var selected_node = _jm.get_selected_node();\n        if (!!selected_node) {\n            var node_id = this._newid();\n            var node = _jm.add_node(selected_node, node_id, 'New Node');\n            if (!!node) {\n                _jm.select_node(node_id);\n                _jm.begin_edit(node_id);\n            }\n        }\n    }\n    handle_addbrother(_jm, e) {\n        var selected_node = _jm.get_selected_node();\n        if (!!selected_node && !selected_node.isroot) {\n            var node_id = this._newid();\n            var node = _jm.insert_node_after(selected_node, node_id, 'New Node');\n            if (!!node) {\n                _jm.select_node(node_id);\n                _jm.begin_edit(node_id);\n            }\n        }\n    }\n    handle_editnode(_jm, e) {\n        var selected_node = _jm.get_selected_node();\n        if (!!selected_node) {\n            _jm.begin_edit(selected_node);\n        }\n    }\n    handle_delnode(_jm, e) {\n        var selected_node = _jm.get_selected_node();\n        if (!!selected_node && !selected_node.isroot) {\n            _jm.select_node(selected_node.parent);\n            _jm.remove_node(selected_node);\n        }\n    }\n    handle_toggle(_jm, e) {\n        var evt = e || event;\n        var selected_node = _jm.get_selected_node();\n        if (!!selected_node) {\n            _jm.toggle_node(selected_node.id);\n            evt.stopPropagation();\n            evt.preventDefault();\n        }\n    }\n    handle_up(_jm, e) {\n        var evt = e || event;\n        var selected_node = _jm.get_selected_node();\n        if (!!selected_node) {\n            var up_node = _jm.find_node_before(selected_node);\n            if (!up_node) {\n                var np = _jm.find_node_before(selected_node.parent);\n                if (!!np && np.children.length > 0) {\n                    up_node = np.children[np.children.length - 1];\n                }\n            }\n            if (!!up_node) {\n                _jm.select_node(up_node);\n            }\n            evt.stopPropagation();\n            evt.preventDefault();\n        }\n    }\n    handle_down(_jm, e) {\n        var evt = e || event;\n        var selected_node = _jm.get_selected_node();\n        if (!!selected_node) {\n            var down_node = _jm.find_node_after(selected_node);\n            if (!down_node) {\n                var np = _jm.find_node_after(selected_node.parent);\n                if (!!np && np.children.length > 0) {\n                    down_node = np.children[0];\n                }\n            }\n            if (!!down_node) {\n                _jm.select_node(down_node);\n            }\n            evt.stopPropagation();\n            evt.preventDefault();\n        }\n    }\n    handle_left(_jm, e) {\n        this._handle_direction(_jm, e, Direction.left);\n    }\n    handle_right(_jm, e) {\n        this._handle_direction(_jm, e, Direction.right);\n    }\n    _handle_direction(_jm, e, d) {\n        var evt = e || event;\n        var selected_node = _jm.get_selected_node();\n        var node = null;\n        if (!!selected_node) {\n            if (selected_node.isroot) {\n                var c = selected_node.children;\n                var children = [];\n                for (var i = 0; i < c.length; i++) {\n                    if (c[i].direction === d) {\n                        children.push(i);\n                    }\n                }\n                node = c[children[Math.floor((children.length - 1) / 2)]];\n            } else if (selected_node.direction === d) {\n                var children = selected_node.children;\n                var children_count = children.length;\n                if (children_count > 0) {\n                    node = children[Math.floor((children_count - 1) / 2)];\n                }\n            } else {\n                node = selected_node.parent;\n            }\n            if (!!node) {\n                _jm.select_node(node);\n            }\n            evt.stopPropagation();\n            evt.preventDefault();\n        }\n    }\n}\n","/**\n * @license BSD\n * @copyright 2014-2022 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\n\nimport { $ } from './jsmind.dom.js';\n\nconst plugin_data = {\n    plugins: [],\n};\n\nexport function register(plugin) {\n    if (!plugin instanceof Plugin) {\n        throw new Error('plugin ' + plugin + ' is not a supported plugin');\n    }\n    plugin_data.plugins.push(plugin);\n}\n\nexport function apply(jm) {\n    $.w.setTimeout(function () {\n        _apply(jm);\n    }, 0);\n}\n\nfunction _apply(jm) {\n    var l = plugin_data.plugins.length;\n    var fn_init = null;\n    for (var i = 0; i < l; i++) {\n        fn_init = plugin_data.plugins[i].init;\n        if (typeof fn_init === 'function') {\n            fn_init(jm);\n        }\n    }\n}\n\nexport class Plugin {\n    constructor(name, init) {\n        this.name = name;\n        this.init = init;\n    }\n}\n","/**\n * @license BSD\n * @copyright 2014-2022 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\n\nimport { __version__, logger, EventType, Direction, LogLevel } from './jsmind.common.js';\nimport { merge_option } from './jsmind.option.js';\nimport { Mind } from './jsmind.mind.js';\nimport { Node } from './jsmind.node.js';\nimport { DataProvider } from './jsmind.data_provider.js';\nimport { LayoutProvider } from './jsmind.layout_provider.js';\nimport { ViewProvider } from './jsmind.view_provider.js';\nimport { ShortcutProvider } from './jsmind.shortcut_provider.js';\nimport { Plugin, register as _register_plugin, apply as apply_plugins } from './jsmind.plugin.js';\nimport { format } from './jsmind.format.js';\nimport { $ } from './jsmind.dom.js';\nimport { util as _util } from './jsmind.util.js';\n\nexport default class jsMind {\n    static mind = Mind;\n    static node = Node;\n    static direction = Direction;\n    static event_type = EventType;\n    static $ = $;\n    static plugin = Plugin;\n    static register_plugin = _register_plugin;\n    static util = _util;\n\n    constructor(options) {\n        jsMind.current = this;\n        this.options = merge_option(options);\n        logger.level(LogLevel[this.options.log_level]);\n        this.version = __version__;\n        this.initialized = false;\n        this.mind = null;\n        this.event_handles = [];\n        this.init();\n    }\n\n    init() {\n        if (!!this.initialized) {\n            return;\n        }\n        this.initialized = true;\n        var opts_layout = {\n            mode: this.options.mode,\n            hspace: this.options.layout.hspace,\n            vspace: this.options.layout.vspace,\n            pspace: this.options.layout.pspace,\n        };\n        var opts_view = {\n            container: this.options.container,\n            support_html: this.options.support_html,\n            engine: this.options.view.engine,\n            hmargin: this.options.view.hmargin,\n            vmargin: this.options.view.vmargin,\n            line_width: this.options.view.line_width,\n            line_color: this.options.view.line_color,\n            draggable: this.options.view.draggable,\n            hide_scrollbars_when_draggable: this.options.view.hide_scrollbars_when_draggable,\n        };\n        // create instance of function provider\n        this.data = new DataProvider(this);\n        this.layout = new LayoutProvider(this, opts_layout);\n        this.view = new ViewProvider(this, opts_view);\n        this.shortcut = new ShortcutProvider(this, this.options.shortcut);\n\n        this.data.init();\n        this.layout.init();\n        this.view.init();\n        this.shortcut.init();\n\n        this._event_bind();\n\n        apply_plugins(this);\n    }\n    get_editable() {\n        return this.options.editable;\n    }\n    enable_edit() {\n        this.options.editable = true;\n    }\n    disable_edit() {\n        this.options.editable = false;\n    }\n    get_view_draggable() {\n        return this.options.view.draggable;\n    }\n    enable_view_draggable() {\n        this.options.view.draggable = true;\n        this.view.setup_canvas_draggable(true);\n    }\n    disable_view_draggable() {\n        this.options.view.draggable = false;\n        this.view.setup_canvas_draggable(false);\n    }\n    // options are 'mousedown', 'click', 'dblclick', 'mousewheel'\n    enable_event_handle(event_handle) {\n        this.options.default_event_handle['enable_' + event_handle + '_handle'] = true;\n    }\n    // options are 'mousedown', 'click', 'dblclick', 'mousewheel'\n    disable_event_handle(event_handle) {\n        this.options.default_event_handle['enable_' + event_handle + '_handle'] = false;\n    }\n    set_theme(theme) {\n        var theme_old = this.options.theme;\n        this.options.theme = !!theme ? theme : null;\n        if (theme_old != this.options.theme) {\n            this.view.reset_theme();\n            this.view.reset_custom_style();\n        }\n    }\n    _event_bind() {\n        this.view.add_event(this, 'mousedown', this.mousedown_handle);\n        this.view.add_event(this, 'click', this.click_handle);\n        this.view.add_event(this, 'dblclick', this.dblclick_handle);\n        this.view.add_event(this, 'mousewheel', this.mousewheel_handle);\n    }\n    mousedown_handle(e) {\n        if (!this.options.default_event_handle['enable_mousedown_handle']) {\n            return;\n        }\n        var element = e.target || event.srcElement;\n        var node_id = this.view.get_binded_nodeid(element);\n        if (!!node_id) {\n            if (element.tagName.toLowerCase() == 'jmnode') {\n                this.select_node(node_id);\n            }\n        } else {\n            this.select_clear();\n        }\n    }\n    click_handle(e) {\n        if (!this.options.default_event_handle['enable_click_handle']) {\n            return;\n        }\n        var element = e.target || event.srcElement;\n        var is_expander = this.view.is_expander(element);\n        if (is_expander) {\n            var node_id = this.view.get_binded_nodeid(element);\n            if (!!node_id) {\n                this.toggle_node(node_id);\n            }\n        }\n    }\n    dblclick_handle(e) {\n        if (!this.options.default_event_handle['enable_dblclick_handle']) {\n            return;\n        }\n        if (this.get_editable()) {\n            var element = e.target || event.srcElement;\n            var node_id = this.view.get_binded_nodeid(element);\n            if (!!node_id) {\n                this.begin_edit(node_id);\n            }\n        }\n    }\n    // Use [Ctrl] + Mousewheel, to zoom in/out.\n    mousewheel_handle(e) {\n        // Test if mousewheel option is enabled and Ctrl key is pressed.\n        if (!this.options.default_event_handle['enable_mousewheel_handle'] || !e.ctrlKey) {\n            return;\n        }\n        var evt = e || event;\n        // Avoid default page scrolling behavior.\n        evt.preventDefault();\n\n        if (evt.deltaY < 0) {\n            this.view.zoomIn(); // wheel down\n        } else {\n            this.view.zoomOut();\n        }\n    }\n    begin_edit(node) {\n        if (!Node.is_node(node)) {\n            var the_node = this.get_node(node);\n            if (!the_node) {\n                logger.error('the node[id=' + node + '] can not be found.');\n                return false;\n            } else {\n                return this.begin_edit(the_node);\n            }\n        }\n        if (this.get_editable()) {\n            this.view.edit_node_begin(node);\n        } else {\n            logger.error('fail, this mind map is not editable.');\n            return;\n        }\n    }\n    end_edit() {\n        this.view.edit_node_end();\n    }\n    toggle_node(node) {\n        if (!Node.is_node(node)) {\n            var the_node = this.get_node(node);\n            if (!the_node) {\n                logger.error('the node[id=' + node + '] can not be found.');\n                return;\n            } else {\n                return this.toggle_node(the_node);\n            }\n        }\n        if (node.isroot) {\n            return;\n        }\n        this.view.save_location(node);\n        this.layout.toggle_node(node);\n        this.view.relayout();\n        this.view.restore_location(node);\n    }\n    expand_node(node) {\n        if (!Node.is_node(node)) {\n            var the_node = this.get_node(node);\n            if (!the_node) {\n                logger.error('the node[id=' + node + '] can not be found.');\n                return;\n            } else {\n                return this.expand_node(the_node);\n            }\n        }\n        if (node.isroot) {\n            return;\n        }\n        this.view.save_location(node);\n        this.layout.expand_node(node);\n        this.view.relayout();\n        this.view.restore_location(node);\n    }\n    collapse_node(node) {\n        if (!Node.is_node(node)) {\n            var the_node = this.get_node(node);\n            if (!the_node) {\n                logger.error('the node[id=' + node + '] can not be found.');\n                return;\n            } else {\n                return this.collapse_node(the_node);\n            }\n        }\n        if (node.isroot) {\n            return;\n        }\n        this.view.save_location(node);\n        this.layout.collapse_node(node);\n        this.view.relayout();\n        this.view.restore_location(node);\n    }\n    expand_all() {\n        this.layout.expand_all();\n        this.view.relayout();\n    }\n    collapse_all() {\n        this.layout.collapse_all();\n        this.view.relayout();\n    }\n    expand_to_depth(depth) {\n        this.layout.expand_to_depth(depth);\n        this.view.relayout();\n    }\n    _reset() {\n        this.view.reset();\n        this.layout.reset();\n        this.data.reset();\n    }\n    _show(mind) {\n        var m = mind || format.node_array.example;\n\n        this.mind = this.data.load(m);\n        if (!this.mind) {\n            logger.error('data.load error');\n            return;\n        } else {\n            logger.debug('data.load ok');\n        }\n\n        this.view.load();\n        logger.debug('view.load ok');\n\n        this.layout.layout();\n        logger.debug('layout.layout ok');\n\n        this.view.show(true);\n        logger.debug('view.show ok');\n\n        this.invoke_event_handle(EventType.show, { data: [mind] });\n    }\n    show(mind) {\n        this._reset();\n        this._show(mind);\n    }\n    get_meta() {\n        return {\n            name: this.mind.name,\n            author: this.mind.author,\n            version: this.mind.version,\n        };\n    }\n    get_data(data_format) {\n        var df = data_format || 'node_tree';\n        return this.data.get_data(df);\n    }\n    get_root() {\n        return this.mind.root;\n    }\n    get_node(node) {\n        if (Node.is_node(node)) {\n            return node;\n        }\n        return this.mind.get_node(node);\n    }\n    add_node(parent_node, node_id, topic, data) {\n        if (this.get_editable()) {\n            var the_parent_node = this.get_node(parent_node);\n            var direction = this.layout.calculate_next_child_direction(the_parent_node);\n            var node = this.mind.add_node(the_parent_node, node_id, topic, data, direction);\n            if (!!node) {\n                this.view.add_node(node);\n                this.layout.layout();\n                this.view.show(false);\n                this.view.reset_node_custom_style(node);\n                this.expand_node(the_parent_node);\n                this.invoke_event_handle(EventType.edit, {\n                    evt: 'add_node',\n                    data: [the_parent_node.id, node_id, topic, data],\n                    node: node_id,\n                });\n            }\n            return node;\n        } else {\n            logger.error('fail, this mind map is not editable');\n            return null;\n        }\n    }\n    insert_node_before(node_before, node_id, topic, data) {\n        if (this.get_editable()) {\n            var the_node_before = this.get_node(node_before);\n            var direction = this.layout.calculate_next_child_direction(the_node_before.parent);\n            var node = this.mind.insert_node_before(\n                the_node_before,\n                node_id,\n                topic,\n                data,\n                direction\n            );\n            if (!!node) {\n                this.view.add_node(node);\n                this.layout.layout();\n                this.view.show(false);\n                this.invoke_event_handle(EventType.edit, {\n                    evt: 'insert_node_before',\n                    data: [the_node_before.id, node_id, topic, data],\n                    node: node_id,\n                });\n            }\n            return node;\n        } else {\n            logger.error('fail, this mind map is not editable');\n            return null;\n        }\n    }\n    insert_node_after(node_after, node_id, topic, data) {\n        if (this.get_editable()) {\n            var the_node_after = this.get_node(node_after);\n            var direction = this.layout.calculate_next_child_direction(the_node_after.parent);\n            var node = this.mind.insert_node_after(the_node_after, node_id, topic, data, direction);\n            if (!!node) {\n                this.view.add_node(node);\n                this.layout.layout();\n                this.view.show(false);\n                this.invoke_event_handle(EventType.edit, {\n                    evt: 'insert_node_after',\n                    data: [the_node_after.id, node_id, topic, data],\n                    node: node_id,\n                });\n            }\n            return node;\n        } else {\n            logger.error('fail, this mind map is not editable');\n            return null;\n        }\n    }\n    remove_node(node) {\n        if (!Node.is_node(node)) {\n            var the_node = this.get_node(node);\n            if (!the_node) {\n                logger.error('the node[id=' + node + '] can not be found.');\n                return false;\n            } else {\n                return this.remove_node(the_node);\n            }\n        }\n        if (this.get_editable()) {\n            if (node.isroot) {\n                logger.error('fail, can not remove root node');\n                return false;\n            }\n            var node_id = node.id;\n            var parent_id = node.parent.id;\n            var parent_node = this.get_node(parent_id);\n            this.view.save_location(parent_node);\n            this.view.remove_node(node);\n            this.mind.remove_node(node);\n            this.layout.layout();\n            this.view.show(false);\n            this.view.restore_location(parent_node);\n            this.invoke_event_handle(EventType.edit, {\n                evt: 'remove_node',\n                data: [node_id],\n                node: parent_id,\n            });\n            return true;\n        } else {\n            logger.error('fail, this mind map is not editable');\n            return false;\n        }\n    }\n    update_node(node_id, topic) {\n        if (this.get_editable()) {\n            if (_util.text.is_empty(topic)) {\n                logger.warn('fail, topic can not be empty');\n                return;\n            }\n            var node = this.get_node(node_id);\n            if (!!node) {\n                if (node.topic === topic) {\n                    logger.info('nothing changed');\n                    this.view.update_node(node);\n                    return;\n                }\n                node.topic = topic;\n                this.view.update_node(node);\n                this.layout.layout();\n                this.view.show(false);\n                this.invoke_event_handle(EventType.edit, {\n                    evt: 'update_node',\n                    data: [node_id, topic],\n                    node: node_id,\n                });\n            }\n        } else {\n            logger.error('fail, this mind map is not editable');\n            return;\n        }\n    }\n    move_node(node_id, before_id, parent_id, direction) {\n        if (this.get_editable()) {\n            var node = this.get_node(node_id);\n            var updated_node = this.mind.move_node(node, before_id, parent_id, direction);\n            if (!!updated_node) {\n                this.view.update_node(updated_node);\n                this.layout.layout();\n                this.view.show(false);\n                this.invoke_event_handle(EventType.edit, {\n                    evt: 'move_node',\n                    data: [node_id, before_id, parent_id, direction],\n                    node: node_id,\n                });\n            }\n        } else {\n            logger.error('fail, this mind map is not editable');\n            return;\n        }\n    }\n    select_node(node) {\n        if (!Node.is_node(node)) {\n            var the_node = this.get_node(node);\n            if (!the_node) {\n                logger.error('the node[id=' + node + '] can not be found.');\n                return;\n            } else {\n                return this.select_node(the_node);\n            }\n        }\n        if (!this.layout.is_visible(node)) {\n            return;\n        }\n        this.mind.selected = node;\n        this.view.select_node(node);\n        this.invoke_event_handle(EventType.select, { evt: 'select_node', data: [], node: node.id });\n    }\n    get_selected_node() {\n        if (!!this.mind) {\n            return this.mind.selected;\n        } else {\n            return null;\n        }\n    }\n    select_clear() {\n        if (!!this.mind) {\n            this.mind.selected = null;\n            this.view.select_clear();\n        }\n    }\n    is_node_visible(node) {\n        return this.layout.is_visible(node);\n    }\n    find_node_before(node) {\n        if (!Node.is_node(node)) {\n            var the_node = this.get_node(node);\n            if (!the_node) {\n                logger.error('the node[id=' + node + '] can not be found.');\n                return;\n            } else {\n                return this.find_node_before(the_node);\n            }\n        }\n        if (node.isroot) {\n            return null;\n        }\n        var n = null;\n        if (node.parent.isroot) {\n            var c = node.parent.children;\n            var prev = null;\n            var ni = null;\n            for (var i = 0; i < c.length; i++) {\n                ni = c[i];\n                if (node.direction === ni.direction) {\n                    if (node.id === ni.id) {\n                        n = prev;\n                    }\n                    prev = ni;\n                }\n            }\n        } else {\n            n = this.mind.get_node_before(node);\n        }\n        return n;\n    }\n    find_node_after(node) {\n        if (!Node.is_node(node)) {\n            var the_node = this.get_node(node);\n            if (!the_node) {\n                logger.error('the node[id=' + node + '] can not be found.');\n                return;\n            } else {\n                return this.find_node_after(the_node);\n            }\n        }\n        if (node.isroot) {\n            return null;\n        }\n        var n = null;\n        if (node.parent.isroot) {\n            var c = node.parent.children;\n            var found = false;\n            var ni = null;\n            for (var i = 0; i < c.length; i++) {\n                ni = c[i];\n                if (node.direction === ni.direction) {\n                    if (found) {\n                        n = ni;\n                        break;\n                    }\n                    if (node.id === ni.id) {\n                        found = true;\n                    }\n                }\n            }\n        } else {\n            n = this.mind.get_node_after(node);\n        }\n        return n;\n    }\n    set_node_color(node_id, bg_color, fg_color) {\n        if (this.get_editable()) {\n            var node = this.mind.get_node(node_id);\n            if (!!node) {\n                if (!!bg_color) {\n                    node.data['background-color'] = bg_color;\n                }\n                if (!!fg_color) {\n                    node.data['foreground-color'] = fg_color;\n                }\n                this.view.reset_node_custom_style(node);\n            }\n        } else {\n            logger.error('fail, this mind map is not editable');\n            return null;\n        }\n    }\n    set_node_font_style(node_id, size, weight, style) {\n        if (this.get_editable()) {\n            var node = this.mind.get_node(node_id);\n            if (!!node) {\n                if (!!size) {\n                    node.data['font-size'] = size;\n                }\n                if (!!weight) {\n                    node.data['font-weight'] = weight;\n                }\n                if (!!style) {\n                    node.data['font-style'] = style;\n                }\n                this.view.reset_node_custom_style(node);\n                this.view.update_node(node);\n                this.layout.layout();\n                this.view.show(false);\n            }\n        } else {\n            logger.error('fail, this mind map is not editable');\n            return null;\n        }\n    }\n    set_node_background_image(node_id, image, width, height, rotation) {\n        if (this.get_editable()) {\n            var node = this.mind.get_node(node_id);\n            if (!!node) {\n                if (!!image) {\n                    node.data['background-image'] = image;\n                }\n                if (!!width) {\n                    node.data['width'] = width;\n                }\n                if (!!height) {\n                    node.data['height'] = height;\n                }\n                if (!!rotation) {\n                    node.data['background-rotation'] = rotation;\n                }\n                this.view.reset_node_custom_style(node);\n                this.view.update_node(node);\n                this.layout.layout();\n                this.view.show(false);\n            }\n        } else {\n            logger.error('fail, this mind map is not editable');\n            return null;\n        }\n    }\n    set_node_background_rotation(node_id, rotation) {\n        if (this.get_editable()) {\n            var node = this.mind.get_node(node_id);\n            if (!!node) {\n                if (!node.data['background-image']) {\n                    logger.error(\n                        'fail, only can change rotation angle of node with background image'\n                    );\n                    return null;\n                }\n                node.data['background-rotation'] = rotation;\n                this.view.reset_node_custom_style(node);\n                this.view.update_node(node);\n                this.layout.layout();\n                this.view.show(false);\n            }\n        } else {\n            logger.error('fail, this mind map is not editable');\n            return null;\n        }\n    }\n    resize() {\n        this.view.resize();\n    }\n    // callback(type ,data)\n    add_event_listener(callback) {\n        if (typeof callback === 'function') {\n            this.event_handles.push(callback);\n        }\n    }\n    clear_event_listener() {\n        this.event_handles = [];\n    }\n    invoke_event_handle(type, data) {\n        var j = this;\n        $.w.setTimeout(function () {\n            j._invoke_event_handle(type, data);\n        }, 0);\n    }\n    _invoke_event_handle(type, data) {\n        var l = this.event_handles.length;\n        for (var i = 0; i < l; i++) {\n            this.event_handles[i](type, data);\n        }\n    }\n\n    // quick way\n    static show(options, mind) {\n        var _jm = new jsMind(options);\n        _jm.show(mind);\n        return _jm;\n    }\n}\n"],"names":["__version__","__author__","String","prototype","startsWith","p","this","slice","length","Direction","left","center","right","EventType","show","resize","edit","select","LogLevel","debug","info","warn","error","disable","_noop","logger","console","level","log","log_level","$","constructor","w","d","document","g","id","getElementById","c","tag","createElement","t","n","hasChildNodes","firstChild","nodeValue","appendChild","createTextNode","h","HTMLElement","innerHTML","i","el","nodeType","style","ownerDocument","on","e","addEventListener","attachEvent","window","util","ajax","request","url","param","method","callback","fail_callback","Object","keys","map","k","encodeURIComponent","join","xhr","XMLHttpRequest","onreadystatechange","readyState","status","data","json","string2json","responseText","open","setRequestHeader","send","get","post","file","read","file_data","fn_callback","reader","FileReader","onload","result","name","readAsText","save","type","blob","Blob","bb","BlobBuilder","MozBlobBuilder","WebKitBlobBuilder","MSBlobBuilder","append","getBlob","navigator","msSaveBlob","blob_url","URL","webkitURL","createObjectURL","anchor","visibility","href","download","body","evt","createEvent","initEvent","dispatchEvent","removeChild","location","json2string","JSON","stringify","json_str","parse","merge","b","a","o","toString","call","toLowerCase","uuid","newid","Date","getTime","Math","random","substring","text","is_empty","s","replace","default_options","container","editable","theme","mode","support_html","view","engine","hmargin","vmargin","line_width","line_color","draggable","hide_scrollbars_when_draggable","layout","hspace","vspace","pspace","default_event_handle","enable_mousedown_handle","enable_click_handle","enable_dblclick_handle","enable_mousewheel_handle","shortcut","enable","handles","mapping","addchild","addbrother","editnode","delnode","toggle","up","down","Node","sId","iIndex","sTopic","oData","bIsRoot","oParent","eDirection","bExpanded","index","topic","isroot","parent","direction","expanded","children","_data","get_location","vd","x","abs_x","y","abs_y","get_size","width","height","static","node1","node2","i1","i2","parent_node","node","pid","Mind","author","version","root","selected","nodes","get_node","node_id","set_root","_put_node","add_node","idx","is_node","push","_update_index","insert_node_before","node_before","node_index","get_node_before","the_node","insert_node_after","node_after","get_node_after","move_node","before_id","parent_id","_move_node","_flow_node_direction","len","_move_node_internal","inherited","sibling","si","splice","remove_node","ci","sort","compare","format","node_tree","example","meta","get_mind","source","df","mind","_parse","get_data","_build_node","node_root","_extract_data","_extract_subnode","node_json","node_parent","node_data","node_array","_array","reverse","root_node","_extract_root","root_json","extract_count","parentid","node_direction","sub_extract_count","_array_node","freemind","xml","xml_doc","_parse_xml","xml_root","_find_root","_load_node","xml_lines","_build_map","DOMParser","parseFromString","ActiveXObject","async","loadXML","childNodes","tagName","ns","xml_node","getAttribute","node_topic","topic_children","topic_child","textContent","_load_attributes","node_expanded","node_position","child","attr","attr_data","pos","_line_regex","lines","split","_fill_nodes","node_path","line","match","substr","diff","pop","_build_lines","prefix","Array","DataProvider","jm","init","reset","load","mind_data","data_format","LayoutProvider","options","opts","isside","bounds","cache_valid","calculate_next_child_direction","children_len","r","layout_direction","layout_offset","_layout_direction_root","layout_data","children_count","side_index","_layout_direction_side","subnode","offset_x","offset_y","outer_height","left_nodes","right_nodes","unshift","outer_height_left","_layout_offset_subnodes","outer_height_right","max","total_height","nodes_count","node_outer_height","base_y","pd","set_visible","middle_height","_layout_offset_subnodes_height","get_node_offset","offset_cache","_offset_","offset_p","get_node_point","view_data","get_node_point_in","get_node_point_out","pout_cache","_pout_","get_expander_point","ex_p","ceil","get_min_size","pout","toggle_node","collapse_node","expand_node","part_layout","invoke_event_handle","expand_all","collapse_all","expand_to_depth","target_depth","curr_nodes","curr_depth","depth","root_layout_data","visible","is_expand","is_visible","SvgGraph","e_svg","setAttribute","size","createElementNS","element","set_size","clear","draw_line","pin","offset","color","_bezier_to","copy_to","dest_canvas_ctx","img","Image","drawImage","src","btoa","XMLSerializer","serializeToString","path","x1","y1","x2","y2","_line_to","CanvasGraph","e_canvas","className","canvas_ctx","getContext","clearRect","ctx","strokeStyle","lineWidth","lineCap","beginPath","moveTo","bezierCurveTo","stroke","lineTo","ViewProvider","e_panel","e_nodes","selected_node","editing_node","graph","_initialized","e_editor","tabIndex","actualZoom","zoomStep","minZoom","maxZoom","v","event","keyCode","edit_node_end","stopPropagation","add_event","obj","event_name","event_handle","get_binded_nodeid","parentElement","is_expander","clear_lines","clear_nodes","reset_theme","theme_name","reset_custom_style","nodeid","reset_node_custom_style","setup_canvas_draggable","init_nodes","expand_size","min_size","min_width","min_height","client_w","clientWidth","client_h","clientHeight","init_nodes_size","doc_frag","createDocumentFragment","create_node_element","d_e","expander","_reset_node_custom_style","update_node","origin_style","select_node","restore_selected_node_custom_style","clear_selected_node_custom_style","select_clear","get_editing_node","is_editing","edit_node_begin","ncs","getComputedStyle","value","parseInt","getPropertyValue","zIndex","focus","get_view_offset","_show","show_nodes","show_lines","zoomIn","setZoom","zoomOut","zoom","_center_root","outer_w","outer_h","_offset","scrollLeft","scrollTop","keep_center","relayout","save_location","_saved_location","top","restore_location","node_element","p_expander","expander_text","display","backgroundColor","fontSize","fontWeight","fontStyle","backgroundImage","scaledImageData","toDataURL","backgroundSize","transform","enabled","dragging","eventDown","clientX","clientY","eventMove","scrollBy","ShortcutProvider","_newid","_mapping","handle","handler","bind","handle_addchild","handle_addbrother","handle_editnode","handle_delnode","handle_toggle","handle_up","handle_down","handle_left","handle_right","isArray","key","id_generator","enable_shortcut","disable_shortcut","which","preventDefault","kc","metaKey","ctrlKey","altKey","shiftKey","_jm","get_selected_node","begin_edit","up_node","find_node_before","np","down_node","find_node_after","_handle_direction","floor","plugin_data","plugins","register","plugin","Plugin","Error","apply","setTimeout","l","fn_init","_apply","jsMind","_register_plugin","_util","current","merge_option","initialized","event_handles","opts_layout","opts_view","_event_bind","apply_plugins","get_editable","enable_edit","disable_edit","get_view_draggable","enable_view_draggable","disable_view_draggable","enable_event_handle","disable_event_handle","set_theme","theme_old","mousedown_handle","click_handle","dblclick_handle","mousewheel_handle","target","srcElement","deltaY","end_edit","_reset","m","get_meta","get_root","the_parent_node","the_node_before","the_node_after","updated_node","is_node_visible","prev","ni","found","set_node_color","bg_color","fg_color","set_node_font_style","weight","set_node_background_image","image","rotation","set_node_background_rotation","add_event_listener","clear_event_listener","j","_invoke_event_handle"],"mappings":"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"}