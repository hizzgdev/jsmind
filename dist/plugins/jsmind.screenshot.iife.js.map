{"version":3,"file":"jsmind.screenshot.iife.js","sources":["../../src/plugins/jsmind.screenshot.js"],"sourcesContent":["/**\r\n * @license BSD\r\n * @copyright 2014-2022 hizzgdev@163.com\r\n *\r\n * Project Home:\r\n *   https://github.com/hizzgdev/jsmind/\r\n */\r\n\r\nif (!jsMind) {\r\n    throw new Error('jsMind is not defined');\r\n}\r\n\r\nconst $ = jsMind.$;\r\n\r\nvar css = function (cStyle, property_name) {\r\n    return cStyle.getPropertyValue(property_name);\r\n};\r\nvar is_visible = function (cStyle) {\r\n    var visibility = css(cStyle, 'visibility');\r\n    var display = css(cStyle, 'display');\r\n    return visibility !== 'hidden' && display !== 'none';\r\n};\r\nvar jcanvas = {};\r\njcanvas.rect = function (ctx, x, y, w, h, r) {\r\n    if (w < 2 * r) r = w / 2;\r\n    if (h < 2 * r) r = h / 2;\r\n    ctx.moveTo(x + r, y);\r\n    ctx.arcTo(x + w, y, x + w, y + h, r);\r\n    ctx.arcTo(x + w, y + h, x, y + h, r);\r\n    ctx.arcTo(x, y + h, x, y, r);\r\n    ctx.arcTo(x, y, x + w, y, r);\r\n};\r\n\r\njcanvas.text_multiline = function (ctx, text, x, y, w, h, lineheight) {\r\n    var line = '';\r\n    var text_len = text.length;\r\n    var chars = text.split('');\r\n    var test_line = null;\r\n    ctx.textAlign = 'left';\r\n    ctx.textBaseline = 'top';\r\n    for (var i = 0; i < text_len; i++) {\r\n        test_line = line + chars[i];\r\n        if (ctx.measureText(test_line).width > w && i > 0) {\r\n            ctx.fillText(line, x, y);\r\n            line = chars[i];\r\n            y += lineheight;\r\n        } else {\r\n            line = test_line;\r\n        }\r\n    }\r\n    ctx.fillText(line, x, y);\r\n};\r\n\r\njcanvas.text_ellipsis = function (ctx, text, x, y, w, h) {\r\n    var center_y = y + h / 2;\r\n    var text = jcanvas.fittingString(ctx, text, w);\r\n    ctx.textAlign = 'left';\r\n    ctx.textBaseline = 'middle';\r\n    ctx.fillText(text, x, center_y, w);\r\n};\r\n\r\njcanvas.fittingString = function (ctx, text, max_width) {\r\n    var width = ctx.measureText(text).width;\r\n    var ellipsis = 'â€¦';\r\n    var ellipsis_width = ctx.measureText(ellipsis).width;\r\n    if (width <= max_width || width <= ellipsis_width) {\r\n        return text;\r\n    } else {\r\n        var len = text.length;\r\n        while (width >= max_width - ellipsis_width && len-- > 0) {\r\n            text = text.substring(0, len);\r\n            width = ctx.measureText(text).width;\r\n        }\r\n        return text + ellipsis;\r\n    }\r\n};\r\n\r\njcanvas.image = function (ctx, url, x, y, w, h, r, rotation, callback) {\r\n    var img = new Image();\r\n    img.onload = function () {\r\n        ctx.save();\r\n        ctx.translate(x, y);\r\n        ctx.save();\r\n        ctx.beginPath();\r\n        jcanvas.rect(ctx, 0, 0, w, h, r);\r\n        ctx.closePath();\r\n        ctx.clip();\r\n        ctx.translate(w / 2, h / 2);\r\n        ctx.rotate((rotation * Math.PI) / 180);\r\n        ctx.drawImage(img, -w / 2, -h / 2);\r\n        ctx.restore();\r\n        ctx.restore();\r\n        !!callback && callback();\r\n    };\r\n    img.src = url;\r\n};\r\n\r\nclass screenshot {\r\n    constructor(jm) {\r\n        this.jm = jm;\r\n        this.canvas_elem = null;\r\n        this.canvas_ctx = null;\r\n        this._inited = false;\r\n    }\r\n    init() {\r\n        if (this._inited) {\r\n            return;\r\n        }\r\n        console.log('init');\r\n        var c = $.c('canvas');\r\n        var ctx = c.getContext('2d');\r\n\r\n        this.canvas_elem = c;\r\n        this.canvas_ctx = ctx;\r\n        this.jm.view.e_panel.appendChild(c);\r\n        this._inited = true;\r\n        this.resize();\r\n    }\r\n    shoot(callback) {\r\n        this.init();\r\n        this._draw(\r\n            function () {\r\n                !!callback && callback();\r\n                this.clean();\r\n            }.bind(this)\r\n        );\r\n        this._watermark();\r\n    }\r\n    shootDownload() {\r\n        this.shoot(\r\n            function () {\r\n                this._download();\r\n            }.bind(this)\r\n        );\r\n    }\r\n    shootAsDataURL(callback) {\r\n        this.shoot(\r\n            function () {\r\n                !!callback && callback(this.canvas_elem.toDataURL());\r\n            }.bind(this)\r\n        );\r\n    }\r\n    resize() {\r\n        if (this._inited) {\r\n            this.canvas_elem.width = this.jm.view.size.w;\r\n            this.canvas_elem.height = this.jm.view.size.h;\r\n        }\r\n    }\r\n    clean() {\r\n        var c = this.canvas_elem;\r\n        this.canvas_ctx.clearRect(0, 0, c.width, c.height);\r\n    }\r\n    _draw(callback) {\r\n        var ctx = this.canvas_ctx;\r\n        ctx.textAlign = 'left';\r\n        ctx.textBaseline = 'top';\r\n        this._draw_lines(\r\n            function () {\r\n                this._draw_nodes(callback);\r\n            }.bind(this)\r\n        );\r\n    }\r\n    _watermark() {\r\n        var c = this.canvas_elem;\r\n        var ctx = this.canvas_ctx;\r\n        ctx.textAlign = 'right';\r\n        ctx.textBaseline = 'bottom';\r\n        ctx.fillStyle = '#000';\r\n        ctx.font = '11px Verdana,Arial,Helvetica,sans-serif';\r\n        ctx.fillText('hizzgdev.github.io/jsmind', c.width - 5.5, c.height - 2.5);\r\n        ctx.textAlign = 'left';\r\n        ctx.fillText($.w.location, 5.5, c.height - 2.5);\r\n    }\r\n    _draw_lines(callback) {\r\n        this.jm.view.graph.copy_to(this.canvas_ctx, callback);\r\n    }\r\n    _draw_nodes(callback) {\r\n        var nodes = this.jm.mind.nodes;\r\n        var node;\r\n        for (var nodeid in nodes) {\r\n            node = nodes[nodeid];\r\n            this._draw_node(node);\r\n        }\r\n\r\n        function check_nodes_ready() {\r\n            console.log('check_node_ready' + new Date());\r\n            var allOk = true;\r\n            for (var nodeid in nodes) {\r\n                node = nodes[nodeid];\r\n                allOk = allOk & node.ready;\r\n            }\r\n\r\n            if (!allOk) {\r\n                $.w.setTimeout(check_nodes_ready, 200);\r\n            } else {\r\n                $.w.setTimeout(callback, 200);\r\n            }\r\n        }\r\n        check_nodes_ready();\r\n    }\r\n    _draw_node(node) {\r\n        var ctx = this.canvas_ctx;\r\n        var view_data = node._data.view;\r\n        var node_element = view_data.element;\r\n        var ncs = getComputedStyle(node_element);\r\n        if (!is_visible(ncs)) {\r\n            node.ready = true;\r\n            return;\r\n        }\r\n\r\n        var bgcolor = css(ncs, 'background-color');\r\n        var round_radius = parseInt(css(ncs, 'border-top-left-radius'));\r\n        var color = css(ncs, 'color');\r\n        var padding_left = parseInt(css(ncs, 'padding-left'));\r\n        var padding_right = parseInt(css(ncs, 'padding-right'));\r\n        var padding_top = parseInt(css(ncs, 'padding-top'));\r\n        var padding_bottom = parseInt(css(ncs, 'padding-bottom'));\r\n        var text_overflow = css(ncs, 'text-overflow');\r\n        var font =\r\n            css(ncs, 'font-style') +\r\n            ' ' +\r\n            css(ncs, 'font-variant') +\r\n            ' ' +\r\n            css(ncs, 'font-weight') +\r\n            ' ' +\r\n            css(ncs, 'font-size') +\r\n            '/' +\r\n            css(ncs, 'line-height') +\r\n            ' ' +\r\n            css(ncs, 'font-family');\r\n\r\n        var rb = {\r\n            x: view_data.abs_x,\r\n            y: view_data.abs_y,\r\n            w: view_data.width + 1,\r\n            h: view_data.height + 1,\r\n        };\r\n        var tb = {\r\n            x: rb.x + padding_left,\r\n            y: rb.y + padding_top,\r\n            w: rb.w - padding_left - padding_right,\r\n            h: rb.h - padding_top - padding_bottom,\r\n        };\r\n\r\n        ctx.font = font;\r\n        ctx.fillStyle = bgcolor;\r\n        ctx.beginPath();\r\n        jcanvas.rect(ctx, rb.x, rb.y, rb.w, rb.h, round_radius);\r\n        ctx.closePath();\r\n        ctx.fill();\r\n\r\n        ctx.fillStyle = color;\r\n        if ('background-image' in node.data) {\r\n            var backgroundUrl = css(ncs, 'background-image').slice(5, -2);\r\n            node.ready = false;\r\n            var rotation = 0;\r\n            if ('background-rotation' in node.data) {\r\n                rotation = node.data['background-rotation'];\r\n            }\r\n            jcanvas.image(\r\n                ctx,\r\n                backgroundUrl,\r\n                rb.x,\r\n                rb.y,\r\n                rb.w,\r\n                rb.h,\r\n                round_radius,\r\n                rotation,\r\n                function () {\r\n                    node.ready = true;\r\n                }\r\n            );\r\n        }\r\n        if (!!node.topic) {\r\n            if (text_overflow === 'ellipsis') {\r\n                jcanvas.text_ellipsis(ctx, node.topic, tb.x, tb.y, tb.w, tb.h);\r\n            } else {\r\n                var line_height = parseInt(css(ncs, 'line-height'));\r\n                jcanvas.text_multiline(ctx, node.topic, tb.x, tb.y, tb.w, tb.h, line_height);\r\n            }\r\n        }\r\n        if (!!view_data.expander) {\r\n            this._draw_expander(view_data.expander);\r\n        }\r\n        if (!('background-image' in node.data)) {\r\n            node.ready = true;\r\n        }\r\n    }\r\n    _draw_expander(expander) {\r\n        var ctx = this.canvas_ctx;\r\n        var ncs = getComputedStyle(expander);\r\n        if (!is_visible(ncs)) {\r\n            return;\r\n        }\r\n\r\n        var style_left = css(ncs, 'left');\r\n        var style_top = css(ncs, 'top');\r\n        var font = css(ncs, 'font');\r\n        var left = parseInt(style_left);\r\n        var top = parseInt(style_top);\r\n        var is_plus = expander.innerHTML === '+';\r\n\r\n        ctx.lineWidth = 1;\r\n\r\n        ctx.beginPath();\r\n        ctx.arc(left + 7, top + 7, 5, 0, Math.PI * 2, true);\r\n        ctx.moveTo(left + 10, top + 7);\r\n        ctx.lineTo(left + 4, top + 7);\r\n        if (is_plus) {\r\n            ctx.moveTo(left + 7, top + 4);\r\n            ctx.lineTo(left + 7, top + 10);\r\n        }\r\n        ctx.closePath();\r\n        ctx.stroke();\r\n    }\r\n    _download() {\r\n        var c = this.canvas_elem;\r\n        var name = this.jm.mind.name + '.png';\r\n\r\n        if (navigator.msSaveBlob && !!c.msToBlob) {\r\n            var blob = c.msToBlob();\r\n            navigator.msSaveBlob(blob, name);\r\n        } else {\r\n            var bloburl = this.canvas_elem.toDataURL();\r\n            var anchor = $.c('a');\r\n            if ('download' in anchor) {\r\n                anchor.style.visibility = 'hidden';\r\n                anchor.href = bloburl;\r\n                anchor.download = name;\r\n                $.d.body.appendChild(anchor);\r\n                var evt = $.d.createEvent('MouseEvents');\r\n                evt.initEvent('click', true, true);\r\n                anchor.dispatchEvent(evt);\r\n                $.d.body.removeChild(anchor);\r\n            } else {\r\n                location.href = bloburl;\r\n            }\r\n        }\r\n    }\r\n    jm_event_handle(type, data) {\r\n        if (type === jsMind.event_type.resize) {\r\n            this.resize();\r\n        }\r\n    }\r\n}\r\n\r\nvar screenshot_plugin = new jsMind.plugin('screenshot', function (jm) {\r\n    var jss = new screenshot(jm);\r\n    jm.screenshot = jss;\r\n    jm.shoot = function () {\r\n        jss.shoot();\r\n    };\r\n    jm.add_event_listener(function (type, data) {\r\n        jss.jm_event_handle.call(jss, type, data);\r\n    });\r\n});\r\n\r\njsMind.register_plugin(screenshot_plugin);\r\n"],"names":["jsMind","Error","$","css","cStyle","property_name","getPropertyValue","is_visible","visibility","display","jcanvas","ctx","x","y","w","h","r","moveTo","arcTo","text","lineheight","line","text_len","length","chars","split","test_line","textAlign","textBaseline","i","measureText","width","fillText","center_y","fittingString","max_width","ellipsis_width","len","substring","url","rotation","callback","img","Image","onload","save","translate","beginPath","rect","closePath","clip","rotate","Math","PI","drawImage","restore","src","screenshot","constructor","jm","this","canvas_elem","canvas_ctx","_inited","init","console","log","c","getContext","view","e_panel","appendChild","resize","shoot","_draw","clean","bind","_watermark","shootDownload","_download","shootAsDataURL","toDataURL","size","height","clearRect","_draw_lines","_draw_nodes","fillStyle","font","location","graph","copy_to","node","nodes","mind","nodeid","_draw_node","check_nodes_ready","Date","allOk","ready","setTimeout","view_data","_data","node_element","element","ncs","getComputedStyle","bgcolor","round_radius","parseInt","color","padding_left","padding_right","padding_top","padding_bottom","text_overflow","rb","abs_x","abs_y","tb","fill","data","backgroundUrl","slice","image","topic","text_ellipsis","line_height","text_multiline","expander","_draw_expander","style_left","style_top","left","top","is_plus","innerHTML","lineWidth","arc","lineTo","stroke","name","navigator","msSaveBlob","msToBlob","blob","bloburl","anchor","style","href","download","d","body","evt","createEvent","initEvent","dispatchEvent","removeChild","jm_event_handle","type","event_type","screenshot_plugin","plugin","jss","add_event_listener","call","register_plugin"],"mappings":"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"}