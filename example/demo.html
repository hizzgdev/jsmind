<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>jsMind</title>
        <link type="text/css" rel="stylesheet" href="../style/jsmind.css" />
        <style type="text/css">
            #jsmind_container {
                width: 800px;
                height: 500px;
                border: solid 1px #ccc;
                /*background:#f4f4f4;*/
                background: #f4f4f4;
            }
        </style>
    </head>
    <body>
        <input type="file" onchange="load_file(this);" />
        <button onclick="save_nodetree();">nodetree</button>
        <button onclick="replay();">replay</button>
        <div id="jsmind_container"></div>
        <script type="text/javascript" src="../es6/jsmind.js"></script>
        <script type="text/javascript" src="../es6/jsmind.draggable-node.js"></script>
        <script type="text/javascript" src="../es6/jsmind.multiline-text.js"></script>
        <script type="text/javascript" src="../features/jsmind.shell.js"></script>
        <script type="text/javascript">
            var _jm = null;
            function load_jsmind() {
                var mind = {
                    meta: {
                        name: 'demo',
                        author: 'hizzgdev@163.com',
                        version: '0.2',
                    },
                    format: 'node_array',
                    data: [
                        { id: 'root', isroot: true, topic: 'jsMind\n多行文本支持' },

                        {
                            id: 'sub1',
                            parentid: 'root',
                            topic: '功能特性\n- 多行编辑\n- 自动换行\n- 拖拽支持',
                        },
                        { id: 'sub11', parentid: 'sub1', topic: '编辑方式\nCtrl+Enter 完成编辑' },
                        {
                            id: 'sub12',
                            parentid: 'sub1',
                            topic: '文本换行\n支持长文本自动换行显示',
                        },
                        { id: 'sub13', parentid: 'sub1', topic: '样式支持\n可自定义宽度和高度' },

                        { id: 'sub2', parentid: 'root', topic: '使用说明\n双击节点开始编辑' },
                        {
                            id: 'sub21',
                            parentid: 'sub2',
                            topic: '快捷键\nEsc: 取消编辑\nCtrl+Enter: 完成编辑',
                        },
                        {
                            id: 'sub22',
                            parentid: 'sub2',
                            topic: '拖拽功能\n可以拖拽节点到其他位置',
                        },

                        {
                            id: 'sub3',
                            parentid: 'root',
                            topic: '技术实现\n基于 contenteditable\n支持 HTML 内容',
                        },
                    ],
                };
                var options = {
                    container: 'jsmind_container',
                    editable: true,
                    theme: 'primary',
                    log_level: 'debug',
                    shortcut: {
                        handles: {
                            test: function (j, e) {
                                console.log(j);
                            },
                        },
                        mapping: {
                            test: 89,
                        },
                    },
                    view: {
                        expander_style: 'char',
                    },
                };
                _jm = new jsMind(options);
                _jm.show(mind);
                // jm.set_readonly(true);
                // var mind_data = jm.get_data();
                // alert(mind_data);
            }

            function load_file(fi) {
                var files = fi.files;
                if (files.length > 0) {
                    var file_data = files[0];
                    jsMind.util.file.read(file_data, function (freemind_data, jsmind_name) {
                        var mind = jsmind_data;
                        if (!!mind) {
                            _jm.show(mind);
                        } else {
                            console.error('can not open this file as mindmap');
                        }
                    });
                }
            }

            function save_nodetree() {
                var mind_data = _jm.get_data('node_tree');
                console.log(mind_data);
            }

            function replay() {
                var shell = _jm.shell;
                if (!!shell) {
                    shell.replay();
                }
            }

            load_jsmind();
        </script>
    </body>
</html>
