{"version":3,"file":"jsmind.draggable.iife.js","sources":["../../src/jsmind.common.js","../../src/jsmind.dom.js","../../src/jsmind.util.js","../../src/jsmind.option.js","../../src/jsmind.node.js","../../src/jsmind.mind.js","../../src/jsmind.format.js","../../src/jsmind.data_provider.js","../../src/jsmind.layout_provider.js","../../src/jsmind.graph.js","../../src/jsmind.view_provider.js","../../src/jsmind.shortcut_provider.js","../../src/jsmind.plugin.js","../../src/jsmind.plugins.ts","../../src/jsmind.js","../../src/plugins/jsmind.draggable.js"],"sourcesContent":["/**\r\n * @license BSD\r\n * @copyright 2014-2022 hizzgdev@163.com\r\n *\r\n * Project Home:\r\n *   https://github.com/hizzgdev/jsmind/\r\n */\r\n\r\nexport const __version__ = '0.4.9';\r\nexport const __author__ = 'hizzgdev@163.com';\r\n\r\nif (typeof String.prototype.startsWith != 'function') {\r\n    String.prototype.startsWith = function (p) {\r\n        return this.slice(0, p.length) === p;\r\n    };\r\n}\r\n\r\n// an noop function define\r\nvar _noop = function () {};\r\nexport let logger =\r\n    typeof console === 'undefined'\r\n        ? {\r\n              log: _noop,\r\n              debug: _noop,\r\n              error: _noop,\r\n              warn: _noop,\r\n              info: _noop,\r\n          }\r\n        : console;\r\n\r\nexport const Direction = { left: -1, center: 0, right: 1 };\r\nexport const EventType = { show: 1, resize: 2, edit: 3, select: 4 };\r\nexport const Key = { meta: 1 << 13, ctrl: 1 << 12, alt: 1 << 11, shift: 1 << 10 };\r\n","/**\r\n * @license BSD\r\n * @copyright 2014-2022 hizzgdev@163.com\r\n *\r\n * Project Home:\r\n *   https://github.com/hizzgdev/jsmind/\r\n */\r\n\r\nclass Dom {\r\n    constructor(w) {\r\n        this.w = w;\r\n        this.d = w.document;\r\n        this.g = function (id) {\r\n            return this.d.getElementById(id);\r\n        };\r\n        this.c = function (tag) {\r\n            return this.d.createElement(tag);\r\n        };\r\n        this.t = function (n, t) {\r\n            if (n.hasChildNodes()) {\r\n                n.firstChild.nodeValue = t;\r\n            } else {\r\n                n.appendChild(this.d.createTextNode(t));\r\n            }\r\n        };\r\n\r\n        this.h = function (n, t) {\r\n            if (t instanceof HTMLElement) {\r\n                n.innerHTML = '';\r\n                n.appendChild(t);\r\n            } else {\r\n                n.innerHTML = t;\r\n            }\r\n        };\r\n        // detect isElement\r\n        this.i = function (el) {\r\n            return (\r\n                !!el &&\r\n                typeof el === 'object' &&\r\n                el.nodeType === 1 &&\r\n                typeof el.style === 'object' &&\r\n                typeof el.ownerDocument === 'object'\r\n            );\r\n        };\r\n\r\n        //target,eventType,handler\r\n        this.on = function (t, e, h) {\r\n            if (!!t.addEventListener) {\r\n                t.addEventListener(e, h, false);\r\n            } else {\r\n                t.attachEvent('on' + e, h);\r\n            }\r\n        };\r\n    }\r\n}\r\n\r\nexport const $ = new Dom(window);\r\n","/**\r\n * @license BSD\r\n * @copyright 2014-2022 hizzgdev@163.com\r\n *\r\n * Project Home:\r\n *   https://github.com/hizzgdev/jsmind/\r\n */\r\n\r\nimport { $ } from './jsmind.dom.js';\r\nimport { logger } from './jsmind.common.js';\r\n\r\nexport const util = {\r\n    ajax: {\r\n        request: function (url, param, method, callback, fail_callback) {\r\n            var p = Object.keys(param)\r\n                .map(k => encodeURIComponent(k) + '=' + encodeURIComponent(param[k]))\r\n                .join('&');\r\n            var xhr = new XMLHttpRequest();\r\n            if (!xhr) {\r\n                return;\r\n            }\r\n            xhr.onreadystatechange = function () {\r\n                if (xhr.readyState == 4) {\r\n                    if (xhr.status == 200 || xhr.status == 0) {\r\n                        if (typeof callback === 'function') {\r\n                            var data = util.json.string2json(xhr.responseText);\r\n                            if (data != null) {\r\n                                callback(data);\r\n                            } else {\r\n                                callback(xhr.responseText);\r\n                            }\r\n                        }\r\n                    } else {\r\n                        if (typeof fail_callback === 'function') {\r\n                            fail_callback(xhr);\r\n                        } else {\r\n                            logger.error('xhr request failed.', xhr);\r\n                        }\r\n                    }\r\n                }\r\n            };\r\n            method = method || 'GET';\r\n            xhr.open(method, url, true);\r\n            xhr.setRequestHeader('If-Modified-Since', '0');\r\n            if (method == 'POST') {\r\n                xhr.setRequestHeader(\r\n                    'Content-Type',\r\n                    'application/x-www-form-urlencoded;charset=utf-8'\r\n                );\r\n                xhr.send(p);\r\n            } else {\r\n                xhr.send();\r\n            }\r\n        },\r\n        get: function (url, callback) {\r\n            return util.ajax.request(url, {}, 'GET', callback);\r\n        },\r\n        post: function (url, param, callback) {\r\n            return util.ajax.request(url, param, 'POST', callback);\r\n        },\r\n    },\r\n\r\n    file: {\r\n        read: function (file_data, fn_callback) {\r\n            var reader = new FileReader();\r\n            reader.onload = function () {\r\n                if (typeof fn_callback === 'function') {\r\n                    fn_callback(this.result, file_data.name);\r\n                }\r\n            };\r\n            reader.readAsText(file_data);\r\n        },\r\n\r\n        save: function (file_data, type, name) {\r\n            var blob;\r\n            if (typeof $.w.Blob === 'function') {\r\n                blob = new Blob([file_data], { type: type });\r\n            } else {\r\n                var BlobBuilder =\r\n                    $.w.BlobBuilder ||\r\n                    $.w.MozBlobBuilder ||\r\n                    $.w.WebKitBlobBuilder ||\r\n                    $.w.MSBlobBuilder;\r\n                var bb = new BlobBuilder();\r\n                bb.append(file_data);\r\n                blob = bb.getBlob(type);\r\n            }\r\n            if (navigator.msSaveBlob) {\r\n                navigator.msSaveBlob(blob, name);\r\n            } else {\r\n                var URL = $.w.URL || $.w.webkitURL;\r\n                var blob_url = URL.createObjectURL(blob);\r\n                var anchor = $.c('a');\r\n                if ('download' in anchor) {\r\n                    anchor.style.visibility = 'hidden';\r\n                    anchor.href = blob_url;\r\n                    anchor.download = name;\r\n                    $.d.body.appendChild(anchor);\r\n                    var evt = $.d.createEvent('MouseEvents');\r\n                    evt.initEvent('click', true, true);\r\n                    anchor.dispatchEvent(evt);\r\n                    $.d.body.removeChild(anchor);\r\n                } else {\r\n                    location.href = blob_url;\r\n                }\r\n            }\r\n        },\r\n    },\r\n\r\n    json: {\r\n        json2string: function (json) {\r\n            return JSON.stringify(json);\r\n        },\r\n        string2json: function (json_str) {\r\n            return JSON.parse(json_str);\r\n        },\r\n        merge: function (b, a) {\r\n            for (var o in a) {\r\n                if (o in b) {\r\n                    if (\r\n                        typeof b[o] === 'object' &&\r\n                        Object.prototype.toString.call(b[o]).toLowerCase() == '[object object]' &&\r\n                        !b[o].length\r\n                    ) {\r\n                        util.json.merge(b[o], a[o]);\r\n                    } else {\r\n                        b[o] = a[o];\r\n                    }\r\n                } else {\r\n                    b[o] = a[o];\r\n                }\r\n            }\r\n            return b;\r\n        },\r\n    },\r\n\r\n    uuid: {\r\n        newid: function () {\r\n            return (\r\n                new Date().getTime().toString(16) + Math.random().toString(16).substring(2)\r\n            ).substring(2, 18);\r\n        },\r\n    },\r\n\r\n    text: {\r\n        is_empty: function (s) {\r\n            if (!s) {\r\n                return true;\r\n            }\r\n            return s.replace(/\\s*/, '').length == 0;\r\n        },\r\n    },\r\n};\r\n","/**\r\n * @license BSD\r\n * @copyright 2014-2022 hizzgdev@163.com\r\n *\r\n * Project Home:\r\n *   https://github.com/hizzgdev/jsmind/\r\n */\r\n\r\nimport { util } from './jsmind.util.js';\r\n\r\nconst default_options = {\r\n    container: '', // id of the container\r\n    editable: false, // you can change it in your options\r\n    theme: null,\r\n    mode: 'full', // full or side\r\n    support_html: true,\r\n\r\n    view: {\r\n        engine: 'canvas',\r\n        hmargin: 100,\r\n        vmargin: 50,\r\n        line_width: 2,\r\n        line_color: '#555',\r\n        draggable: false, // drag the mind map with your mouse, when it's larger that the container\r\n        hide_scrollbars_when_draggable: false, // hide container scrollbars, when mind map is larger than container and draggable option is true.\r\n    },\r\n    layout: {\r\n        hspace: 30,\r\n        vspace: 20,\r\n        pspace: 13,\r\n    },\r\n    default_event_handle: {\r\n        enable_mousedown_handle: true,\r\n        enable_click_handle: true,\r\n        enable_dblclick_handle: true,\r\n        enable_mousewheel_handle: true,\r\n    },\r\n    shortcut: {\r\n        enable: true,\r\n        handles: {},\r\n        mapping: {\r\n            addchild: 45, // Insert\r\n            addbrother: 13, // Enter\r\n            editnode: 113, // F2\r\n            delnode: 46, // Delete\r\n            toggle: 32, // Space\r\n            left: 37, // Left\r\n            up: 38, // Up\r\n            right: 39, // Right\r\n            down: 40, // Down\r\n        },\r\n    },\r\n};\r\n\r\nexport function merge_option(options) {\r\n    var opts = {};\r\n    util.json.merge(opts, default_options);\r\n    util.json.merge(opts, options);\r\n\r\n    if (!opts.container) {\r\n        throw new Error('the options.container should not be null or empty.');\r\n    }\r\n    return opts;\r\n}\r\n","/**\r\n * @license BSD\r\n * @copyright 2014-2022 hizzgdev@163.com\r\n *\r\n * Project Home:\r\n *   https://github.com/hizzgdev/jsmind/\r\n */\r\n\r\nimport { logger } from './jsmind.common.js';\r\nexport class Node {\r\n    constructor(sId, iIndex, sTopic, oData, bIsRoot, oParent, eDirection, bExpanded) {\r\n        if (!sId) {\r\n            logger.error('invalid node id');\r\n            return;\r\n        }\r\n        if (typeof iIndex != 'number') {\r\n            logger.error('invalid node index');\r\n            return;\r\n        }\r\n        if (typeof bExpanded === 'undefined') {\r\n            bExpanded = true;\r\n        }\r\n        this.id = sId;\r\n        this.index = iIndex;\r\n        this.topic = sTopic;\r\n        this.data = oData || {};\r\n        this.isroot = bIsRoot;\r\n        this.parent = oParent;\r\n        this.direction = eDirection;\r\n        this.expanded = !!bExpanded;\r\n        this.children = [];\r\n        this._data = {};\r\n    }\r\n\r\n    get_location() {\r\n        var vd = this._data.view;\r\n        return {\r\n            x: vd.abs_x,\r\n            y: vd.abs_y,\r\n        };\r\n    }\r\n    get_size() {\r\n        var vd = this._data.view;\r\n        return {\r\n            w: vd.width,\r\n            h: vd.height,\r\n        };\r\n    }\r\n\r\n    static compare(node1, node2) {\r\n        // '-1' is always the latest\r\n        var r = 0;\r\n        var i1 = node1.index;\r\n        var i2 = node2.index;\r\n        if (i1 >= 0 && i2 >= 0) {\r\n            r = i1 - i2;\r\n        } else if (i1 == -1 && i2 == -1) {\r\n            r = 0;\r\n        } else if (i1 == -1) {\r\n            r = 1;\r\n        } else if (i2 == -1) {\r\n            r = -1;\r\n        } else {\r\n            r = 0;\r\n        }\r\n        return r;\r\n    }\r\n    static inherited(parent_node, node) {\r\n        if (!!parent_node && !!node) {\r\n            if (parent_node.id === node.id) {\r\n                return true;\r\n            }\r\n            if (parent_node.isroot) {\r\n                return true;\r\n            }\r\n            var pid = parent_node.id;\r\n            var p = node;\r\n            while (!p.isroot) {\r\n                p = p.parent;\r\n                if (p.id === pid) {\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n    static is_node(n) {\r\n        return !!n && n instanceof Node;\r\n    }\r\n}\r\n","/**\r\n * @license BSD\r\n * @copyright 2014-2022 hizzgdev@163.com\r\n *\r\n * Project Home:\r\n *   https://github.com/hizzgdev/jsmind/\r\n */\r\n\r\nimport { Node } from './jsmind.node.js';\r\nimport { logger, Direction } from './jsmind.common.js';\r\n\r\nexport class Mind {\r\n    constructor() {\r\n        this.name = null;\r\n        this.author = null;\r\n        this.version = null;\r\n        this.root = null;\r\n        this.selected = null;\r\n        this.nodes = {};\r\n    }\r\n    get_node(node_id) {\r\n        if (node_id in this.nodes) {\r\n            return this.nodes[node_id];\r\n        } else {\r\n            logger.warn('the node[id=' + node_id + '] can not be found');\r\n            return null;\r\n        }\r\n    }\r\n    set_root(node_id, topic, data) {\r\n        if (this.root == null) {\r\n            this.root = new Node(node_id, 0, topic, data, true);\r\n            this._put_node(this.root);\r\n            return this.root;\r\n        } else {\r\n            logger.error('root node is already exist');\r\n            return null;\r\n        }\r\n    }\r\n    add_node(parent_node, node_id, topic, data, direction, expanded, idx) {\r\n        if (!Node.is_node(parent_node)) {\r\n            logger.error('the parent_node ' + parent_node + ' is not a node.');\r\n            return null;\r\n        }\r\n        var node_index = idx || -1;\r\n        var node = new Node(\r\n            node_id,\r\n            node_index,\r\n            topic,\r\n            data,\r\n            false,\r\n            parent_node,\r\n            parent_node.direction,\r\n            expanded\r\n        );\r\n        if (parent_node.isroot) {\r\n            node.direction = direction || Direction.right;\r\n        }\r\n        if (this._put_node(node)) {\r\n            parent_node.children.push(node);\r\n            this._update_index(parent_node);\r\n        } else {\r\n            logger.error(\"fail, the node id '\" + node.id + \"' has been already exist.\");\r\n            node = null;\r\n        }\r\n        return node;\r\n    }\r\n    insert_node_before(node_before, node_id, topic, data, direction) {\r\n        if (!Node.is_node(node_before)) {\r\n            logger.error('the node_before ' + node_before + ' is not a node.');\r\n            return null;\r\n        }\r\n        var node_index = node_before.index - 0.5;\r\n        return this.add_node(node_before.parent, node_id, topic, data, direction, true, node_index);\r\n    }\r\n    get_node_before(node) {\r\n        if (!Node.is_node(node)) {\r\n            var the_node = this.get_node(node);\r\n            if (!the_node) {\r\n                logger.error('the node[id=' + node + '] can not be found.');\r\n                return null;\r\n            } else {\r\n                return this.get_node_before(the_node);\r\n            }\r\n        }\r\n        if (node.isroot) {\r\n            return null;\r\n        }\r\n        var idx = node.index - 2;\r\n        if (idx >= 0) {\r\n            return node.parent.children[idx];\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n    insert_node_after(node_after, node_id, topic, data, direction) {\r\n        if (!Node.is_node(node_after)) {\r\n            logger.error('the node_after ' + node_after + ' is not a node.');\r\n            return null;\r\n        }\r\n        var node_index = node_after.index + 0.5;\r\n        return this.add_node(node_after.parent, node_id, topic, data, direction, true, node_index);\r\n    }\r\n    get_node_after(node) {\r\n        if (!Node.is_node(node)) {\r\n            var the_node = this.get_node(node);\r\n            if (!the_node) {\r\n                logger.error('the node[id=' + node + '] can not be found.');\r\n                return null;\r\n            } else {\r\n                return this.get_node_after(the_node);\r\n            }\r\n        }\r\n        if (node.isroot) {\r\n            return null;\r\n        }\r\n        var idx = node.index;\r\n        var brothers = node.parent.children;\r\n        if (brothers.length > idx) {\r\n            return node.parent.children[idx];\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n    move_node(node, before_id, parent_id, direction) {\r\n        if (!Node.is_node(node)) {\r\n            logger.error('the parameter node ' + node + ' is not a node.');\r\n            return null;\r\n        }\r\n        if (!parent_id) {\r\n            parent_id = node.parent.id;\r\n        }\r\n        return this._move_node(node, before_id, parent_id, direction);\r\n    }\r\n    _flow_node_direction(node, direction) {\r\n        if (typeof direction === 'undefined') {\r\n            direction = node.direction;\r\n        } else {\r\n            node.direction = direction;\r\n        }\r\n        var len = node.children.length;\r\n        while (len--) {\r\n            this._flow_node_direction(node.children[len], direction);\r\n        }\r\n    }\r\n    _move_node_internal(node, before_id) {\r\n        if (!!node && !!before_id) {\r\n            if (before_id == '_last_') {\r\n                node.index = -1;\r\n                this._update_index(node.parent);\r\n            } else if (before_id == '_first_') {\r\n                node.index = 0;\r\n                this._update_index(node.parent);\r\n            } else {\r\n                var node_before = !!before_id ? this.get_node(before_id) : null;\r\n                if (\r\n                    node_before != null &&\r\n                    node_before.parent != null &&\r\n                    node_before.parent.id == node.parent.id\r\n                ) {\r\n                    node.index = node_before.index - 0.5;\r\n                    this._update_index(node.parent);\r\n                }\r\n            }\r\n        }\r\n        return node;\r\n    }\r\n    _move_node(node, before_id, parent_id, direction) {\r\n        if (!!node && !!parent_id) {\r\n            var parent_node = this.get_node(parent_id);\r\n            if (Node.inherited(node, parent_node)) {\r\n                logger.error('can not move a node to its children');\r\n                return null;\r\n            }\r\n            if (node.parent.id != parent_id) {\r\n                // remove from parent's children\r\n                var sibling = node.parent.children;\r\n                var si = sibling.length;\r\n                while (si--) {\r\n                    if (sibling[si].id == node.id) {\r\n                        sibling.splice(si, 1);\r\n                        break;\r\n                    }\r\n                }\r\n                node.parent = parent_node;\r\n                parent_node.children.push(node);\r\n            }\r\n\r\n            if (node.parent.isroot) {\r\n                if (direction == Direction.left) {\r\n                    node.direction = direction;\r\n                } else {\r\n                    node.direction = Direction.right;\r\n                }\r\n            } else {\r\n                node.direction = node.parent.direction;\r\n            }\r\n            this._move_node_internal(node, before_id);\r\n            this._flow_node_direction(node);\r\n        }\r\n        return node;\r\n    }\r\n    remove_node(node) {\r\n        if (!Node.is_node(node)) {\r\n            logger.error('the parameter node ' + node + ' is not a node.');\r\n            return false;\r\n        }\r\n        if (node.isroot) {\r\n            logger.error('fail, can not remove root node');\r\n            return false;\r\n        }\r\n        if (this.selected != null && this.selected.id == node.id) {\r\n            this.selected = null;\r\n        }\r\n        // clean all subordinate nodes\r\n        var children = node.children;\r\n        var ci = children.length;\r\n        while (ci--) {\r\n            this.remove_node(children[ci]);\r\n        }\r\n        // clean all children\r\n        children.length = 0;\r\n        // remove from parent's children\r\n        var sibling = node.parent.children;\r\n        var si = sibling.length;\r\n        while (si--) {\r\n            if (sibling[si].id == node.id) {\r\n                sibling.splice(si, 1);\r\n                break;\r\n            }\r\n        }\r\n        // remove from global nodes\r\n        delete this.nodes[node.id];\r\n        // clean all properties\r\n        for (var k in node) {\r\n            delete node[k];\r\n        }\r\n        // remove it's self\r\n        node = null;\r\n        //delete node;\r\n        return true;\r\n    }\r\n    _put_node(node) {\r\n        if (node.id in this.nodes) {\r\n            logger.warn(\"the node_id '\" + node.id + \"' has been already exist.\");\r\n            return false;\r\n        } else {\r\n            this.nodes[node.id] = node;\r\n            return true;\r\n        }\r\n    }\r\n    _update_index(node) {\r\n        if (node instanceof Node) {\r\n            node.children.sort(Node.compare);\r\n            for (var i = 0; i < node.children.length; i++) {\r\n                node.children[i].index = i + 1;\r\n            }\r\n        }\r\n    }\r\n}\r\n","/**\r\n * @license BSD\r\n * @copyright 2014-2022 hizzgdev@163.com\r\n *\r\n * Project Home:\r\n *   https://github.com/hizzgdev/jsmind/\r\n */\r\n\r\nimport { __author__, __version__, logger, Direction } from './jsmind.common.js';\r\nimport { Mind } from './jsmind.mind.js';\r\nimport { Node } from './jsmind.node.js';\r\n\r\nexport const format = {\r\n    node_tree: {\r\n        example: {\r\n            meta: {\r\n                name: 'jsMind node_tree simple',\r\n                author: __author__,\r\n                version: __version__,\r\n            },\r\n            format: 'node_tree',\r\n            data: { id: 'root', topic: 'jsMind Example' },\r\n        },\r\n        get_mind: function (source) {\r\n            var df = format.node_tree;\r\n            var mind = new Mind();\r\n            mind.name = source.meta.name;\r\n            mind.author = source.meta.author;\r\n            mind.version = source.meta.version;\r\n            df._parse(mind, source.data);\r\n            return mind;\r\n        },\r\n        get_data: function (mind) {\r\n            var df = format.node_tree;\r\n            var json = {};\r\n            json.meta = {\r\n                name: mind.name,\r\n                author: mind.author,\r\n                version: mind.version,\r\n            };\r\n            json.format = 'node_tree';\r\n            json.data = df._build_node(mind.root);\r\n            return json;\r\n        },\r\n\r\n        _parse: function (mind, node_root) {\r\n            var df = format.node_tree;\r\n            var data = df._extract_data(node_root);\r\n            mind.set_root(node_root.id, node_root.topic, data);\r\n            if ('children' in node_root) {\r\n                var children = node_root.children;\r\n                for (var i = 0; i < children.length; i++) {\r\n                    df._extract_subnode(mind, mind.root, children[i]);\r\n                }\r\n            }\r\n        },\r\n\r\n        _extract_data: function (node_json) {\r\n            var data = {};\r\n            for (var k in node_json) {\r\n                if (\r\n                    k == 'id' ||\r\n                    k == 'topic' ||\r\n                    k == 'children' ||\r\n                    k == 'direction' ||\r\n                    k == 'expanded'\r\n                ) {\r\n                    continue;\r\n                }\r\n                data[k] = node_json[k];\r\n            }\r\n            return data;\r\n        },\r\n\r\n        _extract_subnode: function (mind, node_parent, node_json) {\r\n            var df = format.node_tree;\r\n            var data = df._extract_data(node_json);\r\n            var d = null;\r\n            if (node_parent.isroot) {\r\n                d = node_json.direction == 'left' ? Direction.left : Direction.right;\r\n            }\r\n            var node = mind.add_node(\r\n                node_parent,\r\n                node_json.id,\r\n                node_json.topic,\r\n                data,\r\n                d,\r\n                node_json.expanded\r\n            );\r\n            if (!!node_json['children']) {\r\n                var children = node_json.children;\r\n                for (var i = 0; i < children.length; i++) {\r\n                    df._extract_subnode(mind, node, children[i]);\r\n                }\r\n            }\r\n        },\r\n\r\n        _build_node: function (node) {\r\n            var df = format.node_tree;\r\n            if (!(node instanceof Node)) {\r\n                return;\r\n            }\r\n            var o = {\r\n                id: node.id,\r\n                topic: node.topic,\r\n                expanded: node.expanded,\r\n            };\r\n            if (!!node.parent && node.parent.isroot) {\r\n                o.direction = node.direction == Direction.left ? 'left' : 'right';\r\n            }\r\n            if (node.data != null) {\r\n                var node_data = node.data;\r\n                for (var k in node_data) {\r\n                    o[k] = node_data[k];\r\n                }\r\n            }\r\n            var children = node.children;\r\n            if (children.length > 0) {\r\n                o.children = [];\r\n                for (var i = 0; i < children.length; i++) {\r\n                    o.children.push(df._build_node(children[i]));\r\n                }\r\n            }\r\n            return o;\r\n        },\r\n    },\r\n\r\n    node_array: {\r\n        example: {\r\n            meta: {\r\n                name: 'jsMind node_array simple',\r\n                author: __author__,\r\n                version: __version__,\r\n            },\r\n            format: 'node_array',\r\n            data: [{ id: 'root', topic: 'jsMind Example', isroot: true }],\r\n        },\r\n\r\n        get_mind: function (source) {\r\n            var df = format.node_array;\r\n            var mind = new Mind();\r\n            mind.name = source.meta.name;\r\n            mind.author = source.meta.author;\r\n            mind.version = source.meta.version;\r\n            df._parse(mind, source.data);\r\n            return mind;\r\n        },\r\n\r\n        get_data: function (mind) {\r\n            var df = format.node_array;\r\n            var json = {};\r\n            json.meta = {\r\n                name: mind.name,\r\n                author: mind.author,\r\n                version: mind.version,\r\n            };\r\n            json.format = 'node_array';\r\n            json.data = [];\r\n            df._array(mind, json.data);\r\n            return json;\r\n        },\r\n\r\n        _parse: function (mind, node_array) {\r\n            var df = format.node_array;\r\n            var nodes = node_array.slice(0);\r\n            // reverse array for improving looping performance\r\n            nodes.reverse();\r\n            var root_node = df._extract_root(mind, nodes);\r\n            if (!!root_node) {\r\n                df._extract_subnode(mind, root_node, nodes);\r\n            } else {\r\n                logger.error('root node can not be found');\r\n            }\r\n        },\r\n\r\n        _extract_root: function (mind, node_array) {\r\n            var df = format.node_array;\r\n            var i = node_array.length;\r\n            while (i--) {\r\n                if ('isroot' in node_array[i] && node_array[i].isroot) {\r\n                    var root_json = node_array[i];\r\n                    var data = df._extract_data(root_json);\r\n                    var node = mind.set_root(root_json.id, root_json.topic, data);\r\n                    node_array.splice(i, 1);\r\n                    return node;\r\n                }\r\n            }\r\n            return null;\r\n        },\r\n\r\n        _extract_subnode: function (mind, parent_node, node_array) {\r\n            var df = format.node_array;\r\n            var i = node_array.length;\r\n            var node_json = null;\r\n            var data = null;\r\n            var extract_count = 0;\r\n            while (i--) {\r\n                node_json = node_array[i];\r\n                if (node_json.parentid == parent_node.id) {\r\n                    data = df._extract_data(node_json);\r\n                    var d = null;\r\n                    var node_direction = node_json.direction;\r\n                    if (!!node_direction) {\r\n                        d = node_direction == 'left' ? Direction.left : Direction.right;\r\n                    }\r\n                    var node = mind.add_node(\r\n                        parent_node,\r\n                        node_json.id,\r\n                        node_json.topic,\r\n                        data,\r\n                        d,\r\n                        node_json.expanded\r\n                    );\r\n                    node_array.splice(i, 1);\r\n                    extract_count++;\r\n                    var sub_extract_count = df._extract_subnode(mind, node, node_array);\r\n                    if (sub_extract_count > 0) {\r\n                        // reset loop index after extract subordinate node\r\n                        i = node_array.length;\r\n                        extract_count += sub_extract_count;\r\n                    }\r\n                }\r\n            }\r\n            return extract_count;\r\n        },\r\n\r\n        _extract_data: function (node_json) {\r\n            var data = {};\r\n            for (var k in node_json) {\r\n                if (\r\n                    k == 'id' ||\r\n                    k == 'topic' ||\r\n                    k == 'parentid' ||\r\n                    k == 'isroot' ||\r\n                    k == 'direction' ||\r\n                    k == 'expanded'\r\n                ) {\r\n                    continue;\r\n                }\r\n                data[k] = node_json[k];\r\n            }\r\n            return data;\r\n        },\r\n\r\n        _array: function (mind, node_array) {\r\n            var df = format.node_array;\r\n            df._array_node(mind.root, node_array);\r\n        },\r\n\r\n        _array_node: function (node, node_array) {\r\n            var df = format.node_array;\r\n            if (!(node instanceof Node)) {\r\n                return;\r\n            }\r\n            var o = {\r\n                id: node.id,\r\n                topic: node.topic,\r\n                expanded: node.expanded,\r\n            };\r\n            if (!!node.parent) {\r\n                o.parentid = node.parent.id;\r\n            }\r\n            if (node.isroot) {\r\n                o.isroot = true;\r\n            }\r\n            if (!!node.parent && node.parent.isroot) {\r\n                o.direction = node.direction == Direction.left ? 'left' : 'right';\r\n            }\r\n            if (node.data != null) {\r\n                var node_data = node.data;\r\n                for (var k in node_data) {\r\n                    o[k] = node_data[k];\r\n                }\r\n            }\r\n            node_array.push(o);\r\n            var ci = node.children.length;\r\n            for (var i = 0; i < ci; i++) {\r\n                df._array_node(node.children[i], node_array);\r\n            }\r\n        },\r\n    },\r\n\r\n    freemind: {\r\n        example: {\r\n            meta: {\r\n                name: 'jsMind freemind example',\r\n                author: __author__,\r\n                version: __version__,\r\n            },\r\n            format: 'freemind',\r\n            data: '<map version=\"1.0.1\"><node ID=\"root\" TEXT=\"freemind Example\"/></map>',\r\n        },\r\n        get_mind: function (source) {\r\n            var df = format.freemind;\r\n            var mind = new Mind();\r\n            mind.name = source.meta.name;\r\n            mind.author = source.meta.author;\r\n            mind.version = source.meta.version;\r\n            var xml = source.data;\r\n            var xml_doc = df._parse_xml(xml);\r\n            var xml_root = df._find_root(xml_doc);\r\n            df._load_node(mind, null, xml_root);\r\n            return mind;\r\n        },\r\n\r\n        get_data: function (mind) {\r\n            var df = format.freemind;\r\n            var json = {};\r\n            json.meta = {\r\n                name: mind.name,\r\n                author: mind.author,\r\n                version: mind.version,\r\n            };\r\n            json.format = 'freemind';\r\n            var xml_lines = [];\r\n            xml_lines.push('<map version=\"1.0.1\">');\r\n            df._build_map(mind.root, xml_lines);\r\n            xml_lines.push('</map>');\r\n            json.data = xml_lines.join(' ');\r\n            return json;\r\n        },\r\n\r\n        _parse_xml: function (xml) {\r\n            var xml_doc = null;\r\n            if (window.DOMParser) {\r\n                var parser = new DOMParser();\r\n                xml_doc = parser.parseFromString(xml, 'text/xml');\r\n            } else {\r\n                // Internet Explorer\r\n                xml_doc = new ActiveXObject('Microsoft.XMLDOM');\r\n                xml_doc.async = false;\r\n                xml_doc.loadXML(xml);\r\n            }\r\n            return xml_doc;\r\n        },\r\n\r\n        _find_root: function (xml_doc) {\r\n            var nodes = xml_doc.childNodes;\r\n            var node = null;\r\n            var root = null;\r\n            var n = null;\r\n            for (var i = 0; i < nodes.length; i++) {\r\n                n = nodes[i];\r\n                if (n.nodeType == 1 && n.tagName == 'map') {\r\n                    node = n;\r\n                    break;\r\n                }\r\n            }\r\n            if (!!node) {\r\n                var ns = node.childNodes;\r\n                node = null;\r\n                for (var i = 0; i < ns.length; i++) {\r\n                    n = ns[i];\r\n                    if (n.nodeType == 1 && n.tagName == 'node') {\r\n                        node = n;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            return node;\r\n        },\r\n\r\n        _load_node: function (mind, parent_node, xml_node) {\r\n            var df = format.freemind;\r\n            var node_id = xml_node.getAttribute('ID');\r\n            var node_topic = xml_node.getAttribute('TEXT');\r\n            // look for richcontent\r\n            if (node_topic == null) {\r\n                var topic_children = xml_node.childNodes;\r\n                var topic_child = null;\r\n                for (var i = 0; i < topic_children.length; i++) {\r\n                    topic_child = topic_children[i];\r\n                    if (topic_child.nodeType == 1 && topic_child.tagName === 'richcontent') {\r\n                        node_topic = topic_child.textContent;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            var node_data = df._load_attributes(xml_node);\r\n            var node_expanded = 'expanded' in node_data ? node_data.expanded == 'true' : true;\r\n            delete node_data.expanded;\r\n\r\n            var node_position = xml_node.getAttribute('POSITION');\r\n            var node_direction = null;\r\n            if (!!node_position) {\r\n                node_direction = node_position == 'left' ? Direction.left : Direction.right;\r\n            }\r\n            var node = null;\r\n            if (!!parent_node) {\r\n                node = mind.add_node(\r\n                    parent_node,\r\n                    node_id,\r\n                    node_topic,\r\n                    node_data,\r\n                    node_direction,\r\n                    node_expanded\r\n                );\r\n            } else {\r\n                node = mind.set_root(node_id, node_topic, node_data);\r\n            }\r\n            var children = xml_node.childNodes;\r\n            var child = null;\r\n            for (var i = 0; i < children.length; i++) {\r\n                child = children[i];\r\n                if (child.nodeType == 1 && child.tagName == 'node') {\r\n                    df._load_node(mind, node, child);\r\n                }\r\n            }\r\n        },\r\n\r\n        _load_attributes: function (xml_node) {\r\n            var children = xml_node.childNodes;\r\n            var attr = null;\r\n            var attr_data = {};\r\n            for (var i = 0; i < children.length; i++) {\r\n                attr = children[i];\r\n                if (attr.nodeType == 1 && attr.tagName === 'attribute') {\r\n                    attr_data[attr.getAttribute('NAME')] = attr.getAttribute('VALUE');\r\n                }\r\n            }\r\n            return attr_data;\r\n        },\r\n\r\n        _build_map: function (node, xml_lines) {\r\n            var df = format.freemind;\r\n            var pos = null;\r\n            if (!!node.parent && node.parent.isroot) {\r\n                pos = node.direction === Direction.left ? 'left' : 'right';\r\n            }\r\n            xml_lines.push('<node');\r\n            xml_lines.push('ID=\"' + node.id + '\"');\r\n            if (!!pos) {\r\n                xml_lines.push('POSITION=\"' + pos + '\"');\r\n            }\r\n            xml_lines.push('TEXT=\"' + node.topic + '\">');\r\n\r\n            // store expanded status as an attribute\r\n            xml_lines.push('<attribute NAME=\"expanded\" VALUE=\"' + node.expanded + '\"/>');\r\n\r\n            // for attributes\r\n            var node_data = node.data;\r\n            if (node_data != null) {\r\n                for (var k in node_data) {\r\n                    xml_lines.push('<attribute NAME=\"' + k + '\" VALUE=\"' + node_data[k] + '\"/>');\r\n                }\r\n            }\r\n\r\n            // for children\r\n            var children = node.children;\r\n            for (var i = 0; i < children.length; i++) {\r\n                df._build_map(children[i], xml_lines);\r\n            }\r\n\r\n            xml_lines.push('</node>');\r\n        },\r\n    },\r\n};\r\n","/**\r\n * @license BSD\r\n * @copyright 2014-2022 hizzgdev@163.com\r\n *\r\n * Project Home:\r\n *   https://github.com/hizzgdev/jsmind/\r\n */\r\n\r\nimport { logger } from './jsmind.common.js';\r\nimport { format } from './jsmind.format.js';\r\n\r\nexport class DataProvider {\r\n    constructor(jm) {\r\n        this.jm = jm;\r\n    }\r\n\r\n    init() {\r\n        logger.debug('data.init');\r\n    }\r\n    reset() {\r\n        logger.debug('data.reset');\r\n    }\r\n    load(mind_data) {\r\n        var df = null;\r\n        var mind = null;\r\n        if (typeof mind_data === 'object') {\r\n            if (!!mind_data.format) {\r\n                df = mind_data.format;\r\n            } else {\r\n                df = 'node_tree';\r\n            }\r\n        } else {\r\n            df = 'freemind';\r\n        }\r\n\r\n        if (df == 'node_array') {\r\n            mind = format.node_array.get_mind(mind_data);\r\n        } else if (df == 'node_tree') {\r\n            mind = format.node_tree.get_mind(mind_data);\r\n        } else if (df == 'freemind') {\r\n            mind = format.freemind.get_mind(mind_data);\r\n        } else {\r\n            logger.warn('unsupported format');\r\n        }\r\n        return mind;\r\n    }\r\n    get_data(data_format) {\r\n        var data = null;\r\n        if (data_format == 'node_array') {\r\n            data = format.node_array.get_data(this.jm.mind);\r\n        } else if (data_format == 'node_tree') {\r\n            data = format.node_tree.get_data(this.jm.mind);\r\n        } else if (data_format == 'freemind') {\r\n            data = format.freemind.get_data(this.jm.mind);\r\n        } else {\r\n            logger.error('unsupported ' + data_format + ' format');\r\n        }\r\n        return data;\r\n    }\r\n}\r\n","/**\r\n * @license BSD\r\n * @copyright 2014-2022 hizzgdev@163.com\r\n *\r\n * Project Home:\r\n *   https://github.com/hizzgdev/jsmind/\r\n */\r\nimport { logger, Direction, EventType } from './jsmind.common.js';\r\n\r\nexport class LayoutProvider {\r\n    constructor(jm, options) {\r\n        this.opts = options;\r\n        this.jm = jm;\r\n        this.isside = this.opts.mode == 'side';\r\n        this.bounds = null;\r\n\r\n        this.cache_valid = false;\r\n    }\r\n    init() {\r\n        logger.debug('layout.init');\r\n    }\r\n    reset() {\r\n        logger.debug('layout.reset');\r\n        this.bounds = { n: 0, s: 0, w: 0, e: 0 };\r\n    }\r\n    calculate_next_child_direction(node) {\r\n        if (this.isside) {\r\n            return Direction.right;\r\n        }\r\n        var children = node.children || [];\r\n        var children_len = children.length;\r\n        var r = 0;\r\n        for (var i = 0; i < children_len; i++) {\r\n            if (children[i].direction === Direction.left) {\r\n                r--;\r\n            } else {\r\n                r++;\r\n            }\r\n        }\r\n        return children_len > 1 && r > 0 ? Direction.left : Direction.right;\r\n    }\r\n    layout() {\r\n        logger.debug('layout.layout');\r\n        this.layout_direction();\r\n        this.layout_offset();\r\n    }\r\n    layout_direction() {\r\n        this._layout_direction_root();\r\n    }\r\n    _layout_direction_root() {\r\n        var node = this.jm.mind.root;\r\n        var layout_data = null;\r\n        if ('layout' in node._data) {\r\n            layout_data = node._data.layout;\r\n        } else {\r\n            layout_data = {};\r\n            node._data.layout = layout_data;\r\n        }\r\n        var children = node.children;\r\n        var children_count = children.length;\r\n        layout_data.direction = Direction.center;\r\n        layout_data.side_index = 0;\r\n        if (this.isside) {\r\n            var i = children_count;\r\n            while (i--) {\r\n                this._layout_direction_side(children[i], Direction.right, i);\r\n            }\r\n        } else {\r\n            var i = children_count;\r\n            var subnode = null;\r\n            while (i--) {\r\n                subnode = children[i];\r\n                if (subnode.direction == Direction.left) {\r\n                    this._layout_direction_side(subnode, Direction.left, i);\r\n                } else {\r\n                    this._layout_direction_side(subnode, Direction.right, i);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    _layout_direction_side(node, direction, side_index) {\r\n        var layout_data = null;\r\n        if ('layout' in node._data) {\r\n            layout_data = node._data.layout;\r\n        } else {\r\n            layout_data = {};\r\n            node._data.layout = layout_data;\r\n        }\r\n        var children = node.children;\r\n        var children_count = children.length;\r\n\r\n        layout_data.direction = direction;\r\n        layout_data.side_index = side_index;\r\n        var i = children_count;\r\n        while (i--) {\r\n            this._layout_direction_side(children[i], direction, i);\r\n        }\r\n    }\r\n    layout_offset() {\r\n        var node = this.jm.mind.root;\r\n        var layout_data = node._data.layout;\r\n        layout_data.offset_x = 0;\r\n        layout_data.offset_y = 0;\r\n        layout_data.outer_height = 0;\r\n        var children = node.children;\r\n        var i = children.length;\r\n        var left_nodes = [];\r\n        var right_nodes = [];\r\n        var subnode = null;\r\n        while (i--) {\r\n            subnode = children[i];\r\n            if (subnode._data.layout.direction == Direction.right) {\r\n                right_nodes.unshift(subnode);\r\n            } else {\r\n                left_nodes.unshift(subnode);\r\n            }\r\n        }\r\n        layout_data.left_nodes = left_nodes;\r\n        layout_data.right_nodes = right_nodes;\r\n        layout_data.outer_height_left = this._layout_offset_subnodes(left_nodes);\r\n        layout_data.outer_height_right = this._layout_offset_subnodes(right_nodes);\r\n        this.bounds.e = node._data.view.width / 2;\r\n        this.bounds.w = 0 - this.bounds.e;\r\n        this.bounds.n = 0;\r\n        this.bounds.s = Math.max(layout_data.outer_height_left, layout_data.outer_height_right);\r\n    }\r\n    // layout both the x and y axis\r\n    _layout_offset_subnodes(nodes) {\r\n        var total_height = 0;\r\n        var nodes_count = nodes.length;\r\n        var i = nodes_count;\r\n        var node = null;\r\n        var node_outer_height = 0;\r\n        var layout_data = null;\r\n        var base_y = 0;\r\n        var pd = null; // parent._data\r\n        while (i--) {\r\n            node = nodes[i];\r\n            layout_data = node._data.layout;\r\n            if (pd == null) {\r\n                pd = node.parent._data;\r\n            }\r\n\r\n            node_outer_height = this._layout_offset_subnodes(node.children);\r\n            if (!node.expanded) {\r\n                node_outer_height = 0;\r\n                this.set_visible(node.children, false);\r\n            }\r\n            node_outer_height = Math.max(node._data.view.height, node_outer_height);\r\n\r\n            layout_data.outer_height = node_outer_height;\r\n            layout_data.offset_y = base_y - node_outer_height / 2;\r\n            layout_data.offset_x =\r\n                this.opts.hspace * layout_data.direction +\r\n                (pd.view.width * (pd.layout.direction + layout_data.direction)) / 2;\r\n            if (!node.parent.isroot) {\r\n                layout_data.offset_x += this.opts.pspace * layout_data.direction;\r\n            }\r\n\r\n            base_y = base_y - node_outer_height - this.opts.vspace;\r\n            total_height += node_outer_height;\r\n        }\r\n        if (nodes_count > 1) {\r\n            total_height += this.opts.vspace * (nodes_count - 1);\r\n        }\r\n        i = nodes_count;\r\n        var middle_height = total_height / 2;\r\n        while (i--) {\r\n            node = nodes[i];\r\n            node._data.layout.offset_y += middle_height;\r\n        }\r\n        return total_height;\r\n    }\r\n    // layout the y axis only, for collapse/expand a node\r\n    _layout_offset_subnodes_height(nodes) {\r\n        var total_height = 0;\r\n        var nodes_count = nodes.length;\r\n        var i = nodes_count;\r\n        var node = null;\r\n        var node_outer_height = 0;\r\n        var layout_data = null;\r\n        var base_y = 0;\r\n        var pd = null; // parent._data\r\n        while (i--) {\r\n            node = nodes[i];\r\n            layout_data = node._data.layout;\r\n            if (pd == null) {\r\n                pd = node.parent._data;\r\n            }\r\n\r\n            node_outer_height = this._layout_offset_subnodes_height(node.children);\r\n            if (!node.expanded) {\r\n                node_outer_height = 0;\r\n            }\r\n            node_outer_height = Math.max(node._data.view.height, node_outer_height);\r\n\r\n            layout_data.outer_height = node_outer_height;\r\n            layout_data.offset_y = base_y - node_outer_height / 2;\r\n            base_y = base_y - node_outer_height - this.opts.vspace;\r\n            total_height += node_outer_height;\r\n        }\r\n        if (nodes_count > 1) {\r\n            total_height += this.opts.vspace * (nodes_count - 1);\r\n        }\r\n        i = nodes_count;\r\n        var middle_height = total_height / 2;\r\n        while (i--) {\r\n            node = nodes[i];\r\n            node._data.layout.offset_y += middle_height;\r\n        }\r\n        return total_height;\r\n    }\r\n    get_node_offset(node) {\r\n        var layout_data = node._data.layout;\r\n        var offset_cache = null;\r\n        if ('_offset_' in layout_data && this.cache_valid) {\r\n            offset_cache = layout_data._offset_;\r\n        } else {\r\n            offset_cache = { x: -1, y: -1 };\r\n            layout_data._offset_ = offset_cache;\r\n        }\r\n        if (offset_cache.x == -1 || offset_cache.y == -1) {\r\n            var x = layout_data.offset_x;\r\n            var y = layout_data.offset_y;\r\n            if (!node.isroot) {\r\n                var offset_p = this.get_node_offset(node.parent);\r\n                x += offset_p.x;\r\n                y += offset_p.y;\r\n            }\r\n            offset_cache.x = x;\r\n            offset_cache.y = y;\r\n        }\r\n        return offset_cache;\r\n    }\r\n    get_node_point(node) {\r\n        var view_data = node._data.view;\r\n        var offset_p = this.get_node_offset(node);\r\n        var p = {};\r\n        p.x = offset_p.x + (view_data.width * (node._data.layout.direction - 1)) / 2;\r\n        p.y = offset_p.y - view_data.height / 2;\r\n        return p;\r\n    }\r\n    get_node_point_in(node) {\r\n        var p = this.get_node_offset(node);\r\n        return p;\r\n    }\r\n    get_node_point_out(node) {\r\n        var layout_data = node._data.layout;\r\n        var pout_cache = null;\r\n        if ('_pout_' in layout_data && this.cache_valid) {\r\n            pout_cache = layout_data._pout_;\r\n        } else {\r\n            pout_cache = { x: -1, y: -1 };\r\n            layout_data._pout_ = pout_cache;\r\n        }\r\n        if (pout_cache.x == -1 || pout_cache.y == -1) {\r\n            if (node.isroot) {\r\n                pout_cache.x = 0;\r\n                pout_cache.y = 0;\r\n            } else {\r\n                var view_data = node._data.view;\r\n                var offset_p = this.get_node_offset(node);\r\n                pout_cache.x =\r\n                    offset_p.x + (view_data.width + this.opts.pspace) * node._data.layout.direction;\r\n                pout_cache.y = offset_p.y;\r\n            }\r\n        }\r\n        return pout_cache;\r\n    }\r\n    get_expander_point(node) {\r\n        var p = this.get_node_point_out(node);\r\n        var ex_p = {};\r\n        if (node._data.layout.direction == Direction.right) {\r\n            ex_p.x = p.x - this.opts.pspace;\r\n        } else {\r\n            ex_p.x = p.x;\r\n        }\r\n        ex_p.y = p.y - Math.ceil(this.opts.pspace / 2);\r\n        return ex_p;\r\n    }\r\n    get_min_size() {\r\n        var nodes = this.jm.mind.nodes;\r\n        var node = null;\r\n        var pout = null;\r\n        for (var node_id in nodes) {\r\n            node = nodes[node_id];\r\n            pout = this.get_node_point_out(node);\r\n            if (pout.x > this.bounds.e) {\r\n                this.bounds.e = pout.x;\r\n            }\r\n            if (pout.x < this.bounds.w) {\r\n                this.bounds.w = pout.x;\r\n            }\r\n        }\r\n        return {\r\n            w: this.bounds.e - this.bounds.w,\r\n            h: this.bounds.s - this.bounds.n,\r\n        };\r\n    }\r\n    toggle_node(node) {\r\n        if (node.isroot) {\r\n            return;\r\n        }\r\n        if (node.expanded) {\r\n            this.collapse_node(node);\r\n        } else {\r\n            this.expand_node(node);\r\n        }\r\n    }\r\n    expand_node(node) {\r\n        node.expanded = true;\r\n        this.part_layout(node);\r\n        this.set_visible(node.children, true);\r\n        this.jm.invoke_event_handle(EventType.show, {\r\n            evt: 'expand_node',\r\n            data: [],\r\n            node: node.id,\r\n        });\r\n    }\r\n    collapse_node(node) {\r\n        node.expanded = false;\r\n        this.part_layout(node);\r\n        this.set_visible(node.children, false);\r\n        this.jm.invoke_event_handle(EventType.show, {\r\n            evt: 'collapse_node',\r\n            data: [],\r\n            node: node.id,\r\n        });\r\n    }\r\n    expand_all() {\r\n        var nodes = this.jm.mind.nodes;\r\n        var c = 0;\r\n        var node;\r\n        for (var node_id in nodes) {\r\n            node = nodes[node_id];\r\n            if (!node.expanded) {\r\n                node.expanded = true;\r\n                c++;\r\n            }\r\n        }\r\n        if (c > 0) {\r\n            var root = this.jm.mind.root;\r\n            this.part_layout(root);\r\n            this.set_visible(root.children, true);\r\n        }\r\n    }\r\n    collapse_all() {\r\n        var nodes = this.jm.mind.nodes;\r\n        var c = 0;\r\n        var node;\r\n        for (var node_id in nodes) {\r\n            node = nodes[node_id];\r\n            if (node.expanded && !node.isroot) {\r\n                node.expanded = false;\r\n                c++;\r\n            }\r\n        }\r\n        if (c > 0) {\r\n            var root = this.jm.mind.root;\r\n            this.part_layout(root);\r\n            this.set_visible(root.children, true);\r\n        }\r\n    }\r\n    expand_to_depth(target_depth, curr_nodes, curr_depth) {\r\n        if (target_depth < 1) {\r\n            return;\r\n        }\r\n        var nodes = curr_nodes || this.jm.mind.root.children;\r\n        var depth = curr_depth || 1;\r\n        var i = nodes.length;\r\n        var node = null;\r\n        while (i--) {\r\n            node = nodes[i];\r\n            if (depth < target_depth) {\r\n                if (!node.expanded) {\r\n                    this.expand_node(node);\r\n                }\r\n                this.expand_to_depth(target_depth, node.children, depth + 1);\r\n            }\r\n            if (depth == target_depth) {\r\n                if (node.expanded) {\r\n                    this.collapse_node(node);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    part_layout(node) {\r\n        var root = this.jm.mind.root;\r\n        if (!!root) {\r\n            var root_layout_data = root._data.layout;\r\n            if (node.isroot) {\r\n                root_layout_data.outer_height_right = this._layout_offset_subnodes_height(\r\n                    root_layout_data.right_nodes\r\n                );\r\n                root_layout_data.outer_height_left = this._layout_offset_subnodes_height(\r\n                    root_layout_data.left_nodes\r\n                );\r\n            } else {\r\n                if (node._data.layout.direction == Direction.right) {\r\n                    root_layout_data.outer_height_right = this._layout_offset_subnodes_height(\r\n                        root_layout_data.right_nodes\r\n                    );\r\n                } else {\r\n                    root_layout_data.outer_height_left = this._layout_offset_subnodes_height(\r\n                        root_layout_data.left_nodes\r\n                    );\r\n                }\r\n            }\r\n            this.bounds.s = Math.max(\r\n                root_layout_data.outer_height_left,\r\n                root_layout_data.outer_height_right\r\n            );\r\n            this.cache_valid = false;\r\n        } else {\r\n            logger.warn('can not found root node');\r\n        }\r\n    }\r\n    set_visible(nodes, visible) {\r\n        var i = nodes.length;\r\n        var node = null;\r\n        var layout_data = null;\r\n        while (i--) {\r\n            node = nodes[i];\r\n            layout_data = node._data.layout;\r\n            if (node.expanded) {\r\n                this.set_visible(node.children, visible);\r\n            } else {\r\n                this.set_visible(node.children, false);\r\n            }\r\n            if (!node.isroot) {\r\n                node._data.layout.visible = visible;\r\n            }\r\n        }\r\n    }\r\n    is_expand(node) {\r\n        return node.expanded;\r\n    }\r\n    is_visible(node) {\r\n        var layout_data = node._data.layout;\r\n        if ('visible' in layout_data && !layout_data.visible) {\r\n            return false;\r\n        } else {\r\n            return true;\r\n        }\r\n    }\r\n}\r\n","/**\r\n * @license BSD\r\n * @copyright 2014-2022 hizzgdev@163.com\r\n *\r\n * Project Home:\r\n *   https://github.com/hizzgdev/jsmind/\r\n */\r\n\r\nimport { $ } from './jsmind.dom.js';\r\n\r\nclass SvgGraph {\r\n    constructor(view) {\r\n        this.view = view;\r\n        this.opts = view.opts;\r\n        this.e_svg = SvgGraph.c('svg');\r\n        this.e_svg.setAttribute('class', 'jsmind');\r\n        this.size = { w: 0, h: 0 };\r\n        this.lines = [];\r\n    }\r\n    static c(tag) {\r\n        return $.d.createElementNS('http://www.w3.org/2000/svg', tag);\r\n    }\r\n    element() {\r\n        return this.e_svg;\r\n    }\r\n    set_size(w, h) {\r\n        this.size.w = w;\r\n        this.size.h = h;\r\n        this.e_svg.setAttribute('width', w);\r\n        this.e_svg.setAttribute('height', h);\r\n    }\r\n    clear() {\r\n        var len = this.lines.length;\r\n        while (len--) {\r\n            this.e_svg.removeChild(this.lines[len]);\r\n        }\r\n        this.lines.length = 0;\r\n    }\r\n    draw_line(pout, pin, offset) {\r\n        var line = SvgGraph.c('path');\r\n        line.setAttribute('stroke', this.opts.line_color);\r\n        line.setAttribute('stroke-width', this.opts.line_width);\r\n        line.setAttribute('fill', 'transparent');\r\n        this.lines.push(line);\r\n        this.e_svg.appendChild(line);\r\n        this._bezier_to(\r\n            line,\r\n            pin.x + offset.x,\r\n            pin.y + offset.y,\r\n            pout.x + offset.x,\r\n            pout.y + offset.y\r\n        );\r\n    }\r\n    copy_to(dest_canvas_ctx, callback) {\r\n        var img = new Image();\r\n        img.onload = function () {\r\n            dest_canvas_ctx.drawImage(img, 0, 0);\r\n            !!callback && callback();\r\n        };\r\n        img.src =\r\n            'data:image/svg+xml;base64,' + btoa(new XMLSerializer().serializeToString(this.e_svg));\r\n    }\r\n    _bezier_to(path, x1, y1, x2, y2) {\r\n        path.setAttribute(\r\n            'd',\r\n            'M ' +\r\n                x1 +\r\n                ' ' +\r\n                y1 +\r\n                ' C ' +\r\n                (x1 + ((x2 - x1) * 2) / 3) +\r\n                ' ' +\r\n                y1 +\r\n                ', ' +\r\n                x1 +\r\n                ' ' +\r\n                y2 +\r\n                ', ' +\r\n                x2 +\r\n                ' ' +\r\n                y2\r\n        );\r\n    }\r\n    _line_to(path, x1, y1, x2, y2) {\r\n        path.setAttribute('d', 'M ' + x1 + ' ' + y1 + ' L ' + x2 + ' ' + y2);\r\n    }\r\n}\r\n\r\nclass CanvasGraph {\r\n    constructor(view) {\r\n        this.opts = view.opts;\r\n        this.e_canvas = $.c('canvas');\r\n        this.e_canvas.className = 'jsmind';\r\n        this.canvas_ctx = this.e_canvas.getContext('2d');\r\n        this.size = { w: 0, h: 0 };\r\n    }\r\n    element() {\r\n        return this.e_canvas;\r\n    }\r\n    set_size(w, h) {\r\n        this.size.w = w;\r\n        this.size.h = h;\r\n        this.e_canvas.width = w;\r\n        this.e_canvas.height = h;\r\n    }\r\n    clear() {\r\n        this.canvas_ctx.clearRect(0, 0, this.size.w, this.size.h);\r\n    }\r\n    draw_line(pout, pin, offset) {\r\n        var ctx = this.canvas_ctx;\r\n        ctx.strokeStyle = this.opts.line_color;\r\n        ctx.lineWidth = this.opts.line_width;\r\n        ctx.lineCap = 'round';\r\n\r\n        this._bezier_to(\r\n            ctx,\r\n            pin.x + offset.x,\r\n            pin.y + offset.y,\r\n            pout.x + offset.x,\r\n            pout.y + offset.y\r\n        );\r\n    }\r\n    copy_to(dest_canvas_ctx, callback) {\r\n        dest_canvas_ctx.drawImage(this.e_canvas, 0, 0);\r\n        !!callback && callback();\r\n    }\r\n    _bezier_to(ctx, x1, y1, x2, y2) {\r\n        ctx.beginPath();\r\n        ctx.moveTo(x1, y1);\r\n        ctx.bezierCurveTo(x1 + ((x2 - x1) * 2) / 3, y1, x1, y2, x2, y2);\r\n        ctx.stroke();\r\n    }\r\n    _line_to(ctx, x1, y1, x2, y2) {\r\n        ctx.beginPath();\r\n        ctx.moveTo(x1, y1);\r\n        ctx.lineTo(x2, y2);\r\n        ctx.stroke();\r\n    }\r\n}\r\n\r\nexport function init_graph(view, engine) {\r\n    return engine.toLowerCase() === 'svg' ? new SvgGraph(view) : new CanvasGraph(view);\r\n}\r\n","/**\r\n * @license BSD\r\n * @copyright 2014-2022 hizzgdev@163.com\r\n *\r\n * Project Home:\r\n *   https://github.com/hizzgdev/jsmind/\r\n */\r\nimport { logger, EventType } from './jsmind.common.js';\r\nimport { $ } from './jsmind.dom.js';\r\nimport { init_graph } from './jsmind.graph.js';\r\nimport { util } from './jsmind.util.js';\r\n\r\nexport class ViewProvider {\r\n    constructor(jm, options) {\r\n        this.opts = options;\r\n        this.jm = jm;\r\n        this.layout = jm.layout;\r\n\r\n        this.container = null;\r\n        this.e_panel = null;\r\n        this.e_nodes = null;\r\n\r\n        this.size = { w: 0, h: 0 };\r\n\r\n        this.selected_node = null;\r\n        this.editing_node = null;\r\n\r\n        this.graph = null;\r\n    }\r\n    init() {\r\n        logger.debug('view.init');\r\n\r\n        this.container = $.i(this.opts.container) ? this.opts.container : $.g(this.opts.container);\r\n        if (!this.container) {\r\n            logger.error('the options.view.container was not be found in dom');\r\n            return;\r\n        }\r\n        this.graph = init_graph(this, this.opts.engine);\r\n\r\n        this.e_panel = $.c('div');\r\n        this.e_nodes = $.c('jmnodes');\r\n        this.e_editor = $.c('input');\r\n        this.e_panel.className = 'jsmind-inner';\r\n        this.e_panel.tabIndex = 1;\r\n        this.e_panel.appendChild(this.graph.element());\r\n        this.e_panel.appendChild(this.e_nodes);\r\n\r\n        this.e_editor.className = 'jsmind-editor';\r\n        this.e_editor.type = 'text';\r\n\r\n        this.actualZoom = 1;\r\n        this.zoomStep = 0.1;\r\n        this.minZoom = 0.5;\r\n        this.maxZoom = 2;\r\n\r\n        var v = this;\r\n        $.on(this.e_editor, 'keydown', function (e) {\r\n            var evt = e || event;\r\n            if (evt.keyCode == 13) {\r\n                v.edit_node_end();\r\n                evt.stopPropagation();\r\n            }\r\n        });\r\n        $.on(this.e_editor, 'blur', function (e) {\r\n            v.edit_node_end();\r\n        });\r\n\r\n        this.container.appendChild(this.e_panel);\r\n\r\n        this.enable_draggable_canvas();\r\n    }\r\n    add_event(obj, event_name, event_handle) {\r\n        $.on(this.e_nodes, event_name, function (e) {\r\n            var evt = e || event;\r\n            event_handle.call(obj, evt);\r\n        });\r\n    }\r\n    get_binded_nodeid(element) {\r\n        if (element == null) {\r\n            return null;\r\n        }\r\n        var tagName = element.tagName.toLowerCase();\r\n        if (tagName == 'jmnodes' || tagName == 'body' || tagName == 'html') {\r\n            return null;\r\n        }\r\n        if (tagName == 'jmnode' || tagName == 'jmexpander') {\r\n            return element.getAttribute('nodeid');\r\n        } else {\r\n            return this.get_binded_nodeid(element.parentElement);\r\n        }\r\n    }\r\n    is_expander(element) {\r\n        return element.tagName.toLowerCase() == 'jmexpander';\r\n    }\r\n    reset() {\r\n        logger.debug('view.reset');\r\n        this.selected_node = null;\r\n        this.clear_lines();\r\n        this.clear_nodes();\r\n        this.reset_theme();\r\n    }\r\n    reset_theme() {\r\n        var theme_name = this.jm.options.theme;\r\n        if (!!theme_name) {\r\n            this.e_nodes.className = 'theme-' + theme_name;\r\n        } else {\r\n            this.e_nodes.className = '';\r\n        }\r\n    }\r\n    reset_custom_style() {\r\n        var nodes = this.jm.mind.nodes;\r\n        for (var nodeid in nodes) {\r\n            this.reset_node_custom_style(nodes[nodeid]);\r\n        }\r\n    }\r\n    load() {\r\n        logger.debug('view.load');\r\n        this.init_nodes();\r\n    }\r\n    expand_size() {\r\n        var min_size = this.layout.get_min_size();\r\n        var min_width = min_size.w + this.opts.hmargin * 2;\r\n        var min_height = min_size.h + this.opts.vmargin * 2;\r\n        var client_w = this.e_panel.clientWidth;\r\n        var client_h = this.e_panel.clientHeight;\r\n        if (client_w < min_width) {\r\n            client_w = min_width;\r\n        }\r\n        if (client_h < min_height) {\r\n            client_h = min_height;\r\n        }\r\n        this.size.w = client_w;\r\n        this.size.h = client_h;\r\n    }\r\n    init_nodes_size(node) {\r\n        var view_data = node._data.view;\r\n        view_data.width = view_data.element.clientWidth;\r\n        view_data.height = view_data.element.clientHeight;\r\n    }\r\n    init_nodes() {\r\n        var nodes = this.jm.mind.nodes;\r\n        var doc_frag = $.d.createDocumentFragment();\r\n        for (var nodeid in nodes) {\r\n            this.create_node_element(nodes[nodeid], doc_frag);\r\n        }\r\n        this.e_nodes.appendChild(doc_frag);\r\n        for (var nodeid in nodes) {\r\n            this.init_nodes_size(nodes[nodeid]);\r\n        }\r\n    }\r\n    add_node(node) {\r\n        this.create_node_element(node, this.e_nodes);\r\n        this.init_nodes_size(node);\r\n    }\r\n    create_node_element(node, parent_node) {\r\n        var view_data = null;\r\n        if ('view' in node._data) {\r\n            view_data = node._data.view;\r\n        } else {\r\n            view_data = {};\r\n            node._data.view = view_data;\r\n        }\r\n\r\n        var d = $.c('jmnode');\r\n        if (node.isroot) {\r\n            d.className = 'root';\r\n        } else {\r\n            var d_e = $.c('jmexpander');\r\n            $.t(d_e, '-');\r\n            d_e.setAttribute('nodeid', node.id);\r\n            d_e.style.visibility = 'hidden';\r\n            parent_node.appendChild(d_e);\r\n            view_data.expander = d_e;\r\n        }\r\n        if (!!node.topic) {\r\n            if (this.opts.support_html) {\r\n                $.h(d, node.topic);\r\n            } else {\r\n                $.t(d, node.topic);\r\n            }\r\n        }\r\n        d.setAttribute('nodeid', node.id);\r\n        d.style.visibility = 'hidden';\r\n        this._reset_node_custom_style(d, node.data);\r\n\r\n        parent_node.appendChild(d);\r\n        view_data.element = d;\r\n    }\r\n    remove_node(node) {\r\n        if (this.selected_node != null && this.selected_node.id == node.id) {\r\n            this.selected_node = null;\r\n        }\r\n        if (this.editing_node != null && this.editing_node.id == node.id) {\r\n            node._data.view.element.removeChild(this.e_editor);\r\n            this.editing_node = null;\r\n        }\r\n        var children = node.children;\r\n        var i = children.length;\r\n        while (i--) {\r\n            this.remove_node(children[i]);\r\n        }\r\n        if (node._data.view) {\r\n            var element = node._data.view.element;\r\n            var expander = node._data.view.expander;\r\n            this.e_nodes.removeChild(element);\r\n            this.e_nodes.removeChild(expander);\r\n            node._data.view.element = null;\r\n            node._data.view.expander = null;\r\n        }\r\n    }\r\n    update_node(node) {\r\n        var view_data = node._data.view;\r\n        var element = view_data.element;\r\n        if (!!node.topic) {\r\n            if (this.opts.support_html) {\r\n                $.h(element, node.topic);\r\n            } else {\r\n                $.t(element, node.topic);\r\n            }\r\n        }\r\n        view_data.width = element.clientWidth;\r\n        view_data.height = element.clientHeight;\r\n    }\r\n    select_node(node) {\r\n        if (!!this.selected_node) {\r\n            var element = this.selected_node._data.view.element;\r\n            element.className = element.className.replace(/\\s*selected\\b/i, '');\r\n        }\r\n        if (!!node) {\r\n            this.selected_node = node;\r\n            node._data.view.element.className += ' selected';\r\n            this.clear_node_custom_style(node);\r\n        }\r\n    }\r\n    select_clear() {\r\n        this.select_node(null);\r\n    }\r\n    get_editing_node() {\r\n        return this.editing_node;\r\n    }\r\n    is_editing() {\r\n        return !!this.editing_node;\r\n    }\r\n    edit_node_begin(node) {\r\n        if (!node.topic) {\r\n            logger.warn(\"don't edit image nodes\");\r\n            return;\r\n        }\r\n        if (this.editing_node != null) {\r\n            this.edit_node_end();\r\n        }\r\n        this.editing_node = node;\r\n        var view_data = node._data.view;\r\n        var element = view_data.element;\r\n        var topic = node.topic;\r\n        var ncs = getComputedStyle(element);\r\n        this.e_editor.value = topic;\r\n        this.e_editor.style.width =\r\n            element.clientWidth -\r\n            parseInt(ncs.getPropertyValue('padding-left')) -\r\n            parseInt(ncs.getPropertyValue('padding-right')) +\r\n            'px';\r\n        element.innerHTML = '';\r\n        element.appendChild(this.e_editor);\r\n        element.style.zIndex = 5;\r\n        this.e_editor.focus();\r\n        this.e_editor.select();\r\n    }\r\n    edit_node_end() {\r\n        if (this.editing_node != null) {\r\n            var node = this.editing_node;\r\n            this.editing_node = null;\r\n            var view_data = node._data.view;\r\n            var element = view_data.element;\r\n            var topic = this.e_editor.value;\r\n            element.style.zIndex = 'auto';\r\n            element.removeChild(this.e_editor);\r\n            if (util.text.is_empty(topic) || node.topic === topic) {\r\n                if (this.opts.support_html) {\r\n                    $.h(element, node.topic);\r\n                } else {\r\n                    $.t(element, node.topic);\r\n                }\r\n            } else {\r\n                this.jm.update_node(node.id, topic);\r\n            }\r\n        }\r\n        this.e_panel.focus();\r\n    }\r\n    get_view_offset() {\r\n        var bounds = this.layout.bounds;\r\n        var _x = (this.size.w - bounds.e - bounds.w) / 2;\r\n        var _y = this.size.h / 2;\r\n        return { x: _x, y: _y };\r\n    }\r\n    resize() {\r\n        this.graph.set_size(1, 1);\r\n        this.e_nodes.style.width = '1px';\r\n        this.e_nodes.style.height = '1px';\r\n\r\n        this.expand_size();\r\n        this._show();\r\n    }\r\n    _show() {\r\n        this.graph.set_size(this.size.w, this.size.h);\r\n        this.e_nodes.style.width = this.size.w + 'px';\r\n        this.e_nodes.style.height = this.size.h + 'px';\r\n        this.show_nodes();\r\n        this.show_lines();\r\n        //this.layout.cache_valid = true;\r\n        this.jm.invoke_event_handle(EventType.resize, { data: [] });\r\n    }\r\n    zoomIn() {\r\n        return this.setZoom(this.actualZoom + this.zoomStep);\r\n    }\r\n    zoomOut() {\r\n        return this.setZoom(this.actualZoom - this.zoomStep);\r\n    }\r\n    setZoom(zoom) {\r\n        if (zoom < this.minZoom || zoom > this.maxZoom) {\r\n            return false;\r\n        }\r\n        this.actualZoom = zoom;\r\n        for (var i = 0; i < this.e_panel.children.length; i++) {\r\n            this.e_panel.children[i].style.transform = 'scale(' + zoom + ')';\r\n        }\r\n        this.show(true);\r\n        return true;\r\n    }\r\n    _center_root() {\r\n        // center root node\r\n        var outer_w = this.e_panel.clientWidth;\r\n        var outer_h = this.e_panel.clientHeight;\r\n        if (this.size.w > outer_w) {\r\n            var _offset = this.get_view_offset();\r\n            this.e_panel.scrollLeft = _offset.x - outer_w / 2;\r\n        }\r\n        if (this.size.h > outer_h) {\r\n            this.e_panel.scrollTop = (this.size.h - outer_h) / 2;\r\n        }\r\n    }\r\n    show(keep_center) {\r\n        logger.debug('view.show');\r\n        this.expand_size();\r\n        this._show();\r\n        if (!!keep_center) {\r\n            this._center_root();\r\n        }\r\n    }\r\n    relayout() {\r\n        this.expand_size();\r\n        this._show();\r\n    }\r\n    save_location(node) {\r\n        var vd = node._data.view;\r\n        vd._saved_location = {\r\n            x: parseInt(vd.element.style.left) - this.e_panel.scrollLeft,\r\n            y: parseInt(vd.element.style.top) - this.e_panel.scrollTop,\r\n        };\r\n    }\r\n    restore_location(node) {\r\n        var vd = node._data.view;\r\n        this.e_panel.scrollLeft = parseInt(vd.element.style.left) - vd._saved_location.x;\r\n        this.e_panel.scrollTop = parseInt(vd.element.style.top) - vd._saved_location.y;\r\n    }\r\n    clear_nodes() {\r\n        var mind = this.jm.mind;\r\n        if (mind == null) {\r\n            return;\r\n        }\r\n        var nodes = mind.nodes;\r\n        var node = null;\r\n        for (var nodeid in nodes) {\r\n            node = nodes[nodeid];\r\n            node._data.view.element = null;\r\n            node._data.view.expander = null;\r\n        }\r\n        this.e_nodes.innerHTML = '';\r\n    }\r\n    show_nodes() {\r\n        var nodes = this.jm.mind.nodes;\r\n        var node = null;\r\n        var node_element = null;\r\n        var expander = null;\r\n        var p = null;\r\n        var p_expander = null;\r\n        var expander_text = '-';\r\n        var view_data = null;\r\n        var _offset = this.get_view_offset();\r\n        for (var nodeid in nodes) {\r\n            node = nodes[nodeid];\r\n            view_data = node._data.view;\r\n            node_element = view_data.element;\r\n            expander = view_data.expander;\r\n            if (!this.layout.is_visible(node)) {\r\n                node_element.style.display = 'none';\r\n                expander.style.display = 'none';\r\n                continue;\r\n            }\r\n            this.reset_node_custom_style(node);\r\n            p = this.layout.get_node_point(node);\r\n            view_data.abs_x = _offset.x + p.x;\r\n            view_data.abs_y = _offset.y + p.y;\r\n            node_element.style.left = _offset.x + p.x + 'px';\r\n            node_element.style.top = _offset.y + p.y + 'px';\r\n            node_element.style.display = '';\r\n            node_element.style.visibility = 'visible';\r\n            if (!node.isroot && node.children.length > 0) {\r\n                expander_text = node.expanded ? '-' : '+';\r\n                p_expander = this.layout.get_expander_point(node);\r\n                expander.style.left = _offset.x + p_expander.x + 'px';\r\n                expander.style.top = _offset.y + p_expander.y + 'px';\r\n                expander.style.display = '';\r\n                expander.style.visibility = 'visible';\r\n                $.t(expander, expander_text);\r\n            }\r\n            // hide expander while all children have been removed\r\n            if (!node.isroot && node.children.length == 0) {\r\n                expander.style.display = 'none';\r\n                expander.style.visibility = 'hidden';\r\n            }\r\n        }\r\n    }\r\n    reset_node_custom_style(node) {\r\n        this._reset_node_custom_style(node._data.view.element, node.data);\r\n    }\r\n    _reset_node_custom_style(node_element, node_data) {\r\n        if ('background-color' in node_data) {\r\n            node_element.style.backgroundColor = node_data['background-color'];\r\n        }\r\n        if ('foreground-color' in node_data) {\r\n            node_element.style.color = node_data['foreground-color'];\r\n        }\r\n        if ('width' in node_data) {\r\n            node_element.style.width = node_data['width'] + 'px';\r\n        }\r\n        if ('height' in node_data) {\r\n            node_element.style.height = node_data['height'] + 'px';\r\n        }\r\n        if ('font-size' in node_data) {\r\n            node_element.style.fontSize = node_data['font-size'] + 'px';\r\n        }\r\n        if ('font-weight' in node_data) {\r\n            node_element.style.fontWeight = node_data['font-weight'];\r\n        }\r\n        if ('font-style' in node_data) {\r\n            node_element.style.fontStyle = node_data['font-style'];\r\n        }\r\n        if ('background-image' in node_data) {\r\n            var backgroundImage = node_data['background-image'];\r\n            if (backgroundImage.startsWith('data') && node_data['width'] && node_data['height']) {\r\n                var img = new Image();\r\n\r\n                img.onload = function () {\r\n                    var c = $.c('canvas');\r\n                    c.width = node_element.clientWidth;\r\n                    c.height = node_element.clientHeight;\r\n                    var img = this;\r\n                    if (c.getContext) {\r\n                        var ctx = c.getContext('2d');\r\n                        ctx.drawImage(\r\n                            img,\r\n                            2,\r\n                            2,\r\n                            node_element.clientWidth,\r\n                            node_element.clientHeight\r\n                        );\r\n                        var scaledImageData = c.toDataURL();\r\n                        node_element.style.backgroundImage = 'url(' + scaledImageData + ')';\r\n                    }\r\n                };\r\n                img.src = backgroundImage;\r\n            } else {\r\n                node_element.style.backgroundImage = 'url(' + backgroundImage + ')';\r\n            }\r\n            node_element.style.backgroundSize = '99%';\r\n\r\n            if ('background-rotation' in node_data) {\r\n                node_element.style.transform =\r\n                    'rotate(' + node_data['background-rotation'] + 'deg)';\r\n            }\r\n        }\r\n    }\r\n    clear_node_custom_style(node) {\r\n        var node_element = node._data.view.element;\r\n        node_element.style.backgroundColor = '';\r\n        node_element.style.color = '';\r\n    }\r\n    clear_lines() {\r\n        this.graph.clear();\r\n    }\r\n    show_lines() {\r\n        this.clear_lines();\r\n        var nodes = this.jm.mind.nodes;\r\n        var node = null;\r\n        var pin = null;\r\n        var pout = null;\r\n        var _offset = this.get_view_offset();\r\n        for (var nodeid in nodes) {\r\n            node = nodes[nodeid];\r\n            if (!!node.isroot) {\r\n                continue;\r\n            }\r\n            if ('visible' in node._data.layout && !node._data.layout.visible) {\r\n                continue;\r\n            }\r\n            pin = this.layout.get_node_point_in(node);\r\n            pout = this.layout.get_node_point_out(node.parent);\r\n            this.graph.draw_line(pout, pin, _offset);\r\n        }\r\n    }\r\n    // Drag the whole mind map with your mouse, when it's larger that the container\r\n    enable_draggable_canvas() {\r\n        // If draggable option is true.\r\n        if (this.opts.draggable) {\r\n            // Dragging disabled by default.\r\n            let dragging = false;\r\n            let x, y;\r\n            if (this.opts.hide_scrollbars_when_draggable) {\r\n                // Avoid scrollbars when mind map is larger than the container (e_panel = id jsmind-inner)\r\n                this.e_panel.style = 'overflow: hidden';\r\n            }\r\n            // Move the whole mind map with mouse moves, while button is down.\r\n            $.on(this.container, 'mousedown', eventDown => {\r\n                dragging = true;\r\n                // Record current mouse position.\r\n                x = eventDown.clientX;\r\n                y = eventDown.clientY;\r\n            });\r\n            // Stop moving mind map once mouse button is released.\r\n            $.on(this.container, 'mouseup', () => {\r\n                dragging = false;\r\n            });\r\n            // Follow current mouse position and move mind map accordingly.\r\n            $.on(this.container, 'mousemove', eventMove => {\r\n                if (dragging) {\r\n                    this.e_panel.scrollBy(x - eventMove.clientX, y - eventMove.clientY);\r\n                    // Record new current position.\r\n                    x = eventMove.clientX;\r\n                    y = eventMove.clientY;\r\n                }\r\n            });\r\n        }\r\n    }\r\n}\r\n","/**\r\n * @license BSD\r\n * @copyright 2014-2022 hizzgdev@163.com\r\n *\r\n * Project Home:\r\n *   https://github.com/hizzgdev/jsmind/\r\n */\r\n\r\nimport { $ } from './jsmind.dom.js';\r\nimport { util } from './jsmind.util.js';\r\nimport { Direction } from './jsmind.common.js';\r\n\r\nexport class ShortcutProvider {\r\n    constructor(jm, options) {\r\n        this.jm = jm;\r\n        this.opts = options;\r\n        this.mapping = options.mapping;\r\n        this.handles = options.handles;\r\n        this._newid = null;\r\n        this._mapping = {};\r\n    }\r\n    init() {\r\n        $.on(this.jm.view.e_panel, 'keydown', this.handler.bind(this));\r\n\r\n        this.handles['addchild'] = this.handle_addchild;\r\n        this.handles['addbrother'] = this.handle_addbrother;\r\n        this.handles['editnode'] = this.handle_editnode;\r\n        this.handles['delnode'] = this.handle_delnode;\r\n        this.handles['toggle'] = this.handle_toggle;\r\n        this.handles['up'] = this.handle_up;\r\n        this.handles['down'] = this.handle_down;\r\n        this.handles['left'] = this.handle_left;\r\n        this.handles['right'] = this.handle_right;\r\n\r\n        for (var handle in this.mapping) {\r\n            if (!!this.mapping[handle] && handle in this.handles) {\r\n                this._mapping[this.mapping[handle]] = this.handles[handle];\r\n            }\r\n        }\r\n\r\n        if (typeof this.opts.id_generator === 'function') {\r\n            this._newid = this.opts.id_generator;\r\n        } else {\r\n            this._newid = util.uuid.newid;\r\n        }\r\n    }\r\n    enable_shortcut() {\r\n        this.opts.enable = true;\r\n    }\r\n    disable_shortcut() {\r\n        this.opts.enable = false;\r\n    }\r\n    handler(e) {\r\n        if (e.which == 9) {\r\n            e.preventDefault();\r\n        } //prevent tab to change focus in browser\r\n        if (this.jm.view.is_editing()) {\r\n            return;\r\n        }\r\n        var evt = e || event;\r\n        if (!this.opts.enable) {\r\n            return true;\r\n        }\r\n        var kc =\r\n            evt.keyCode +\r\n            (evt.metaKey << 13) +\r\n            (evt.ctrlKey << 12) +\r\n            (evt.altKey << 11) +\r\n            (evt.shiftKey << 10);\r\n        if (kc in this._mapping) {\r\n            this._mapping[kc].call(this, this.jm, e);\r\n        }\r\n    }\r\n    handle_addchild(_jm, e) {\r\n        var selected_node = _jm.get_selected_node();\r\n        if (!!selected_node) {\r\n            var node_id = this._newid();\r\n            var node = _jm.add_node(selected_node, node_id, 'New Node');\r\n            if (!!node) {\r\n                _jm.select_node(node_id);\r\n                _jm.begin_edit(node_id);\r\n            }\r\n        }\r\n    }\r\n    handle_addbrother(_jm, e) {\r\n        var selected_node = _jm.get_selected_node();\r\n        if (!!selected_node && !selected_node.isroot) {\r\n            var node_id = this._newid();\r\n            var node = _jm.insert_node_after(selected_node, node_id, 'New Node');\r\n            if (!!node) {\r\n                _jm.select_node(node_id);\r\n                _jm.begin_edit(node_id);\r\n            }\r\n        }\r\n    }\r\n    handle_editnode(_jm, e) {\r\n        var selected_node = _jm.get_selected_node();\r\n        if (!!selected_node) {\r\n            _jm.begin_edit(selected_node);\r\n        }\r\n    }\r\n    handle_delnode(_jm, e) {\r\n        var selected_node = _jm.get_selected_node();\r\n        if (!!selected_node && !selected_node.isroot) {\r\n            _jm.select_node(selected_node.parent);\r\n            _jm.remove_node(selected_node);\r\n        }\r\n    }\r\n    handle_toggle(_jm, e) {\r\n        var evt = e || event;\r\n        var selected_node = _jm.get_selected_node();\r\n        if (!!selected_node) {\r\n            _jm.toggle_node(selected_node.id);\r\n            evt.stopPropagation();\r\n            evt.preventDefault();\r\n        }\r\n    }\r\n    handle_up(_jm, e) {\r\n        var evt = e || event;\r\n        var selected_node = _jm.get_selected_node();\r\n        if (!!selected_node) {\r\n            var up_node = _jm.find_node_before(selected_node);\r\n            if (!up_node) {\r\n                var np = _jm.find_node_before(selected_node.parent);\r\n                if (!!np && np.children.length > 0) {\r\n                    up_node = np.children[np.children.length - 1];\r\n                }\r\n            }\r\n            if (!!up_node) {\r\n                _jm.select_node(up_node);\r\n            }\r\n            evt.stopPropagation();\r\n            evt.preventDefault();\r\n        }\r\n    }\r\n    handle_down(_jm, e) {\r\n        var evt = e || event;\r\n        var selected_node = _jm.get_selected_node();\r\n        if (!!selected_node) {\r\n            var down_node = _jm.find_node_after(selected_node);\r\n            if (!down_node) {\r\n                var np = _jm.find_node_after(selected_node.parent);\r\n                if (!!np && np.children.length > 0) {\r\n                    down_node = np.children[0];\r\n                }\r\n            }\r\n            if (!!down_node) {\r\n                _jm.select_node(down_node);\r\n            }\r\n            evt.stopPropagation();\r\n            evt.preventDefault();\r\n        }\r\n    }\r\n    handle_left(_jm, e) {\r\n        this._handle_direction(_jm, e, Direction.left);\r\n    }\r\n    handle_right(_jm, e) {\r\n        this._handle_direction(_jm, e, Direction.right);\r\n    }\r\n    _handle_direction(_jm, e, d) {\r\n        var evt = e || event;\r\n        var selected_node = _jm.get_selected_node();\r\n        var node = null;\r\n        if (!!selected_node) {\r\n            if (selected_node.isroot) {\r\n                var c = selected_node.children;\r\n                var children = [];\r\n                for (var i = 0; i < c.length; i++) {\r\n                    if (c[i].direction === d) {\r\n                        children.push(i);\r\n                    }\r\n                }\r\n                node = c[children[Math.floor((children.length - 1) / 2)]];\r\n            } else if (selected_node.direction === d) {\r\n                var children = selected_node.children;\r\n                var children_count = children.length;\r\n                if (children_count > 0) {\r\n                    node = children[Math.floor((children_count - 1) / 2)];\r\n                }\r\n            } else {\r\n                node = selected_node.parent;\r\n            }\r\n            if (!!node) {\r\n                _jm.select_node(node);\r\n            }\r\n            evt.stopPropagation();\r\n            evt.preventDefault();\r\n        }\r\n    }\r\n}\r\n","/*\r\n * @Author: lyttonlee lzr3278@163.com\r\n * @Date: 2022-08-31 11:32:02\r\n * @LastEditors: lyttonlee lzr3278@163.com\r\n * @LastEditTime: 2022-09-21 17:07:18\r\n * @FilePath: \\jsmind\\src\\jsmind.plugin.js\r\n * @Description: 这是默认设置,请设置`customMade`, 打开koroFileHeader查看配置 进行设置: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE\r\n */\r\n/**\r\n * @license BSD\r\n * @copyright 2014-2022 hizzgdev@163.com\r\n *\r\n * Project Home:\r\n *   https://github.com/hizzgdev/jsmind/\r\n */\r\n\r\nimport { $ } from './jsmind.dom.js';\r\n\r\nconst plugin_data = {\r\n    plugins: [],\r\n};\r\n\r\nconst plugins = new Map();\r\n\r\nexport function register(plugin) {\r\n    if (!plugin instanceof Plugin) {\r\n        throw new Error('plugin ' + plugin + ' is not a supported plugin');\r\n    }\r\n    plugin_data.plugins.push(plugin);\r\n}\r\n\r\n// export function getPlugins() {\r\n//     return plugins;\r\n// }\r\n\r\nexport function apply(jm) {\r\n    $.w.setTimeout(function () {\r\n        _apply(jm);\r\n    }, 0);\r\n}\r\n\r\nfunction _apply(jm) {\r\n    var l = plugin_data.plugins.length;\r\n    var fn_init = null;\r\n    for (var i = 0; i < l; i++) {\r\n        fn_init = plugin_data.plugins[i].init;\r\n        if (typeof fn_init === 'function') {\r\n            fn_init(jm);\r\n        }\r\n    }\r\n}\r\n\r\nexport class Plugin {\r\n    constructor(name, init) {\r\n        this.name = name;\r\n        this.init = init;\r\n    }\r\n}\r\n","/*\r\n * @Author: lyttonlee lzr3278@163.com\r\n * @Date: 2022-09-21 16:17:33\r\n * @LastEditors: lyttonlee lzr3278@163.com\r\n * @LastEditTime: 2022-09-22 15:09:00\r\n * @FilePath: \\jsmind\\src\\jsmind.plugin.ts\r\n * @Description: 这是默认设置,请设置`customMade`, 打开koroFileHeader查看配置 进行设置: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE\r\n */\r\n\r\ninterface initFunc {\r\n    (jm: any): void;\r\n}\r\n\r\ninterface PluginInterface {\r\n    name: string;\r\n    init: initFunc;\r\n}\r\n\r\nexport class Plugin implements PluginInterface {\r\n    name: string;\r\n    init: initFunc;\r\n    constructor(name: string, init: initFunc) {\r\n        this.name = name;\r\n        this.init = init;\r\n    }\r\n}\r\n\r\n// 插件集合\r\nconst plugins: Map<string, Plugin> = new Map();\r\n\r\n// 插件是否符合\r\nfunction isConformPlugin(plugin: Plugin): boolean {\r\n    return plugin.name && typeof plugin.init === 'function';\r\n}\r\n\r\n/**\r\n * @description: 注册插件\r\n * @param {Plugin} plugin\r\n * @return {*}\r\n */\r\nexport function registerPlugin(plugin: Plugin) {\r\n    if (isConformPlugin(plugin)) {\r\n        if (plugins.has(plugin.name)) {\r\n            throw new Error(`${plugin.name} 插件已被注册！`);\r\n        }\r\n        plugins.set(plugin.name, plugin);\r\n        return;\r\n    }\r\n    throw new Error('不可注册插件！');\r\n}\r\n\r\n/**\r\n * @description: 启用插件\r\n * @param {string} name\r\n * @param {any} jm jsmind instance\r\n * @return {*}\r\n */\r\nexport function enablePlugin(name: string, jm: any) {\r\n    if (plugins.has(name)) {\r\n        plugins.get(name)?.init(jm);\r\n    } else {\r\n        throw new Error(`请先注册${name}插件`);\r\n    }\r\n}\r\n","/**\r\n * @license BSD\r\n * @copyright 2014-2022 hizzgdev@163.com\r\n *\r\n * Project Home:\r\n *   https://github.com/hizzgdev/jsmind/\r\n */\r\n\r\nimport { __version__, logger, EventType, Direction } from './jsmind.common.js';\r\nimport { merge_option } from './jsmind.option.js';\r\nimport { Mind } from './jsmind.mind.js';\r\nimport { Node } from './jsmind.node.js';\r\nimport { DataProvider } from './jsmind.data_provider.js';\r\nimport { LayoutProvider } from './jsmind.layout_provider.js';\r\nimport { ViewProvider } from './jsmind.view_provider.js';\r\nimport { ShortcutProvider } from './jsmind.shortcut_provider.js';\r\nimport { Plugin, register as _register_plugin, apply as apply_plugins } from './jsmind.plugin.js';\r\nimport { format } from './jsmind.format.js';\r\nimport { $ } from './jsmind.dom.js';\r\nimport { util as _util } from './jsmind.util.js';\r\nimport { registerPlugin, enablePlugin } from './jsmind.plugins.ts';\r\n\r\nexport default class jsMind {\r\n    static mind = Mind;\r\n    static node = Node;\r\n    static direction = Direction;\r\n    static event_type = EventType;\r\n    static $ = $;\r\n    static plugin = Plugin;\r\n    static register_plugin = _register_plugin;\r\n    static util = _util;\r\n\r\n    constructor(options) {\r\n        jsMind.current = this;\r\n        this.version = __version__;\r\n        this.initialized = false;\r\n        this.mind = null;\r\n        this.event_handles = [];\r\n        this.options = merge_option(options);\r\n        this.plugins = options.plugins || [];\r\n        this.registerPlugin = registerPlugin;\r\n        this.enablePlugin = enablePlugin;\r\n        this.init();\r\n    }\r\n\r\n    init() {\r\n        if (!!this.initialized) {\r\n            return;\r\n        }\r\n        this.initialized = true;\r\n        var opts_layout = {\r\n            mode: this.options.mode,\r\n            hspace: this.options.layout.hspace,\r\n            vspace: this.options.layout.vspace,\r\n            pspace: this.options.layout.pspace,\r\n        };\r\n        var opts_view = {\r\n            container: this.options.container,\r\n            support_html: this.options.support_html,\r\n            engine: this.options.view.engine,\r\n            hmargin: this.options.view.hmargin,\r\n            vmargin: this.options.view.vmargin,\r\n            line_width: this.options.view.line_width,\r\n            line_color: this.options.view.line_color,\r\n            draggable: this.options.view.draggable,\r\n            hide_scrollbars_when_draggable: this.options.view.hide_scrollbars_when_draggable,\r\n        };\r\n        // create instance of function provider\r\n        this.data = new DataProvider(this);\r\n        this.layout = new LayoutProvider(this, opts_layout);\r\n        this.view = new ViewProvider(this, opts_view);\r\n        this.shortcut = new ShortcutProvider(this, this.options.shortcut);\r\n\r\n        this.data.init();\r\n        this.layout.init();\r\n        this.view.init();\r\n        this.shortcut.init();\r\n\r\n        this._event_bind();\r\n\r\n        apply_plugins(this);\r\n\r\n        if (this.plugins && this.plugins.length > 0) {\r\n            this.plugins.forEach(plugin => {\r\n                this.registerPlugin(plugin);\r\n                this.enablePlugin(plugin.name, this);\r\n            });\r\n        }\r\n    }\r\n    enable_edit() {\r\n        this.options.editable = true;\r\n    }\r\n    disable_edit() {\r\n        this.options.editable = false;\r\n    }\r\n    // options are 'mousedown', 'click', 'dblclick', 'mousewheel'\r\n    enable_event_handle(event_handle) {\r\n        this.options.default_event_handle['enable_' + event_handle + '_handle'] = true;\r\n    }\r\n    // options are 'mousedown', 'click', 'dblclick', 'mousewheel'\r\n    disable_event_handle(event_handle) {\r\n        this.options.default_event_handle['enable_' + event_handle + '_handle'] = false;\r\n    }\r\n    get_editable() {\r\n        return this.options.editable;\r\n    }\r\n    set_theme(theme) {\r\n        var theme_old = this.options.theme;\r\n        this.options.theme = !!theme ? theme : null;\r\n        if (theme_old != this.options.theme) {\r\n            this.view.reset_theme();\r\n            this.view.reset_custom_style();\r\n        }\r\n    }\r\n    _event_bind() {\r\n        this.view.add_event(this, 'mousedown', this.mousedown_handle);\r\n        this.view.add_event(this, 'click', this.click_handle);\r\n        this.view.add_event(this, 'dblclick', this.dblclick_handle);\r\n        this.view.add_event(this, 'mousewheel', this.mousewheel_handle);\r\n    }\r\n    mousedown_handle(e) {\r\n        if (!this.options.default_event_handle['enable_mousedown_handle']) {\r\n            return;\r\n        }\r\n        var element = e.target || event.srcElement;\r\n        var node_id = this.view.get_binded_nodeid(element);\r\n        if (!!node_id) {\r\n            if (element.tagName.toLowerCase() == 'jmnode') {\r\n                this.select_node(node_id);\r\n            }\r\n        } else {\r\n            this.select_clear();\r\n        }\r\n    }\r\n    click_handle(e) {\r\n        if (!this.options.default_event_handle['enable_click_handle']) {\r\n            return;\r\n        }\r\n        var element = e.target || event.srcElement;\r\n        var is_expander = this.view.is_expander(element);\r\n        if (is_expander) {\r\n            var node_id = this.view.get_binded_nodeid(element);\r\n            if (!!node_id) {\r\n                this.toggle_node(node_id);\r\n            }\r\n        }\r\n    }\r\n    dblclick_handle(e) {\r\n        if (!this.options.default_event_handle['enable_dblclick_handle']) {\r\n            return;\r\n        }\r\n        if (this.get_editable()) {\r\n            var element = e.target || event.srcElement;\r\n            var node_id = this.view.get_binded_nodeid(element);\r\n            if (!!node_id) {\r\n                this.begin_edit(node_id);\r\n            }\r\n        }\r\n    }\r\n    // Use [Ctrl] + Mousewheel, to zoom in/out.\r\n    mousewheel_handle(e) {\r\n        // Test if mousewheel option is enabled and Ctrl key is pressed.\r\n        if (!this.options.default_event_handle['enable_mousewheel_handle'] || !e.ctrlKey) {\r\n            return;\r\n        }\r\n        var evt = e || event;\r\n        // Avoid default page scrolling behavior.\r\n        evt.preventDefault();\r\n\r\n        if (evt.deltaY > 0) {\r\n            this.view.zoomIn(); // wheel up\r\n        } else {\r\n            this.view.zoomOut();\r\n        }\r\n    }\r\n    begin_edit(node) {\r\n        if (!Node.is_node(node)) {\r\n            var the_node = this.get_node(node);\r\n            if (!the_node) {\r\n                logger.error('the node[id=' + node + '] can not be found.');\r\n                return false;\r\n            } else {\r\n                return this.begin_edit(the_node);\r\n            }\r\n        }\r\n        if (this.get_editable()) {\r\n            this.view.edit_node_begin(node);\r\n        } else {\r\n            logger.error('fail, this mind map is not editable.');\r\n            return;\r\n        }\r\n    }\r\n    end_edit() {\r\n        this.view.edit_node_end();\r\n    }\r\n    toggle_node(node) {\r\n        if (!Node.is_node(node)) {\r\n            var the_node = this.get_node(node);\r\n            if (!the_node) {\r\n                logger.error('the node[id=' + node + '] can not be found.');\r\n                return;\r\n            } else {\r\n                return this.toggle_node(the_node);\r\n            }\r\n        }\r\n        if (node.isroot) {\r\n            return;\r\n        }\r\n        this.view.save_location(node);\r\n        this.layout.toggle_node(node);\r\n        this.view.relayout();\r\n        this.view.restore_location(node);\r\n    }\r\n    expand_node(node) {\r\n        if (!Node.is_node(node)) {\r\n            var the_node = this.get_node(node);\r\n            if (!the_node) {\r\n                logger.error('the node[id=' + node + '] can not be found.');\r\n                return;\r\n            } else {\r\n                return this.expand_node(the_node);\r\n            }\r\n        }\r\n        if (node.isroot) {\r\n            return;\r\n        }\r\n        this.view.save_location(node);\r\n        this.layout.expand_node(node);\r\n        this.view.relayout();\r\n        this.view.restore_location(node);\r\n    }\r\n    collapse_node(node) {\r\n        if (!Node.is_node(node)) {\r\n            var the_node = this.get_node(node);\r\n            if (!the_node) {\r\n                logger.error('the node[id=' + node + '] can not be found.');\r\n                return;\r\n            } else {\r\n                return this.collapse_node(the_node);\r\n            }\r\n        }\r\n        if (node.isroot) {\r\n            return;\r\n        }\r\n        this.view.save_location(node);\r\n        this.layout.collapse_node(node);\r\n        this.view.relayout();\r\n        this.view.restore_location(node);\r\n    }\r\n    expand_all() {\r\n        this.layout.expand_all();\r\n        this.view.relayout();\r\n    }\r\n    collapse_all() {\r\n        this.layout.collapse_all();\r\n        this.view.relayout();\r\n    }\r\n    expand_to_depth(depth) {\r\n        this.layout.expand_to_depth(depth);\r\n        this.view.relayout();\r\n    }\r\n    _reset() {\r\n        this.view.reset();\r\n        this.layout.reset();\r\n        this.data.reset();\r\n    }\r\n    _show(mind) {\r\n        var m = mind || format.node_array.example;\r\n\r\n        this.mind = this.data.load(m);\r\n        if (!this.mind) {\r\n            logger.error('data.load error');\r\n            return;\r\n        } else {\r\n            logger.debug('data.load ok');\r\n        }\r\n\r\n        this.view.load();\r\n        logger.debug('view.load ok');\r\n\r\n        this.layout.layout();\r\n        logger.debug('layout.layout ok');\r\n\r\n        this.view.show(true);\r\n        logger.debug('view.show ok');\r\n\r\n        this.invoke_event_handle(EventType.show, { data: [mind] });\r\n    }\r\n    show(mind) {\r\n        this._reset();\r\n        this._show(mind);\r\n    }\r\n    get_meta() {\r\n        return {\r\n            name: this.mind.name,\r\n            author: this.mind.author,\r\n            version: this.mind.version,\r\n        };\r\n    }\r\n    get_data(data_format) {\r\n        var df = data_format || 'node_tree';\r\n        return this.data.get_data(df);\r\n    }\r\n    get_root() {\r\n        return this.mind.root;\r\n    }\r\n    get_node(node) {\r\n        if (Node.is_node(node)) {\r\n            return node;\r\n        }\r\n        return this.mind.get_node(node);\r\n    }\r\n    add_node(parent_node, node_id, topic, data) {\r\n        if (this.get_editable()) {\r\n            var the_parent_node = this.get_node(parent_node);\r\n            var direction = this.layout.calculate_next_child_direction(the_parent_node);\r\n            var node = this.mind.add_node(the_parent_node, node_id, topic, data, direction);\r\n            if (!!node) {\r\n                this.view.add_node(node);\r\n                this.layout.layout();\r\n                this.view.show(false);\r\n                this.view.reset_node_custom_style(node);\r\n                this.expand_node(the_parent_node);\r\n                this.invoke_event_handle(EventType.edit, {\r\n                    evt: 'add_node',\r\n                    data: [the_parent_node.id, node_id, topic, data],\r\n                    node: node_id,\r\n                });\r\n            }\r\n            return node;\r\n        } else {\r\n            logger.error('fail, this mind map is not editable');\r\n            return null;\r\n        }\r\n    }\r\n    insert_node_before(node_before, node_id, topic, data) {\r\n        if (this.get_editable()) {\r\n            var the_node_before = this.get_node(node_before);\r\n            var direction = this.layout.calculate_next_child_direction(the_node_before.parent);\r\n            var node = this.mind.insert_node_before(\r\n                the_node_before,\r\n                node_id,\r\n                topic,\r\n                data,\r\n                direction\r\n            );\r\n            if (!!node) {\r\n                this.view.add_node(node);\r\n                this.layout.layout();\r\n                this.view.show(false);\r\n                this.invoke_event_handle(EventType.edit, {\r\n                    evt: 'insert_node_before',\r\n                    data: [the_node_before.id, node_id, topic, data],\r\n                    node: node_id,\r\n                });\r\n            }\r\n            return node;\r\n        } else {\r\n            logger.error('fail, this mind map is not editable');\r\n            return null;\r\n        }\r\n    }\r\n    insert_node_after(node_after, node_id, topic, data) {\r\n        if (this.get_editable()) {\r\n            var the_node_after = this.get_node(node_after);\r\n            var direction = this.layout.calculate_next_child_direction(the_node_after.parent);\r\n            var node = this.mind.insert_node_after(the_node_after, node_id, topic, data, direction);\r\n            if (!!node) {\r\n                this.view.add_node(node);\r\n                this.layout.layout();\r\n                this.view.show(false);\r\n                this.invoke_event_handle(EventType.edit, {\r\n                    evt: 'insert_node_after',\r\n                    data: [the_node_after.id, node_id, topic, data],\r\n                    node: node_id,\r\n                });\r\n            }\r\n            return node;\r\n        } else {\r\n            logger.error('fail, this mind map is not editable');\r\n            return null;\r\n        }\r\n    }\r\n    remove_node(node) {\r\n        if (!Node.is_node(node)) {\r\n            var the_node = this.get_node(node);\r\n            if (!the_node) {\r\n                logger.error('the node[id=' + node + '] can not be found.');\r\n                return false;\r\n            } else {\r\n                return this.remove_node(the_node);\r\n            }\r\n        }\r\n        if (this.get_editable()) {\r\n            if (node.isroot) {\r\n                logger.error('fail, can not remove root node');\r\n                return false;\r\n            }\r\n            var node_id = node.id;\r\n            var parent_id = node.parent.id;\r\n            var parent_node = this.get_node(parent_id);\r\n            this.view.save_location(parent_node);\r\n            this.view.remove_node(node);\r\n            this.mind.remove_node(node);\r\n            this.layout.layout();\r\n            this.view.show(false);\r\n            this.view.restore_location(parent_node);\r\n            this.invoke_event_handle(EventType.edit, {\r\n                evt: 'remove_node',\r\n                data: [node_id],\r\n                node: parent_id,\r\n            });\r\n            return true;\r\n        } else {\r\n            logger.error('fail, this mind map is not editable');\r\n            return false;\r\n        }\r\n    }\r\n    update_node(node_id, topic) {\r\n        if (this.get_editable()) {\r\n            if (_util.text.is_empty(topic)) {\r\n                logger.warn('fail, topic can not be empty');\r\n                return;\r\n            }\r\n            var node = this.get_node(node_id);\r\n            if (!!node) {\r\n                if (node.topic === topic) {\r\n                    logger.info('nothing changed');\r\n                    this.view.update_node(node);\r\n                    return;\r\n                }\r\n                node.topic = topic;\r\n                this.view.update_node(node);\r\n                this.layout.layout();\r\n                this.view.show(false);\r\n                this.invoke_event_handle(EventType.edit, {\r\n                    evt: 'update_node',\r\n                    data: [node_id, topic],\r\n                    node: node_id,\r\n                });\r\n            }\r\n        } else {\r\n            logger.error('fail, this mind map is not editable');\r\n            return;\r\n        }\r\n    }\r\n    move_node(node_id, before_id, parent_id, direction) {\r\n        if (this.get_editable()) {\r\n            var node = this.get_node(node_id);\r\n            var updated_node = this.mind.move_node(node, before_id, parent_id, direction);\r\n            if (!!updated_node) {\r\n                this.view.update_node(updated_node);\r\n                this.layout.layout();\r\n                this.view.show(false);\r\n                this.invoke_event_handle(EventType.edit, {\r\n                    evt: 'move_node',\r\n                    data: [node_id, before_id, parent_id, direction],\r\n                    node: node_id,\r\n                });\r\n            }\r\n        } else {\r\n            logger.error('fail, this mind map is not editable');\r\n            return;\r\n        }\r\n    }\r\n    select_node(node) {\r\n        if (!Node.is_node(node)) {\r\n            var the_node = this.get_node(node);\r\n            if (!the_node) {\r\n                logger.error('the node[id=' + node + '] can not be found.');\r\n                return;\r\n            } else {\r\n                return this.select_node(the_node);\r\n            }\r\n        }\r\n        if (!this.layout.is_visible(node)) {\r\n            return;\r\n        }\r\n        this.mind.selected = node;\r\n        this.view.select_node(node);\r\n        this.invoke_event_handle(EventType.select, { evt: 'select_node', data: [], node: node.id });\r\n    }\r\n    get_selected_node() {\r\n        if (!!this.mind) {\r\n            return this.mind.selected;\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n    select_clear() {\r\n        if (!!this.mind) {\r\n            this.mind.selected = null;\r\n            this.view.select_clear();\r\n        }\r\n    }\r\n    is_node_visible(node) {\r\n        return this.layout.is_visible(node);\r\n    }\r\n    find_node_before(node) {\r\n        if (!Node.is_node(node)) {\r\n            var the_node = this.get_node(node);\r\n            if (!the_node) {\r\n                logger.error('the node[id=' + node + '] can not be found.');\r\n                return;\r\n            } else {\r\n                return this.find_node_before(the_node);\r\n            }\r\n        }\r\n        if (node.isroot) {\r\n            return null;\r\n        }\r\n        var n = null;\r\n        if (node.parent.isroot) {\r\n            var c = node.parent.children;\r\n            var prev = null;\r\n            var ni = null;\r\n            for (var i = 0; i < c.length; i++) {\r\n                ni = c[i];\r\n                if (node.direction === ni.direction) {\r\n                    if (node.id === ni.id) {\r\n                        n = prev;\r\n                    }\r\n                    prev = ni;\r\n                }\r\n            }\r\n        } else {\r\n            n = this.mind.get_node_before(node);\r\n        }\r\n        return n;\r\n    }\r\n    find_node_after(node) {\r\n        if (!Node.is_node(node)) {\r\n            var the_node = this.get_node(node);\r\n            if (!the_node) {\r\n                logger.error('the node[id=' + node + '] can not be found.');\r\n                return;\r\n            } else {\r\n                return this.find_node_after(the_node);\r\n            }\r\n        }\r\n        if (node.isroot) {\r\n            return null;\r\n        }\r\n        var n = null;\r\n        if (node.parent.isroot) {\r\n            var c = node.parent.children;\r\n            var found = false;\r\n            var ni = null;\r\n            for (var i = 0; i < c.length; i++) {\r\n                ni = c[i];\r\n                if (node.direction === ni.direction) {\r\n                    if (found) {\r\n                        n = ni;\r\n                        break;\r\n                    }\r\n                    if (node.id === ni.id) {\r\n                        found = true;\r\n                    }\r\n                }\r\n            }\r\n        } else {\r\n            n = this.mind.get_node_after(node);\r\n        }\r\n        return n;\r\n    }\r\n    set_node_color(node_id, bg_color, fg_color) {\r\n        if (this.get_editable()) {\r\n            var node = this.mind.get_node(node_id);\r\n            if (!!node) {\r\n                if (!!bg_color) {\r\n                    node.data['background-color'] = bg_color;\r\n                }\r\n                if (!!fg_color) {\r\n                    node.data['foreground-color'] = fg_color;\r\n                }\r\n                this.view.reset_node_custom_style(node);\r\n            }\r\n        } else {\r\n            logger.error('fail, this mind map is not editable');\r\n            return null;\r\n        }\r\n    }\r\n    set_node_font_style(node_id, size, weight, style) {\r\n        if (this.get_editable()) {\r\n            var node = this.mind.get_node(node_id);\r\n            if (!!node) {\r\n                if (!!size) {\r\n                    node.data['font-size'] = size;\r\n                }\r\n                if (!!weight) {\r\n                    node.data['font-weight'] = weight;\r\n                }\r\n                if (!!style) {\r\n                    node.data['font-style'] = style;\r\n                }\r\n                this.view.reset_node_custom_style(node);\r\n                this.view.update_node(node);\r\n                this.layout.layout();\r\n                this.view.show(false);\r\n            }\r\n        } else {\r\n            logger.error('fail, this mind map is not editable');\r\n            return null;\r\n        }\r\n    }\r\n    set_node_background_image(node_id, image, width, height, rotation) {\r\n        if (this.get_editable()) {\r\n            var node = this.mind.get_node(node_id);\r\n            if (!!node) {\r\n                if (!!image) {\r\n                    node.data['background-image'] = image;\r\n                }\r\n                if (!!width) {\r\n                    node.data['width'] = width;\r\n                }\r\n                if (!!height) {\r\n                    node.data['height'] = height;\r\n                }\r\n                if (!!rotation) {\r\n                    node.data['background-rotation'] = rotation;\r\n                }\r\n                this.view.reset_node_custom_style(node);\r\n                this.view.update_node(node);\r\n                this.layout.layout();\r\n                this.view.show(false);\r\n            }\r\n        } else {\r\n            logger.error('fail, this mind map is not editable');\r\n            return null;\r\n        }\r\n    }\r\n    set_node_background_rotation(node_id, rotation) {\r\n        if (this.get_editable()) {\r\n            var node = this.mind.get_node(node_id);\r\n            if (!!node) {\r\n                if (!node.data['background-image']) {\r\n                    logger.error(\r\n                        'fail, only can change rotation angle of node with background image'\r\n                    );\r\n                    return null;\r\n                }\r\n                node.data['background-rotation'] = rotation;\r\n                this.view.reset_node_custom_style(node);\r\n                this.view.update_node(node);\r\n                this.layout.layout();\r\n                this.view.show(false);\r\n            }\r\n        } else {\r\n            logger.error('fail, this mind map is not editable');\r\n            return null;\r\n        }\r\n    }\r\n    resize() {\r\n        this.view.resize();\r\n    }\r\n    // callback(type ,data)\r\n    add_event_listener(callback) {\r\n        if (typeof callback === 'function') {\r\n            this.event_handles.push(callback);\r\n        }\r\n    }\r\n    clear_event_listener() {\r\n        this.event_handles = [];\r\n    }\r\n    invoke_event_handle(type, data) {\r\n        var j = this;\r\n        $.w.setTimeout(function () {\r\n            j._invoke_event_handle(type, data);\r\n        }, 0);\r\n    }\r\n    _invoke_event_handle(type, data) {\r\n        var l = this.event_handles.length;\r\n        for (var i = 0; i < l; i++) {\r\n            this.event_handles[i](type, data);\r\n        }\r\n    }\r\n\r\n    // quick way\r\n    static show(options, mind) {\r\n        var _jm = new jsMind(options);\r\n        _jm.show(mind);\r\n        return _jm;\r\n    }\r\n}\r\n","/**\r\n * @license BSD\r\n * @copyright 2014-2022 hizzgdev@163.com\r\n *\r\n * Project Home:\r\n *   https://github.com/hizzgdev/jsmind/\r\n */\r\n\r\n// if (!jsMind) {\r\n//     throw new Error('jsMind is not defined');\r\n// }\r\n\r\nimport jsMind from '../jsmind'\r\nimport { $ } from '../jsmind.dom'\r\nimport { Plugin } from '../jsmind.plugins.ts'\r\n\r\nconst clear_selection =\r\n    'getSelection' in $.w\r\n        ? function () {\r\n              $.w.getSelection().removeAllRanges();\r\n          }\r\n        : function () {\r\n              $.d.selection.empty();\r\n          };\r\n\r\nconst options = {\r\n    line_width: 5,\r\n    lookup_delay: 500,\r\n    lookup_interval: 80,\r\n};\r\n\r\nclass draggable {\r\n    constructor(jm) {\r\n        this.jm = jm;\r\n        this.e_canvas = null;\r\n        this.canvas_ctx = null;\r\n        this.shadow = null;\r\n        this.shadow_w = 0;\r\n        this.shadow_h = 0;\r\n        this.active_node = null;\r\n        this.target_node = null;\r\n        this.target_direct = null;\r\n        this.client_w = 0;\r\n        this.client_h = 0;\r\n        this.offset_x = 0;\r\n        this.offset_y = 0;\r\n        this.hlookup_delay = 0;\r\n        this.hlookup_timer = 0;\r\n        this.capture = false;\r\n        this.moved = false;\r\n    }\r\n\r\n    init() {\r\n        this._create_canvas();\r\n        this._create_shadow();\r\n        this._event_bind();\r\n    }\r\n    resize() {\r\n        this.shadow && this.jm.view.e_nodes.appendChild(this.shadow);\r\n        this.e_canvas.width = this.jm.view.size.w;\r\n        this.e_canvas.height = this.jm.view.size.h;\r\n    }\r\n    _create_canvas() {\r\n        var c = $.c('canvas');\r\n        this.jm.view.e_panel.appendChild(c);\r\n        var ctx = c.getContext('2d');\r\n        this.e_canvas = c;\r\n        this.canvas_ctx = ctx;\r\n    }\r\n    _create_shadow() {\r\n        var s = $.c('jmnode');\r\n        s.style.visibility = 'hidden';\r\n        s.style.zIndex = '3';\r\n        s.style.cursor = 'move';\r\n        s.style.opacity = '0.7';\r\n        this.shadow = s;\r\n    }\r\n    reset_shadow(el) {\r\n        var s = this.shadow.style;\r\n        this.shadow.innerHTML = el.innerHTML;\r\n        s.left = el.style.left;\r\n        s.top = el.style.top;\r\n        s.width = el.style.width;\r\n        s.height = el.style.height;\r\n        s.backgroundImage = el.style.backgroundImage;\r\n        s.backgroundSize = el.style.backgroundSize;\r\n        s.transform = el.style.transform;\r\n        this.shadow_w = this.shadow.clientWidth;\r\n        this.shadow_h = this.shadow.clientHeight;\r\n    }\r\n    show_shadow() {\r\n        if (!this.moved) {\r\n            this.shadow.style.visibility = 'visible';\r\n        }\r\n    }\r\n    hide_shadow() {\r\n        this.shadow.style.visibility = 'hidden';\r\n    }\r\n    _magnet_shadow(node) {\r\n        if (!!node) {\r\n            this.canvas_ctx.lineWidth = options.line_width;\r\n            this.canvas_ctx.strokeStyle = 'rgba(0,0,0,0.3)';\r\n            this.canvas_ctx.lineCap = 'round';\r\n            this._clear_lines();\r\n            this._canvas_lineto(node.sp.x, node.sp.y, node.np.x, node.np.y);\r\n        }\r\n    }\r\n    _clear_lines() {\r\n        this.canvas_ctx.clearRect(0, 0, this.jm.view.size.w, this.jm.view.size.h);\r\n    }\r\n    _canvas_lineto(x1, y1, x2, y2) {\r\n        this.canvas_ctx.beginPath();\r\n        this.canvas_ctx.moveTo(x1, y1);\r\n        this.canvas_ctx.lineTo(x2, y2);\r\n        this.canvas_ctx.stroke();\r\n    }\r\n    _lookup_close_node() {\r\n        var root = this.jm.get_root();\r\n        var root_location = root.get_location();\r\n        var root_size = root.get_size();\r\n        var root_x = root_location.x + root_size.w / 2;\r\n\r\n        var sw = this.shadow_w;\r\n        var sh = this.shadow_h;\r\n        var sx = this.shadow.offsetLeft;\r\n        var sy = this.shadow.offsetTop;\r\n\r\n        var ns, nl;\r\n\r\n        var direct = sx + sw / 2 >= root_x ? jsMind.direction.right : jsMind.direction.left;\r\n        var nodes = this.jm.mind.nodes;\r\n        var node = null;\r\n        var layout = this.jm.layout;\r\n        var min_distance = Number.MAX_VALUE;\r\n        var distance = 0;\r\n        var closest_node = null;\r\n        var closest_p = null;\r\n        var shadow_p = null;\r\n        for (var nodeid in nodes) {\r\n            var np, sp;\r\n            node = nodes[nodeid];\r\n            if (node.isroot || node.direction == direct) {\r\n                if (node.id == this.active_node.id) {\r\n                    continue;\r\n                }\r\n                if (!layout.is_visible(node)) {\r\n                    continue;\r\n                }\r\n                ns = node.get_size();\r\n                nl = node.get_location();\r\n                if (direct == jsMind.direction.right) {\r\n                    if (sx - nl.x - ns.w <= 0) {\r\n                        continue;\r\n                    }\r\n                    distance = Math.abs(sx - nl.x - ns.w) + Math.abs(sy + sh / 2 - nl.y - ns.h / 2);\r\n                    np = { x: nl.x + ns.w - options.line_width, y: nl.y + ns.h / 2 };\r\n                    sp = { x: sx + options.line_width, y: sy + sh / 2 };\r\n                } else {\r\n                    if (nl.x - sx - sw <= 0) {\r\n                        continue;\r\n                    }\r\n                    distance = Math.abs(sx + sw - nl.x) + Math.abs(sy + sh / 2 - nl.y - ns.h / 2);\r\n                    np = { x: nl.x + options.line_width, y: nl.y + ns.h / 2 };\r\n                    sp = { x: sx + sw - options.line_width, y: sy + sh / 2 };\r\n                }\r\n                if (distance < min_distance) {\r\n                    closest_node = node;\r\n                    closest_p = np;\r\n                    shadow_p = sp;\r\n                    min_distance = distance;\r\n                }\r\n            }\r\n        }\r\n        var result_node = null;\r\n        if (!!closest_node) {\r\n            result_node = {\r\n                node: closest_node,\r\n                direction: direct,\r\n                sp: shadow_p,\r\n                np: closest_p,\r\n            };\r\n        }\r\n        return result_node;\r\n    }\r\n    lookup_close_node() {\r\n        var node_data = this._lookup_close_node();\r\n        if (!!node_data) {\r\n            this._magnet_shadow(node_data);\r\n            this.target_node = node_data.node;\r\n            this.target_direct = node_data.direction;\r\n        }\r\n    }\r\n    _event_bind() {\r\n        var jd = this;\r\n        var container = this.jm.view.container;\r\n        $.on(container, 'mousedown', function (e) {\r\n            var evt = e || event;\r\n            jd.dragstart.call(jd, evt);\r\n        });\r\n        $.on(container, 'mousemove', function (e) {\r\n            var evt = e || event;\r\n            jd.drag.call(jd, evt);\r\n        });\r\n        $.on(container, 'mouseup', function (e) {\r\n            var evt = e || event;\r\n            jd.dragend.call(jd, evt);\r\n        });\r\n        $.on(container, 'touchstart', function (e) {\r\n            var evt = e || event;\r\n            jd.dragstart.call(jd, evt);\r\n        });\r\n        $.on(container, 'touchmove', function (e) {\r\n            var evt = e || event;\r\n            jd.drag.call(jd, evt);\r\n        });\r\n        $.on(container, 'touchend', function (e) {\r\n            var evt = e || event;\r\n            jd.dragend.call(jd, evt);\r\n        });\r\n    }\r\n    dragstart(e) {\r\n        if (!this.jm.get_editable()) {\r\n            return;\r\n        }\r\n        if (this.capture) {\r\n            return;\r\n        }\r\n        this.active_node = null;\r\n\r\n        var jview = this.jm.view;\r\n        var el = e.target || event.srcElement;\r\n        if (el.tagName.toLowerCase() != 'jmnode') {\r\n            return;\r\n        }\r\n        var nodeid = jview.get_binded_nodeid(el);\r\n        if (!!nodeid) {\r\n            var node = this.jm.get_node(nodeid);\r\n            if (!node.isroot) {\r\n                this.reset_shadow(el);\r\n                this.active_node = node;\r\n                this.offset_x =\r\n                    (e.clientX || e.touches[0].clientX) / jview.actualZoom - el.offsetLeft;\r\n                this.offset_y =\r\n                    (e.clientY || e.touches[0].clientY) / jview.actualZoom - el.offsetTop;\r\n                this.client_hw = Math.floor(el.clientWidth / 2);\r\n                this.client_hh = Math.floor(el.clientHeight / 2);\r\n                if (this.hlookup_delay != 0) {\r\n                    $.w.clearTimeout(this.hlookup_delay);\r\n                }\r\n                if (this.hlookup_timer != 0) {\r\n                    $.w.clearInterval(this.hlookup_timer);\r\n                }\r\n                var jd = this;\r\n                this.hlookup_delay = $.w.setTimeout(function () {\r\n                    jd.hlookup_delay = 0;\r\n                    jd.hlookup_timer = $.w.setInterval(function () {\r\n                        jd.lookup_close_node.call(jd);\r\n                    }, options.lookup_interval);\r\n                }, options.lookup_delay);\r\n                this.capture = true;\r\n            }\r\n        }\r\n    }\r\n    drag(e) {\r\n        if (!this.jm.get_editable()) {\r\n            return;\r\n        }\r\n        if (this.capture) {\r\n            e.preventDefault();\r\n            this.show_shadow();\r\n            this.moved = true;\r\n            clear_selection();\r\n            var jview = this.jm.view;\r\n            var px = (e.clientX || e.touches[0].clientX) / jview.actualZoom - this.offset_x;\r\n            var py = (e.clientY || e.touches[0].clientY) / jview.actualZoom - this.offset_y;\r\n            this.shadow.style.left = px + 'px';\r\n            this.shadow.style.top = py + 'px';\r\n            clear_selection();\r\n        }\r\n    }\r\n    dragend(e) {\r\n        if (!this.jm.get_editable()) {\r\n            return;\r\n        }\r\n        if (this.capture) {\r\n            if (this.hlookup_delay != 0) {\r\n                $.w.clearTimeout(this.hlookup_delay);\r\n                this.hlookup_delay = 0;\r\n                this._clear_lines();\r\n            }\r\n            if (this.hlookup_timer != 0) {\r\n                $.w.clearInterval(this.hlookup_timer);\r\n                this.hlookup_timer = 0;\r\n                this._clear_lines();\r\n            }\r\n            if (this.moved) {\r\n                var src_node = this.active_node;\r\n                var target_node = this.target_node;\r\n                var target_direct = this.target_direct;\r\n                this.move_node(src_node, target_node, target_direct);\r\n            }\r\n            this.hide_shadow();\r\n        }\r\n        this.moved = false;\r\n        this.capture = false;\r\n    }\r\n    move_node(src_node, target_node, target_direct) {\r\n        var shadow_h = this.shadow.offsetTop;\r\n        if (!!target_node && !!src_node && !jsMind.node.inherited(src_node, target_node)) {\r\n            // lookup before_node\r\n            var sibling_nodes = target_node.children;\r\n            var sc = sibling_nodes.length;\r\n            var node = null;\r\n            var delta_y = Number.MAX_VALUE;\r\n            var node_before = null;\r\n            var beforeid = '_last_';\r\n            while (sc--) {\r\n                node = sibling_nodes[sc];\r\n                if (node.direction == target_direct && node.id != src_node.id) {\r\n                    var dy = node.get_location().y - shadow_h;\r\n                    if (dy > 0 && dy < delta_y) {\r\n                        delta_y = dy;\r\n                        node_before = node;\r\n                        beforeid = '_first_';\r\n                    }\r\n                }\r\n            }\r\n            if (!!node_before) {\r\n                beforeid = node_before.id;\r\n            }\r\n            this.jm.move_node(src_node.id, beforeid, target_node.id, target_direct);\r\n        }\r\n        this.active_node = null;\r\n        this.target_node = null;\r\n        this.target_direct = null;\r\n    }\r\n    jm_event_handle(type, data) {\r\n        if (type === jsMind.event_type.resize) {\r\n            this.resize();\r\n        }\r\n    }\r\n}\r\n\r\nfunction installDragPlugin() { \r\n    const plugin = new Plugin('draggable', function (jm) {\r\n        const dragPlugin = new draggable(jm)\r\n        dragPlugin.init()\r\n        jm.add_event_listener(function (type, data) {\r\n            dragPlugin.jm_event_handle.call(dragPlugin, type, data);\r\n        });\r\n    })\r\n    return plugin\r\n}\r\n\r\nexport default installDragPlugin;\r\n"],"names":["__version__","__author__","String","prototype","startsWith","p","this","slice","length","_noop","logger","console","log","debug","error","warn","info","Direction","left","center","right","EventType","show","resize","edit","select","$","constructor","w","d","document","g","id","getElementById","c","tag","createElement","t","n","hasChildNodes","firstChild","nodeValue","appendChild","createTextNode","h","HTMLElement","innerHTML","i","el","nodeType","style","ownerDocument","on","e","addEventListener","attachEvent","window","util","ajax","request","url","param","method","callback","fail_callback","Object","keys","map","k","encodeURIComponent","join","xhr","XMLHttpRequest","onreadystatechange","readyState","status","data","json","string2json","responseText","open","setRequestHeader","send","get","post","file","read","file_data","fn_callback","reader","FileReader","onload","result","name","readAsText","save","type","blob","Blob","bb","BlobBuilder","MozBlobBuilder","WebKitBlobBuilder","MSBlobBuilder","append","getBlob","navigator","msSaveBlob","blob_url","URL","webkitURL","createObjectURL","anchor","visibility","href","download","body","evt","createEvent","initEvent","dispatchEvent","removeChild","location","json2string","JSON","stringify","json_str","parse","merge","b","a","o","toString","call","toLowerCase","uuid","newid","Date","getTime","Math","random","substring","text","is_empty","s","replace","default_options","container","editable","theme","mode","support_html","view","engine","hmargin","vmargin","line_width","line_color","draggable","hide_scrollbars_when_draggable","layout","hspace","vspace","pspace","default_event_handle","enable_mousedown_handle","enable_click_handle","enable_dblclick_handle","enable_mousewheel_handle","shortcut","enable","handles","mapping","addchild","addbrother","editnode","delnode","toggle","up","down","Node","sId","iIndex","sTopic","oData","bIsRoot","oParent","eDirection","bExpanded","index","topic","isroot","parent","direction","expanded","children","_data","get_location","vd","x","abs_x","y","abs_y","get_size","width","height","static","node1","node2","i1","i2","parent_node","node","pid","Mind","author","version","root","selected","nodes","get_node","node_id","set_root","_put_node","add_node","idx","is_node","push","_update_index","insert_node_before","node_before","node_index","get_node_before","the_node","insert_node_after","node_after","get_node_after","move_node","before_id","parent_id","_move_node","_flow_node_direction","len","_move_node_internal","inherited","sibling","si","splice","remove_node","ci","sort","compare","format","node_tree","example","meta","get_mind","source","df","mind","_parse","get_data","_build_node","node_root","_extract_data","_extract_subnode","node_json","node_parent","node_data","node_array","_array","reverse","root_node","_extract_root","root_json","extract_count","parentid","node_direction","sub_extract_count","_array_node","freemind","xml","xml_doc","_parse_xml","xml_root","_find_root","_load_node","xml_lines","_build_map","DOMParser","parseFromString","ActiveXObject","async","loadXML","childNodes","tagName","ns","xml_node","getAttribute","node_topic","topic_children","topic_child","textContent","_load_attributes","node_expanded","node_position","child","attr","attr_data","pos","DataProvider","jm","init","reset","load","mind_data","data_format","LayoutProvider","options","opts","isside","bounds","cache_valid","calculate_next_child_direction","children_len","r","layout_direction","layout_offset","_layout_direction_root","layout_data","children_count","side_index","_layout_direction_side","subnode","offset_x","offset_y","outer_height","left_nodes","right_nodes","unshift","outer_height_left","_layout_offset_subnodes","outer_height_right","max","total_height","nodes_count","node_outer_height","base_y","pd","set_visible","middle_height","_layout_offset_subnodes_height","get_node_offset","offset_cache","_offset_","offset_p","get_node_point","view_data","get_node_point_in","get_node_point_out","pout_cache","_pout_","get_expander_point","ex_p","ceil","get_min_size","pout","toggle_node","collapse_node","expand_node","part_layout","invoke_event_handle","expand_all","collapse_all","expand_to_depth","target_depth","curr_nodes","curr_depth","depth","root_layout_data","visible","is_expand","is_visible","SvgGraph","e_svg","setAttribute","size","lines","createElementNS","element","set_size","clear","draw_line","pin","offset","line","_bezier_to","copy_to","dest_canvas_ctx","img","Image","drawImage","src","btoa","XMLSerializer","serializeToString","path","x1","y1","x2","y2","_line_to","CanvasGraph","e_canvas","className","canvas_ctx","getContext","clearRect","ctx","strokeStyle","lineWidth","lineCap","beginPath","moveTo","bezierCurveTo","stroke","lineTo","ViewProvider","e_panel","e_nodes","selected_node","editing_node","graph","e_editor","tabIndex","actualZoom","zoomStep","minZoom","maxZoom","v","event","keyCode","edit_node_end","stopPropagation","enable_draggable_canvas","add_event","obj","event_name","event_handle","get_binded_nodeid","parentElement","is_expander","clear_lines","clear_nodes","reset_theme","theme_name","reset_custom_style","nodeid","reset_node_custom_style","init_nodes","expand_size","min_size","min_width","min_height","client_w","clientWidth","client_h","clientHeight","init_nodes_size","doc_frag","createDocumentFragment","create_node_element","d_e","expander","_reset_node_custom_style","update_node","select_node","clear_node_custom_style","select_clear","get_editing_node","is_editing","edit_node_begin","ncs","getComputedStyle","value","parseInt","getPropertyValue","zIndex","focus","get_view_offset","_show","show_nodes","show_lines","zoomIn","setZoom","zoomOut","zoom","transform","_center_root","outer_w","outer_h","_offset","scrollLeft","scrollTop","keep_center","relayout","save_location","_saved_location","top","restore_location","node_element","p_expander","expander_text","display","backgroundColor","color","fontSize","fontWeight","fontStyle","backgroundImage","scaledImageData","toDataURL","backgroundSize","dragging","eventDown","clientX","clientY","eventMove","scrollBy","ShortcutProvider","_newid","_mapping","handle","handler","bind","handle_addchild","handle_addbrother","handle_editnode","handle_delnode","handle_toggle","handle_up","handle_down","handle_left","handle_right","id_generator","enable_shortcut","disable_shortcut","which","preventDefault","kc","metaKey","ctrlKey","altKey","shiftKey","_jm","get_selected_node","begin_edit","up_node","find_node_before","np","down_node","find_node_after","_handle_direction","floor","plugin_data","plugins","register","plugin","Plugin","Error","apply","setTimeout","l","fn_init","_apply","Map","registerPlugin","isConformPlugin","has","set","enablePlugin","_a","jsMind","_register_plugin","_util","current","initialized","event_handles","merge_option","opts_layout","opts_view","_event_bind","apply_plugins","forEach","enable_edit","disable_edit","enable_event_handle","disable_event_handle","get_editable","set_theme","theme_old","mousedown_handle","click_handle","dblclick_handle","mousewheel_handle","target","srcElement","deltaY","end_edit","_reset","m","get_meta","get_root","the_parent_node","the_node_before","the_node_after","updated_node","is_node_visible","prev","ni","found","set_node_color","bg_color","fg_color","set_node_font_style","weight","set_node_background_image","image","rotation","set_node_background_rotation","add_event_listener","clear_event_listener","j","_invoke_event_handle","clear_selection","getSelection","removeAllRanges","selection","empty","shadow","shadow_w","shadow_h","active_node","target_node","target_direct","hlookup_delay","hlookup_timer","capture","moved","_create_canvas","_create_shadow","cursor","opacity","reset_shadow","show_shadow","hide_shadow","_magnet_shadow","_clear_lines","_canvas_lineto","sp","_lookup_close_node","nl","root_location","root_size","root_x","sw","sh","sx","offsetLeft","sy","offsetTop","direct","min_distance","Number","MAX_VALUE","distance","closest_node","closest_p","shadow_p","abs","result_node","lookup_close_node","jd","dragstart","drag","dragend","jview","touches","client_hw","client_hh","clearTimeout","clearInterval","setInterval","px","py","src_node","sibling_nodes","sc","delta_y","beforeid","dy","jm_event_handle","event_type"],"mappings":"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"}