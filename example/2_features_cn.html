<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>jsMind</title>
        
        <!-- æ™ºèƒ½ç¯å¢ƒæ£€æµ‹ï¼šå¼€å‘ç¯å¢ƒä½¿ç”¨æœ¬åœ°æ–‡ä»¶ï¼Œç”Ÿäº§ç¯å¢ƒä½¿ç”¨CDN -->
        <script>
            // æ£€æµ‹æ˜¯å¦ä¸ºå¼€å‘ç¯å¢ƒï¼ˆé€šè¿‡URLå‚æ•°æˆ–localhoståˆ¤æ–­ï¼‰
            window.isDev = location.hostname === 'localhost' || 
                          location.hostname === '127.0.0.1' || 
                          location.search.includes('dev=true') ||
                          location.protocol === 'file:';
            
            if (window.isDev) {
                console.log('ğŸ”§ å¼€å‘ç¯å¢ƒï¼šä½¿ç”¨æœ¬åœ°æ„å»ºæ–‡ä»¶');
                document.write('<link type="text/css" rel="stylesheet" href="../style/jsmind.css" />');
            } else {
                console.log('ğŸš€ ç”Ÿäº§ç¯å¢ƒï¼šä½¿ç”¨CDNèµ„æº');
                document.write('<link type="text/css" rel="stylesheet" href="../style/jsmind.css" />');
            }
        </script>
        <style type="text/css">
            li {
                margin-top: 2px;
                margin-bottom: 2px;
            }

            button {
                width: 140px;
            }

            select {
                width: 140px;
            }

            #layout {
                width: 1230px;
            }

            #jsmind_nav {
                width: 210px;
                height: 600px;
                border: solid 1px #ccc;
                overflow: auto;
                float: left;
            }

            .file_input {
                width: 100px;
            }

            button.sub {
                width: 100px;
            }

            #jsmind_container {
                float: left;
                width: 1000px;
                height: 600px;
                border: solid 1px #ccc;
                background: #f4f4f4;
            }
        </style>
    </head>

    <body>
        <div id="layout">
            <div id="jsmind_nav">
                <div>1. Open</div>
                <ol type="A">
                    <li><button onclick="open_json();">open example</button></li>
                    <li><button onclick="open_remote();">open remote</button></li>
                    <li>
                        <button onclick="prompt_info('see 6.Multi Format');">
                            open local file
                        </button>
                    </li>
                    <li>
                        <button onclick="prompt_info('see 6.Multi Format');">
                            save local file
                        </button>
                    </li>
                    <li><button onclick="screen_shot();">screenshot</button></li>
                </ol>
                <div>2. Select &amp; Toggle</div>
                <ol type="A">
                    <li><button onclick="select_node();">select a node</button></li>
                    <li>
                        <button onclick="prompt_info('please try click a node');">
                            try click a node
                        </button>
                    </li>
                    <li><button onclick="show_selected();">get the selected</button></li>
                </ol>
                <div>3. Edit</div>
                <ol type="A">
                    <li><button onclick="toggle_editable(this);">disable editable</button></li>
                    <li><button onclick="add_node();">add a node</button></li>
                    <li><button onclick="add_image_node();">add a image node</button></li>
                    <li><button onclick="modify_node();">modify node</button></li>
                    <li>
                        <button onclick="prompt_info('please try double click a node');">
                            try double click
                        </button>
                    </li>
                    <li><button onclick="move_node();">move a node</button></li>
                    <li><button onclick="move_to_first();">move to first</button></li>
                    <li><button onclick="move_to_last();">move to last</button></li>
                    <li><button onclick="remove_node();">remove node</button></li>
                </ol>
                <div>4. Style</div>
                <ol type="A">
                    <li><button onclick="change_text_font();">change font</button></li>
                    <li><button onclick="change_text_color();">change color</button></li>
                    <li><button onclick="change_background_color();">change bg-color</button></li>
                    <li><button onclick="change_background_image();">change background</button></li>
                </ol>
                <div>5. æ–‡æœ¬ç¼–è¾‘æ¨¡å¼</div>
                <ol type="A">
                    <li><button onclick="toggle_multiline(this);">å¯ç”¨å¤šè¡Œç¼–è¾‘</button></li>
                    <li><button onclick="show_current_mode();">æ˜¾ç¤ºå½“å‰æ¨¡å¼</button></li>
                </ol>
                <div>6. Theme</div>
                <ol type="A">
                    <li>
                        <select onchange="set_theme(this.value);">
                            <option value="">default</option>
                            <option value="primary">primary</option>
                            <option value="warning">warning</option>
                            <option value="danger">danger</option>
                            <option value="success">success</option>
                            <option value="info">info</option>
                            <option value="greensea" selected="selected">greensea</option>
                            <option value="nephrite">nephrite</option>
                            <option value="belizehole">belizehole</option>
                            <option value="wisteria">wisteria</option>
                            <option value="asphalt">asphalt</option>
                            <option value="orange">orange</option>
                            <option value="pumpkin">pumpkin</option>
                            <option value="pomegranate">pomegranate</option>
                            <option value="clouds">clouds</option>
                            <option value="asbestos">asbestos</option>
                        </select>
                    </li>
                </ol>
                <div>7. Adjusting</div>
                <ol type="A">
                    <li>
                        <button onclick="change_container();">resize container</button>
                        <button onclick="resize_jsmind();">adusting</button>
                    </li>
                    <li>expand/collapse</li>
                    <ol>
                        <li><button class="sub" onclick="expand();">expand node</button></li>
                        <li><button class="sub" onclick="collapse();">collapse node</button></li>
                        <li><button class="sub" onclick="toggle();">toggle node</button></li>
                        <li>
                            <button class="sub" onclick="expand_to_level2();">
                                expand to level 2
                            </button>
                        </li>
                        <li>
                            <button class="sub" onclick="expand_to_level3();">
                                expand to level 3
                            </button>
                        </li>
                        <li><button class="sub" onclick="expand_all();">expand all</button></li>
                        <li><button class="sub" onclick="collapse_all();">collapse all</button></li>
                    </ol>
                    <li>zoom(ctrl+mousewheel)</li>
                    <button id="zoom-in-button" style="width: 50px" onclick="zoomIn();">In</button>
                    <button id="zoom-out-button" style="width: 50px" onclick="zoomOut();">
                        Out
                    </button>
                </ol>

                <div>8. Multi Format</div>
                <ol type="A">
                    <li>node_tree(default)</li>
                    <ol>
                        <li><button class="sub" onclick="show_data();">show data</button></li>
                        <li><button class="sub" onclick="save_file();">save file</button></li>
                        <li><input id="file_input" class="file_input" type="file" /></li>
                        <li><button class="sub" onclick="open_file();">open file</button></li>
                    </ol>
                    <li>node_array</li>
                    <ol>
                        <li>
                            <button class="sub" onclick="get_nodearray_data();">show data</button>
                        </li>
                        <li>
                            <button class="sub" onclick="save_nodearray_file();">save file</button>
                        </li>
                        <li><input id="file_input_nodearray" class="file_input" type="file" /></li>
                        <li><button class="sub" onclick="open_nodearray();">open file</button></li>
                    </ol>
                    <li>freemind(.mm)</li>
                    <ol>
                        <li>
                            <button class="sub" onclick="get_freemind_data();">show data</button>
                        </li>
                        <li>
                            <button class="sub" onclick="save_freemind_file();">save file</button>
                        </li>
                        <li><input id="file_input_freemind" class="file_input" type="file" /></li>
                        <li><button class="sub" onclick="open_freemind();">open file</button></li>
                    </ol>
                </ol>
            </div>
            <div id="jsmind_container"></div>
            <div style="display: none">
                <input class="file" type="file" id="image-chooser" accept="image/*" />
            </div>
        </div>
        
        <!-- æ™ºèƒ½ç¯å¢ƒæ£€æµ‹ï¼šå¼€å‘ç¯å¢ƒä½¿ç”¨æœ¬åœ°æ„å»ºæ–‡ä»¶ï¼Œç”Ÿäº§ç¯å¢ƒä½¿ç”¨CDN -->
        <script>
            // ä½¿ç”¨ä¹‹å‰å·²ç»å®šä¹‰çš„ window.isDev å˜é‡
            if (window.isDev) {
                console.log('ğŸ”§ å¼€å‘ç¯å¢ƒï¼šä½¿ç”¨æœ¬åœ°æ„å»ºæ–‡ä»¶');
                
                // å¼€å‘ç¯å¢ƒï¼šä½¿ç”¨æœ¬åœ°æ„å»ºçš„UMDæ¨¡å—
                const script = document.createElement('script');
                script.src = '../es6/jsmind.js';
                script.onload = () => {
                    console.log('âœ… æœ¬åœ°jsMindåŠ è½½æˆåŠŸ');
                    
                    // åŠ è½½2_features.js
                    const featuresScript = document.createElement('script');
                    featuresScript.src = '2_features.js';
                    featuresScript.onload = () => {
                        console.log('âœ… åŠŸèƒ½è„šæœ¬åŠ è½½å®Œæˆ');
                        // åˆå§‹åŒ–jsMindå®ä¾‹
                        open_empty();
                        // æ›´æ–°æŒ‰é’®çŠ¶æ€
                        setTimeout(() => {
                            if (typeof update_multiline_button === 'function') {
                                update_multiline_button();
                            }
                        }, 100);
                        // åŠ è½½ç¤ºä¾‹æ•°æ®
                        loadExampleData();
                        console.log('âœ… å¼€å‘ç¯å¢ƒåˆå§‹åŒ–å®Œæˆ');
                    };
                    document.head.appendChild(featuresScript);
                };
                document.head.appendChild(script);
                
            } else {
                console.log('ğŸš€ ç”Ÿäº§ç¯å¢ƒï¼šåŠ è½½CDNèµ„æº');
                loadCDNResources();
            }
            
            // ç¤ºä¾‹æ•°æ®
            function loadExampleData() {
                const mind = {
                    meta: {
                        name: 'jsMind Rich Text Demo',
                        author: 'hizzgdev@163.com',
                        version: '0.9.0',
                    },
                    format: 'node_tree',
                    data: {
                        id: 'root',
                        topic: 'jsMind å¯Œæ–‡æœ¬æ¼”ç¤º',
                        children: [
                            {
                                id: 'easy',
                                topic: 'ç®€å•æ˜“ç”¨\nåŒå‡»ç¼–è¾‘èŠ‚ç‚¹',
                                direction: 'left',
                                children: [
                                    { id: 'easy1', topic: 'Easy to show' },
                                    { id: 'easy2', topic: 'æ”¯æŒå¤šè¡Œæ–‡æœ¬\nç¬¬äºŒè¡Œå†…å®¹\nç¬¬ä¸‰è¡Œå†…å®¹' },
                                    { id: 'easy3', topic: 'Easy to store' },
                                ],
                            },
                            {
                                id: 'rich',
                                topic: '<b>å¯Œæ–‡æœ¬æ”¯æŒ</b>',
                                direction: 'right',
                                children: [
                                    {
                                        id: 'rich1',
                                        topic: '<b>ç²—ä½“</b> <i>æ–œä½“</i> <u>ä¸‹åˆ’çº¿</u>',
                                    },
                                    { id: 'rich2', topic: 'æ™®é€šæ–‡æœ¬èŠ‚ç‚¹' },
                                ],
                            },
                            {
                                id: 'features',
                                topic: 'åŠŸèƒ½ç‰¹æ€§',
                                direction: 'right',
                                children: [
                                    { id: 'f1', topic: 'HTMLå†…å®¹æ”¯æŒ' },
                                    { id: 'f2', topic: 'å¤šè¡Œæ–‡æœ¬ç¼–è¾‘' },
                                    { id: 'f3', topic: 'Ctrl+Enterå®Œæˆç¼–è¾‘' },
                                ],
                            },
                        ],
                    },
                };
                
                // ç­‰å¾…jsMindå…¨å±€å¯ç”¨
                if (window.jsMind && window._jm) {
                    window._jm.show(mind);
                } else {
                    // å»¶è¿Ÿæ‰§è¡Œï¼Œç­‰å¾…jsMindåˆå§‹åŒ–
                    setTimeout(() => {
                        if (window._jm) {
                            window._jm.show(mind);
                        }
                    }, 100);
                }
            }
            
            function loadCDNResources() {
                // åŠ è½½CDNèµ„æº
                const scripts = [
                    '//jsd.onmicrosoft.cn/npm/jsmind@0.9.0/es6/jsmind.js',
                    '../src/plugins/jsmind.draggable-node.js',
                    '//jsd.onmicrosoft.cn/npm/dom-to-image@2.6.0/dist/dom-to-image.min.js',
                    '../src/plugins/jsmind.screenshot.js'
                ];
                
                let loadedCount = 0;
                scripts.forEach((src, index) => {
                    const script = document.createElement('script');
                    script.src = src;
                    script.type = 'text/javascript';
                    script.onload = () => {
                        loadedCount++;
                        if (loadedCount === scripts.length) {
                            // æ‰€æœ‰CDNè„šæœ¬åŠ è½½å®Œæˆï¼ŒåŠ è½½2_features.js
                            const featuresScript = document.createElement('script');
                            featuresScript.src = '2_features.js';
                            featuresScript.onload = () => {
                                // åˆå§‹åŒ–jsMindå®ä¾‹
                                const options = {
                                    container: 'jsmind_container',
                                    theme: 'greensea',
                                    editable: true,
                                    enable_multiline: false, // é»˜è®¤ä¸ºå•è¡Œæ¨¡å¼
                                    log_level: 'debug',
                                    view: {
                                        engine: 'canvas',
                                        draggable: true,
                                        enable_device_pixel_ratio: false,
                                    },
                                    plugin: {
                                        screenshot: {
                                            background: '#ffffff',
                                        },
                                    },
                                };
                                window._jm = new jsMind(options);
                                
                                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                                setTimeout(() => {
                                    if (typeof update_multiline_button === 'function') {
                                        update_multiline_button();
                                    }
                                }, 100);
                                
                                // æ˜¾ç¤ºé»˜è®¤æ•°æ®
                                if (typeof open_json === 'function') {
                                    open_json();
                                }
                                
                                console.log('âœ… ç”Ÿäº§ç¯å¢ƒåˆå§‹åŒ–å®Œæˆ');
                            };
                            document.head.appendChild(featuresScript);
                        }
                    };
                    document.head.appendChild(script);
                });
            }
        </script>
    </body>
</html>
