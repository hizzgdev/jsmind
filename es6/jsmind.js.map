{"version":3,"file":"jsmind.js","sources":["../src/jsmind.common.js","../src/jsmind.dom.js","../src/jsmind.util.js","../src/jsmind.option.js","../src/jsmind.node.js","../src/jsmind.mind.js","../src/jsmind.format.js","../src/jsmind.data_provider.js","../src/jsmind.layout_provider.js","../src/jsmind.graph.js","../src/jsmind.view_provider.js","../src/jsmind.shortcut_provider.js","../src/jsmind.plugin.js","../src/jsmind.js"],"sourcesContent":["/**\n * @license BSD\n * @copyright 2014-2022 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\n\nexport const __version__ = '0.4.9';\nexport const __author__ = 'hizzgdev@163.com';\n\nif (typeof String.prototype.startsWith != 'function') { String.prototype.startsWith = function (p) { return this.slice(0, p.length) === p; }; }\n\n// an noop function define\nvar _noop = function () { };\nexport let logger = (typeof console === 'undefined') ? {\n    log: _noop, debug: _noop, error: _noop, warn: _noop, info: _noop\n} : console;\n\nexport const Direction = { left: -1, center: 0, right: 1 };\nexport const EventType = { show: 1, resize: 2, edit: 3, select: 4 };\nexport const Key = { meta: 1 << 13, ctrl: 1 << 12, alt: 1 << 11, shift: 1 << 10 };","/**\n * @license BSD\n * @copyright 2014-2022 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\n\nclass Dom {\n    constructor(w) {\n        this.w = w;\n        this.d = w.document;\n        this.g = function (id) { return this.d.getElementById(id); };\n        this.c = function (tag) { return this.d.createElement(tag); };\n        this.t = function (n, t) { if (n.hasChildNodes()) { n.firstChild.nodeValue = t; } else { n.appendChild(this.d.createTextNode(t)); } };\n\n        this.h = function (n, t) {\n            if (t instanceof HTMLElement) {\n                n.innerHTML = '';\n                n.appendChild(t);\n            } else {\n                n.innerHTML = t;\n            }\n        };\n        // detect isElement\n        this.i = function (el) { return !!el && (typeof el === 'object') && (el.nodeType === 1) && (typeof el.style === 'object') && (typeof el.ownerDocument === 'object'); };\n\n        //target,eventType,handler\n        this.on = function (t, e, h) {\n            if (!!t.addEventListener) {\n                t.addEventListener(e, h, false);\n            } else {\n                t.attachEvent('on' + e, h);\n            }\n        };\n    }\n}\n\nexport const $ = new Dom(window);\n","/**\n * @license BSD\n * @copyright 2014-2022 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\n\nimport { $ } from \"./jsmind.dom.js\";\nimport { logger } from \"./jsmind.common.js\";\n\nexport const util = {\n    ajax: {\n        _xhr: function () {\n            var xhr = null;\n            if (window.XMLHttpRequest) {\n                xhr = new XMLHttpRequest();\n            } else {\n                try {\n                    xhr = new ActiveXObject('Microsoft.XMLHTTP');\n                } catch (e) { }\n            }\n            return xhr;\n        },\n        _eurl: function (url) {\n            return encodeURIComponent(url);\n        },\n        request: function (url, param, method, callback, fail_callback) {\n            var a = util.ajax;\n            var p = null;\n            var tmp_param = [];\n            for (var k in param) {\n                tmp_param.push(a._eurl(k) + '=' + a._eurl(param[k]));\n            }\n            if (tmp_param.length > 0) {\n                p = tmp_param.join('&');\n            }\n            var xhr = a._xhr();\n            if (!xhr) { return; }\n            xhr.onreadystatechange = function () {\n                if (xhr.readyState == 4) {\n                    if (xhr.status == 200 || xhr.status == 0) {\n                        if (typeof callback === 'function') {\n                            var data = util.json.string2json(xhr.responseText);\n                            if (data != null) {\n                                callback(data);\n                            } else {\n                                callback(xhr.responseText);\n                            }\n                        }\n                    } else {\n                        if (typeof fail_callback === 'function') {\n                            fail_callback(xhr);\n                        } else {\n                            logger.error('xhr request failed.', xhr);\n                        }\n                    }\n                }\n            }\n            method = method || 'GET';\n            xhr.open(method, url, true);\n            xhr.setRequestHeader('If-Modified-Since', '0');\n            if (method == 'POST') {\n                xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded;charset=utf-8');\n                xhr.send(p);\n            } else {\n                xhr.send();\n            }\n        },\n        get: function (url, callback) {\n            return util.ajax.request(url, {}, 'GET', callback);\n        },\n        post: function (url, param, callback) {\n            return util.ajax.request(url, param, 'POST', callback);\n        }\n    },\n\n    file: {\n        read: function (file_data, fn_callback) {\n            var reader = new FileReader();\n            reader.onload = function () {\n                if (typeof fn_callback === 'function') {\n                    fn_callback(this.result, file_data.name);\n                }\n            };\n            reader.readAsText(file_data);\n        },\n\n        save: function (file_data, type, name) {\n            var blob;\n            if (typeof $.w.Blob === 'function') {\n                blob = new Blob([file_data], { type: type });\n            } else {\n                var BlobBuilder = $.w.BlobBuilder || $.w.MozBlobBuilder || $.w.WebKitBlobBuilder || $.w.MSBlobBuilder;\n                var bb = new BlobBuilder();\n                bb.append(file_data);\n                blob = bb.getBlob(type);\n            }\n            if (navigator.msSaveBlob) {\n                navigator.msSaveBlob(blob, name);\n            } else {\n                var URL = $.w.URL || $.w.webkitURL;\n                var bloburl = URL.createObjectURL(blob);\n                var anchor = $.c('a');\n                if ('download' in anchor) {\n                    anchor.style.visibility = 'hidden';\n                    anchor.href = bloburl;\n                    anchor.download = name;\n                    $.d.body.appendChild(anchor);\n                    var evt = $.d.createEvent('MouseEvents');\n                    evt.initEvent('click', true, true);\n                    anchor.dispatchEvent(evt);\n                    $.d.body.removeChild(anchor);\n                } else {\n                    location.href = bloburl;\n                }\n            }\n        }\n    },\n\n    json: {\n        json2string: function (json) {\n            if (!!JSON) {\n                try {\n                    var json_str = JSON.stringify(json);\n                    return json_str;\n                } catch (e) {\n                    logger.warn(e);\n                    logger.warn('can not convert to string');\n                    return null;\n                }\n            }\n        },\n        string2json: function (json_str) {\n            if (!!JSON) {\n                try {\n                    var json = JSON.parse(json_str);\n                    return json;\n                } catch (e) {\n                    logger.warn(e);\n                    logger.warn('can not parse to json');\n                    return null;\n                }\n            }\n        },\n        merge: function (b, a) {\n            for (var o in a) {\n                if (o in b) {\n                    if (typeof b[o] === 'object' &&\n                        Object.prototype.toString.call(b[o]).toLowerCase() == '[object object]' &&\n                        !b[o].length) {\n                        util.json.merge(b[o], a[o]);\n                    } else {\n                        b[o] = a[o];\n                    }\n                } else {\n                    b[o] = a[o];\n                }\n            }\n            return b;\n        }\n    },\n\n    uuid: {\n        newid: function () {\n            return (new Date().getTime().toString(16) + Math.random().toString(16).substr(2)).substr(2, 16);\n        }\n    },\n\n    text: {\n        is_empty: function (s) {\n            if (!s) { return true; }\n            return s.replace(/\\s*/, '').length == 0;\n        }\n    }\n};\n","/**\n * @license BSD\n * @copyright 2014-2022 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\n\nimport { util } from \"./jsmind.util.js\";\n\nconst default_options = {\n    container: '',   // id of the container\n    editable: false, // you can change it in your options\n    theme: null,\n    mode: 'full',    // full or side\n    support_html: true,\n\n    view: {\n        engine: 'canvas',\n        hmargin: 100,\n        vmargin: 50,\n        line_width: 2,\n        line_color: '#555',\n        draggable: false, // drag the mind map with your mouse, when it's larger that the container\n        hide_scrollbars_when_draggable: false // hide container scrollbars, when mind map is larger than container and draggable option is true.\n    },\n    layout: {\n        hspace: 30,\n        vspace: 20,\n        pspace: 13\n    },\n    default_event_handle: {\n        enable_mousedown_handle: true,\n        enable_click_handle: true,\n        enable_dblclick_handle: true,\n        enable_mousewheel_handle: true\n    },\n    shortcut: {\n        enable: true,\n        handles: {\n        },\n        mapping: {\n            addchild: 45, // Insert\n            addbrother: 13, // Enter\n            editnode: 113,// F2\n            delnode: 46, // Delete\n            toggle: 32, // Space\n            left: 37, // Left\n            up: 38, // Up\n            right: 39, // Right\n            down: 40, // Down\n        }\n    },\n};\n\nexport function merge_option (options) {\n    var opts = {};\n    util.json.merge(opts, default_options);\n    util.json.merge(opts, options);\n\n    if (!opts.container) {\n        throw new Error('the options.container should not be null or empty.')\n    }\n    return opts;\n}\n","/**\n * @license BSD\n * @copyright 2014-2022 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\n\nimport { logger } from \"./jsmind.common.js\";\nexport class Node {\n    constructor(sId, iIndex, sTopic, oData, bIsRoot, oParent, eDirection, bExpanded) {\n        if (!sId) { logger.error('invalid node id'); return; }\n        if (typeof iIndex != 'number') { logger.error('invalid node index'); return; }\n        if (typeof bExpanded === 'undefined') { bExpanded = true; }\n        this.id = sId;\n        this.index = iIndex;\n        this.topic = sTopic;\n        this.data = oData || {};\n        this.isroot = bIsRoot;\n        this.parent = oParent;\n        this.direction = eDirection;\n        this.expanded = !!bExpanded;\n        this.children = [];\n        this._data = {};\n    }\n\n    get_location() {\n        var vd = this._data.view;\n        return {\n            x: vd.abs_x,\n            y: vd.abs_y\n        };\n    }\n    get_size() {\n        var vd = this._data.view;\n        return {\n            w: vd.width,\n            h: vd.height\n        }\n    }\n\n    static compare(node1, node2) {\n        // '-1' is alwary the last\n        var r = 0;\n        var i1 = node1.index;\n        var i2 = node2.index;\n        if (i1 >= 0 && i2 >= 0) {\n            r = i1 - i2;\n        } else if (i1 == -1 && i2 == -1) {\n            r = 0;\n        } else if (i1 == -1) {\n            r = 1;\n        } else if (i2 == -1) {\n            r = -1;\n        } else {\n            r = 0;\n        }\n        return r;\n    }\n    static inherited(pnode, node) {\n        if (!!pnode && !!node) {\n            if (pnode.id === node.id) {\n                return true;\n            }\n            if (pnode.isroot) {\n                return true;\n            }\n            var pid = pnode.id;\n            var p = node;\n            while (!p.isroot) {\n                p = p.parent;\n                if (p.id === pid) {\n                    return true;\n                }\n            }\n        }\n        return false;\n    }\n    static is_node(n) {\n        return !!n && n instanceof Node;\n    }\n}\n\n\n","/**\n * @license BSD\n * @copyright 2014-2022 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\n\nimport { Node } from \"./jsmind.node.js\";\nimport { logger, Direction } from \"./jsmind.common.js\";\n\nexport class Mind {\n    constructor() {\n        this.name = null;\n        this.author = null;\n        this.version = null;\n        this.root = null;\n        this.selected = null;\n        this.nodes = {};\n    }\n    get_node(nodeid) {\n        if (nodeid in this.nodes) {\n            return this.nodes[nodeid];\n        } else {\n            logger.warn('the node[id=' + nodeid + '] can not be found');\n            return null;\n        }\n    }\n    set_root(nodeid, topic, data) {\n        if (this.root == null) {\n            this.root = new Node(nodeid, 0, topic, data, true);\n            this._put_node(this.root);\n            return this.root;\n        } else {\n            logger.error('root node is already exist');\n            return null;\n        }\n    }\n    add_node(parent_node, nodeid, topic, data, direction, expanded, idx) {\n        if (!Node.is_node(parent_node)) {\n            logger.error('the parent_node ' + parent_node + ' is not a node.');\n            return null;\n        }\n        var node_index = idx || -1;\n        var node = new Node(nodeid, node_index, topic, data, false, parent_node, parent_node.direction, expanded);\n        if (parent_node.isroot) {\n            node.direction = direction || Direction.right;\n        }\n        if (this._put_node(node)) {\n            parent_node.children.push(node);\n            this._reindex(parent_node);\n        } else {\n            logger.error('fail, the nodeid \\'' + node.id + '\\' has been already exist.');\n            node = null;\n        }\n        return node;\n    }\n    insert_node_before(node_before, nodeid, topic, data, direction) {\n        if (!Node.is_node(node_before)) {\n            logger.error('the node_before ' + node_before + ' is not a node.');\n            return null;\n        }\n        var node_index = node_before.index - 0.5;\n        return this.add_node(node_before.parent, nodeid, topic, data, direction, true, node_index);\n    }\n    get_node_before(node) {\n        if (!Node.is_node(node)) {\n            var the_node = this.get_node(node);\n            if (!the_node) {\n                logger.error('the node[id=' + node + '] can not be found.');\n                return null;\n            } else {\n                return this.get_node_before(the_node);\n            }\n        }\n        if (node.isroot) { return null; }\n        var idx = node.index - 2;\n        if (idx >= 0) {\n            return node.parent.children[idx];\n        } else {\n            return null;\n        }\n    }\n    insert_node_after(node_after, nodeid, topic, data, direction) {\n        if (!Node.is_node(node_after)) {\n            logger.error('the node_after ' + node_after + ' is not a node.');\n            return null;\n        }\n        var node_index = node_after.index + 0.5;\n        return this.add_node(node_after.parent, nodeid, topic, data, direction, true, node_index);\n    }\n    get_node_after(node) {\n        if (!Node.is_node(node)) {\n            var the_node = this.get_node(node);\n            if (!the_node) {\n                logger.error('the node[id=' + node + '] can not be found.');\n                return null;\n            } else {\n                return this.get_node_after(the_node);\n            }\n        }\n        if (node.isroot) { return null; }\n        var idx = node.index;\n        var brothers = node.parent.children;\n        if (brothers.length > idx) {\n            return node.parent.children[idx];\n        } else {\n            return null;\n        }\n    }\n    move_node(node, before_id, parent_id, direction) {\n        if (!Node.is_node(node)) {\n            logger.error('the parameter node ' + node + ' is not a node.');\n            return null;\n        }\n        if (!parent_id) {\n            parent_id = node.parent.id;\n        }\n        return this._move_node(node, before_id, parent_id, direction);\n    }\n    _flow_node_direction(node, direction) {\n        if (typeof direction === 'undefined') {\n            direction = node.direction;\n        } else {\n            node.direction = direction;\n        }\n        var len = node.children.length;\n        while (len--) {\n            this._flow_node_direction(node.children[len], direction);\n        }\n    }\n    _move_node_internal(node, beforeid) {\n        if (!!node && !!beforeid) {\n            if (beforeid == '_last_') {\n                node.index = -1;\n                this._reindex(node.parent);\n            } else if (beforeid == '_first_') {\n                node.index = 0;\n                this._reindex(node.parent);\n            } else {\n                var node_before = (!!beforeid) ? this.get_node(beforeid) : null;\n                if (node_before != null && node_before.parent != null && node_before.parent.id == node.parent.id) {\n                    node.index = node_before.index - 0.5;\n                    this._reindex(node.parent);\n                }\n            }\n        }\n        return node;\n    }\n    _move_node(node, beforeid, parentid, direction) {\n        if (!!node && !!parentid) {\n            var parent_node = this.get_node(parentid);\n            if (Node.inherited(node, parent_node)) {\n                logger.error('can not move a node to its children');\n                return null;\n            }\n            if (node.parent.id != parentid) {\n                // remove from parent's children\n                var sibling = node.parent.children;\n                var si = sibling.length;\n                while (si--) {\n                    if (sibling[si].id == node.id) {\n                        sibling.splice(si, 1);\n                        break;\n                    }\n                }\n                node.parent = parent_node;\n                parent_node.children.push(node);\n            }\n\n            if (node.parent.isroot) {\n                if (direction == Direction.left) {\n                    node.direction = direction;\n                } else {\n                    node.direction = Direction.right;\n                }\n            } else {\n                node.direction = node.parent.direction;\n            }\n            this._move_node_internal(node, beforeid);\n            this._flow_node_direction(node);\n        }\n        return node;\n    }\n    remove_node(node) {\n        if (!Node.is_node(node)) {\n            logger.error('the parameter node ' + node + ' is not a node.');\n            return false;\n        }\n        if (node.isroot) {\n            logger.error('fail, can not remove root node');\n            return false;\n        }\n        if (this.selected != null && this.selected.id == node.id) {\n            this.selected = null;\n        }\n        // clean all subordinate nodes\n        var children = node.children;\n        var ci = children.length;\n        while (ci--) {\n            this.remove_node(children[ci]);\n        }\n        // clean all children\n        children.length = 0;\n        // remove from parent's children\n        var sibling = node.parent.children;\n        var si = sibling.length;\n        while (si--) {\n            if (sibling[si].id == node.id) {\n                sibling.splice(si, 1);\n                break;\n            }\n        }\n        // remove from global nodes\n        delete this.nodes[node.id];\n        // clean all properties\n        for (var k in node) {\n            delete node[k];\n        }\n        // remove it's self\n        node = null;\n        //delete node;\n        return true;\n    }\n    _put_node(node) {\n        if (node.id in this.nodes) {\n            logger.warn('the nodeid \\'' + node.id + '\\' has been already exist.');\n            return false;\n        } else {\n            this.nodes[node.id] = node;\n            return true;\n        }\n    }\n    _reindex(node) {\n        if (node instanceof Node) {\n            node.children.sort(Node.compare);\n            for (var i = 0; i < node.children.length; i++) {\n                node.children[i].index = i + 1;\n            }\n        }\n    }\n}\n\n\n","/**\n * @license BSD\n * @copyright 2014-2022 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\n\nimport { __author__, __version__ , logger, Direction} from \"./jsmind.common.js\";\nimport { Mind } from \"./jsmind.mind.js\";\nimport { Node } from \"./jsmind.node.js\";\n\nexport const format = {\n    node_tree: {\n        example: {\n            \"meta\": {\n                \"name\": 'jsMind node_tree simple',\n                \"author\": __author__,\n                \"version\": __version__\n            },\n            \"format\": \"node_tree\",\n            \"data\": { \"id\": \"root\", \"topic\": \"jsMind Example\" }\n        },\n        get_mind: function (source) {\n            var df = format.node_tree;\n            var mind = new Mind();\n            mind.name = source.meta.name;\n            mind.author = source.meta.author;\n            mind.version = source.meta.version;\n            df._parse(mind, source.data);\n            return mind;\n        },\n        get_data: function (mind) {\n            var df = format.node_tree;\n            var json = {};\n            json.meta = {\n                name: mind.name,\n                author: mind.author,\n                version: mind.version\n            };\n            json.format = 'node_tree';\n            json.data = df._buildnode(mind.root);\n            return json;\n        },\n\n        _parse: function (mind, node_root) {\n            var df = format.node_tree;\n            var data = df._extract_data(node_root);\n            mind.set_root(node_root.id, node_root.topic, data);\n            if ('children' in node_root) {\n                var children = node_root.children;\n                for (var i = 0; i < children.length; i++) {\n                    df._extract_subnode(mind, mind.root, children[i]);\n                }\n            }\n        },\n\n        _extract_data: function (node_json) {\n            var data = {};\n            for (var k in node_json) {\n                if (k == 'id' || k == 'topic' || k == 'children' || k == 'direction' || k == 'expanded') {\n                    continue;\n                }\n                data[k] = node_json[k];\n            }\n            return data;\n        },\n\n        _extract_subnode: function (mind, node_parent, node_json) {\n            var df = format.node_tree;\n            var data = df._extract_data(node_json);\n            var d = null;\n            if (node_parent.isroot) {\n                d = node_json.direction == 'left' ? Direction.left : Direction.right;\n            }\n            var node = mind.add_node(node_parent, node_json.id, node_json.topic, data, d, node_json.expanded);\n            if (!!node_json['children']) {\n                var children = node_json.children;\n                for (var i = 0; i < children.length; i++) {\n                    df._extract_subnode(mind, node, children[i]);\n                }\n            }\n        },\n\n        _buildnode: function (node) {\n            var df = format.node_tree;\n            if (!(node instanceof Node)) { return; }\n            var o = {\n                id: node.id,\n                topic: node.topic,\n                expanded: node.expanded\n            };\n            if (!!node.parent && node.parent.isroot) {\n                o.direction = node.direction == Direction.left ? 'left' : 'right';\n            }\n            if (node.data != null) {\n                var node_data = node.data;\n                for (var k in node_data) {\n                    o[k] = node_data[k];\n                }\n            }\n            var children = node.children;\n            if (children.length > 0) {\n                o.children = [];\n                for (var i = 0; i < children.length; i++) {\n                    o.children.push(df._buildnode(children[i]));\n                }\n            }\n            return o;\n        }\n    },\n\n    node_array: {\n        example: {\n            \"meta\": {\n                \"name\": 'jsMind node_array simple',\n                \"author\": __author__,\n                \"version\": __version__\n            },\n            \"format\": \"node_array\",\n            \"data\": [\n                { \"id\": \"root\", \"topic\": \"jsMind Example\", \"isroot\": true }\n            ]\n        },\n\n        get_mind: function (source) {\n            var df = format.node_array;\n            var mind = new Mind();\n            mind.name = source.meta.name;\n            mind.author = source.meta.author;\n            mind.version = source.meta.version;\n            df._parse(mind, source.data);\n            return mind;\n        },\n\n        get_data: function (mind) {\n            var df = format.node_array;\n            var json = {};\n            json.meta = {\n                name: mind.name,\n                author: mind.author,\n                version: mind.version\n            };\n            json.format = 'node_array';\n            json.data = [];\n            df._array(mind, json.data);\n            return json;\n        },\n\n        _parse: function (mind, node_array) {\n            var df = format.node_array;\n            var narray = node_array.slice(0);\n            // reverse array for improving looping performance\n            narray.reverse();\n            var root_node = df._extract_root(mind, narray);\n            if (!!root_node) {\n                df._extract_subnode(mind, root_node, narray);\n            } else {\n                logger.error('root node can not be found');\n            }\n        },\n\n        _extract_root: function (mind, node_array) {\n            var df = format.node_array;\n            var i = node_array.length;\n            while (i--) {\n                if ('isroot' in node_array[i] && node_array[i].isroot) {\n                    var root_json = node_array[i];\n                    var data = df._extract_data(root_json);\n                    var node = mind.set_root(root_json.id, root_json.topic, data);\n                    node_array.splice(i, 1);\n                    return node;\n                }\n            }\n            return null;\n        },\n\n        _extract_subnode: function (mind, parent_node, node_array) {\n            var df = format.node_array;\n            var i = node_array.length;\n            var node_json = null;\n            var data = null;\n            var extract_count = 0;\n            while (i--) {\n                node_json = node_array[i];\n                if (node_json.parentid == parent_node.id) {\n                    data = df._extract_data(node_json);\n                    var d = null;\n                    var node_direction = node_json.direction;\n                    if (!!node_direction) {\n                        d = node_direction == 'left' ? Direction.left : Direction.right;\n                    }\n                    var node = mind.add_node(parent_node, node_json.id, node_json.topic, data, d, node_json.expanded);\n                    node_array.splice(i, 1);\n                    extract_count++;\n                    var sub_extract_count = df._extract_subnode(mind, node, node_array);\n                    if (sub_extract_count > 0) {\n                        // reset loop index after extract subordinate node\n                        i = node_array.length;\n                        extract_count += sub_extract_count;\n                    }\n                }\n            }\n            return extract_count;\n        },\n\n        _extract_data: function (node_json) {\n            var data = {};\n            for (var k in node_json) {\n                if (k == 'id' || k == 'topic' || k == 'parentid' || k == 'isroot' || k == 'direction' || k == 'expanded') {\n                    continue;\n                }\n                data[k] = node_json[k];\n            }\n            return data;\n        },\n\n        _array: function (mind, node_array) {\n            var df = format.node_array;\n            df._array_node(mind.root, node_array);\n        },\n\n        _array_node: function (node, node_array) {\n            var df = format.node_array;\n            if (!(node instanceof Node)) { return; }\n            var o = {\n                id: node.id,\n                topic: node.topic,\n                expanded: node.expanded\n            };\n            if (!!node.parent) {\n                o.parentid = node.parent.id;\n            }\n            if (node.isroot) {\n                o.isroot = true;\n            }\n            if (!!node.parent && node.parent.isroot) {\n                    o.direction = node.direction == Direction.left ? 'left' : 'right';\n            }\n            if (node.data != null) {\n                var node_data = node.data;\n                for (var k in node_data) {\n                    o[k] = node_data[k];\n                }\n            }\n            node_array.push(o);\n            var ci = node.children.length;\n            for (var i = 0; i < ci; i++) {\n                df._array_node(node.children[i], node_array);\n            }\n        },\n    },\n\n    freemind: {\n        example: {\n            \"meta\": {\n                \"name\": 'jsMind freemind example',\n                \"author\": __author__,\n                \"version\": __version__\n            },\n            \"format\": \"freemind\",\n            \"data\": \"<map version=\\\"1.0.1\\\"><node ID=\\\"root\\\" TEXT=\\\"freemind Example\\\"/></map>\"\n        },\n        get_mind: function (source) {\n            var df = format.freemind;\n            var mind = new Mind();\n            mind.name = source.meta.name;\n            mind.author = source.meta.author;\n            mind.version = source.meta.version;\n            var xml = source.data;\n            var xml_doc = df._parse_xml(xml);\n            var xml_root = df._find_root(xml_doc);\n            df._load_node(mind, null, xml_root);\n            return mind;\n        },\n\n        get_data: function (mind) {\n            var df = format.freemind;\n            var json = {};\n            json.meta = {\n                name: mind.name,\n                author: mind.author,\n                version: mind.version\n            };\n            json.format = 'freemind';\n            var xmllines = [];\n            xmllines.push('<map version=\\\"1.0.1\\\">');\n            df._buildmap(mind.root, xmllines);\n            xmllines.push('</map>');\n            json.data = xmllines.join(' ');\n            return json;\n        },\n\n        _parse_xml: function (xml) {\n            var xml_doc = null;\n            if (window.DOMParser) {\n                var parser = new DOMParser();\n                xml_doc = parser.parseFromString(xml, 'text/xml');\n            } else { // Internet Explorer\n                xml_doc = new ActiveXObject('Microsoft.XMLDOM');\n                xml_doc.async = false;\n                xml_doc.loadXML(xml);\n            }\n            return xml_doc;\n        },\n\n        _find_root: function (xml_doc) {\n            var nodes = xml_doc.childNodes;\n            var node = null;\n            var root = null;\n            var n = null;\n            for (var i = 0; i < nodes.length; i++) {\n                n = nodes[i];\n                if (n.nodeType == 1 && n.tagName == 'map') {\n                    node = n;\n                    break;\n                }\n            }\n            if (!!node) {\n                var ns = node.childNodes;\n                node = null;\n                for (var i = 0; i < ns.length; i++) {\n                    n = ns[i];\n                    if (n.nodeType == 1 && n.tagName == 'node') {\n                        node = n;\n                        break;\n                    }\n                }\n            }\n            return node;\n        },\n\n        _load_node: function (mind, parent_node, xml_node) {\n            var df = format.freemind;\n            var node_id = xml_node.getAttribute('ID');\n            var node_topic = xml_node.getAttribute('TEXT');\n            // look for richcontent\n            if (node_topic == null) {\n                var topic_children = xml_node.childNodes;\n                var topic_child = null;\n                for (var i = 0; i < topic_children.length; i++) {\n                    topic_child = topic_children[i];\n                    if (topic_child.nodeType == 1 && topic_child.tagName === 'richcontent') {\n                        node_topic = topic_child.textContent;\n                        break;\n                    }\n                }\n            }\n            var node_data = df._load_attributes(xml_node);\n            var node_expanded = ('expanded' in node_data) ? (node_data.expanded == 'true') : true;\n            delete node_data.expanded;\n\n            var node_position = xml_node.getAttribute('POSITION');\n            var node_direction = null;\n            if (!!node_position) {\n                node_direction = node_position == 'left' ? Direction.left : Direction.right;\n            }\n            var node = null;\n            if (!!parent_node) {\n                node = mind.add_node(parent_node, node_id, node_topic, node_data, node_direction, node_expanded);\n            } else {\n                node = mind.set_root(node_id, node_topic, node_data);\n            }\n            var children = xml_node.childNodes;\n            var child = null;\n            for (var i = 0; i < children.length; i++) {\n                child = children[i];\n                if (child.nodeType == 1 && child.tagName == 'node') {\n                    df._load_node(mind, node, child);\n                }\n            }\n        },\n\n        _load_attributes: function (xml_node) {\n            var children = xml_node.childNodes;\n            var attr = null;\n            var attr_data = {};\n            for (var i = 0; i < children.length; i++) {\n                attr = children[i];\n                if (attr.nodeType == 1 && attr.tagName === 'attribute') {\n                    attr_data[attr.getAttribute('NAME')] = attr.getAttribute('VALUE');\n                }\n            }\n            return attr_data;\n        },\n\n        _buildmap: function (node, xmllines) {\n            var df = format.freemind;\n            var pos = null;\n            if (!!node.parent && node.parent.isroot) {\n                pos = node.direction === Direction.left ? 'left' : 'right';\n            }\n            xmllines.push('<node');\n            xmllines.push('ID=\\\"' + node.id + '\\\"');\n            if (!!pos) {\n                xmllines.push('POSITION=\\\"' + pos + '\\\"');\n            }\n            xmllines.push('TEXT=\\\"' + node.topic + '\\\">');\n\n            // store expanded status as an attribute\n            xmllines.push('<attribute NAME=\\\"expanded\\\" VALUE=\\\"' + node.expanded + '\\\"/>');\n\n            // for attributes\n            var node_data = node.data;\n            if (node_data != null) {\n                for (var k in node_data) {\n                    xmllines.push('<attribute NAME=\\\"' + k + '\\\" VALUE=\\\"' + node_data[k] + '\\\"/>');\n                }\n            }\n\n            // for children\n            var children = node.children;\n            for (var i = 0; i < children.length; i++) {\n                df._buildmap(children[i], xmllines);\n            }\n\n            xmllines.push('</node>');\n        },\n    }\n};\n","/**\n * @license BSD\n * @copyright 2014-2022 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\n\nimport { logger } from \"./jsmind.common.js\";\nimport { format } from \"./jsmind.format.js\";\n\nexport class DataProvider {\n    constructor(jm) {\n        this.jm = jm;\n    }\n\n    init() {\n        logger.debug('data.init');\n    }\n    reset() {\n        logger.debug('data.reset');\n    }\n    load(mind_data) {\n        var df = null;\n        var mind = null;\n        if (typeof mind_data === 'object') {\n            if (!!mind_data.format) {\n                df = mind_data.format;\n            } else {\n                df = 'node_tree';\n            }\n        } else {\n            df = 'freemind';\n        }\n\n        if (df == 'node_array') {\n            mind = format.node_array.get_mind(mind_data);\n        } else if (df == 'node_tree') {\n            mind = format.node_tree.get_mind(mind_data);\n        } else if (df == 'freemind') {\n            mind = format.freemind.get_mind(mind_data);\n        } else {\n            logger.warn('unsupported format');\n        }\n        return mind;\n    }\n    get_data(data_format) {\n        var data = null;\n        if (data_format == 'node_array') {\n            data = format.node_array.get_data(this.jm.mind);\n        } else if (data_format == 'node_tree') {\n            data = format.node_tree.get_data(this.jm.mind);\n        } else if (data_format == 'freemind') {\n            data = format.freemind.get_data(this.jm.mind);\n        } else {\n            logger.error('unsupported ' + data_format + ' format');\n        }\n        return data;\n    }\n}\n\n\n","/**\n * @license BSD\n * @copyright 2014-2022 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\nimport { logger, Direction, EventType } from \"./jsmind.common.js\";\n\nexport class LayoutProvider {\n    constructor(jm, options) {\n        this.opts = options;\n        this.jm = jm;\n        this.isside = (this.opts.mode == 'side');\n        this.bounds = null;\n\n        this.cache_valid = false;\n    }\n    init() {\n        logger.debug('layout.init');\n    }\n    reset() {\n        logger.debug('layout.reset');\n        this.bounds = { n: 0, s: 0, w: 0, e: 0 };\n    }\n    calculate_next_child_direction(node) {\n        if (this.isside) {\n            return Direction.right;\n        }\n        var children = node.children || [];\n        var children_len = children.length;\n        var r = 0;\n        for (var i = 0; i < children_len; i++) { if (children[i].direction === Direction.left) { r--; } else { r++; } }\n        return (children_len > 1 && r > 0) ? Direction.left : Direction.right;\n    }\n    layout() {\n        logger.debug('layout.layout');\n        this.layout_direction();\n        this.layout_offset();\n    }\n    layout_direction() {\n        this._layout_direction_root();\n    }\n    _layout_direction_root() {\n        var node = this.jm.mind.root;\n        var layout_data = null;\n        if ('layout' in node._data) {\n            layout_data = node._data.layout;\n        } else {\n            layout_data = {};\n            node._data.layout = layout_data;\n        }\n        var children = node.children;\n        var children_count = children.length;\n        layout_data.direction = Direction.center;\n        layout_data.side_index = 0;\n        if (this.isside) {\n            var i = children_count;\n            while (i--) {\n                this._layout_direction_side(children[i], Direction.right, i);\n            }\n        } else {\n            var i = children_count;\n            var subnode = null;\n            while (i--) {\n                subnode = children[i];\n                if (subnode.direction == Direction.left) {\n                    this._layout_direction_side(subnode, Direction.left, i);\n                } else {\n                    this._layout_direction_side(subnode, Direction.right, i);\n                }\n            }\n        }\n    }\n    _layout_direction_side(node, direction, side_index) {\n        var layout_data = null;\n        if ('layout' in node._data) {\n            layout_data = node._data.layout;\n        } else {\n            layout_data = {};\n            node._data.layout = layout_data;\n        }\n        var children = node.children;\n        var children_count = children.length;\n\n        layout_data.direction = direction;\n        layout_data.side_index = side_index;\n        var i = children_count;\n        while (i--) {\n            this._layout_direction_side(children[i], direction, i);\n        }\n    }\n    layout_offset() {\n        var node = this.jm.mind.root;\n        var layout_data = node._data.layout;\n        layout_data.offset_x = 0;\n        layout_data.offset_y = 0;\n        layout_data.outer_height = 0;\n        var children = node.children;\n        var i = children.length;\n        var left_nodes = [];\n        var right_nodes = [];\n        var subnode = null;\n        while (i--) {\n            subnode = children[i];\n            if (subnode._data.layout.direction == Direction.right) {\n                right_nodes.unshift(subnode);\n            } else {\n                left_nodes.unshift(subnode);\n            }\n        }\n        layout_data.left_nodes = left_nodes;\n        layout_data.right_nodes = right_nodes;\n        layout_data.outer_height_left = this._layout_offset_subnodes(left_nodes);\n        layout_data.outer_height_right = this._layout_offset_subnodes(right_nodes);\n        this.bounds.e = node._data.view.width / 2;\n        this.bounds.w = 0 - this.bounds.e;\n        this.bounds.n = 0;\n        this.bounds.s = Math.max(layout_data.outer_height_left, layout_data.outer_height_right);\n    }\n    // layout both the x and y axis\n    _layout_offset_subnodes(nodes) {\n        var total_height = 0;\n        var nodes_count = nodes.length;\n        var i = nodes_count;\n        var node = null;\n        var node_outer_height = 0;\n        var layout_data = null;\n        var base_y = 0;\n        var pd = null; // parent._data\n        while (i--) {\n            node = nodes[i];\n            layout_data = node._data.layout;\n            if (pd == null) {\n                pd = node.parent._data;\n            }\n\n            node_outer_height = this._layout_offset_subnodes(node.children);\n            if (!node.expanded) {\n                node_outer_height = 0;\n                this.set_visible(node.children, false);\n            }\n            node_outer_height = Math.max(node._data.view.height, node_outer_height);\n\n            layout_data.outer_height = node_outer_height;\n            layout_data.offset_y = base_y - node_outer_height / 2;\n            layout_data.offset_x = this.opts.hspace * layout_data.direction + pd.view.width * (pd.layout.direction + layout_data.direction) / 2;\n            if (!node.parent.isroot) {\n                layout_data.offset_x += this.opts.pspace * layout_data.direction;\n            }\n\n            base_y = base_y - node_outer_height - this.opts.vspace;\n            total_height += node_outer_height;\n        }\n        if (nodes_count > 1) {\n            total_height += this.opts.vspace * (nodes_count - 1);\n        }\n        i = nodes_count;\n        var middle_height = total_height / 2;\n        while (i--) {\n            node = nodes[i];\n            node._data.layout.offset_y += middle_height;\n        }\n        return total_height;\n    }\n    // layout the y axis only, for collapse/expand a node\n    _layout_offset_subnodes_height(nodes) {\n        var total_height = 0;\n        var nodes_count = nodes.length;\n        var i = nodes_count;\n        var node = null;\n        var node_outer_height = 0;\n        var layout_data = null;\n        var base_y = 0;\n        var pd = null; // parent._data\n        while (i--) {\n            node = nodes[i];\n            layout_data = node._data.layout;\n            if (pd == null) {\n                pd = node.parent._data;\n            }\n\n            node_outer_height = this._layout_offset_subnodes_height(node.children);\n            if (!node.expanded) {\n                node_outer_height = 0;\n            }\n            node_outer_height = Math.max(node._data.view.height, node_outer_height);\n\n            layout_data.outer_height = node_outer_height;\n            layout_data.offset_y = base_y - node_outer_height / 2;\n            base_y = base_y - node_outer_height - this.opts.vspace;\n            total_height += node_outer_height;\n        }\n        if (nodes_count > 1) {\n            total_height += this.opts.vspace * (nodes_count - 1);\n        }\n        i = nodes_count;\n        var middle_height = total_height / 2;\n        while (i--) {\n            node = nodes[i];\n            node._data.layout.offset_y += middle_height;\n        }\n        return total_height;\n    }\n    get_node_offset(node) {\n        var layout_data = node._data.layout;\n        var offset_cache = null;\n        if (('_offset_' in layout_data) && this.cache_valid) {\n            offset_cache = layout_data._offset_;\n        } else {\n            offset_cache = { x: -1, y: -1 };\n            layout_data._offset_ = offset_cache;\n        }\n        if (offset_cache.x == -1 || offset_cache.y == -1) {\n            var x = layout_data.offset_x;\n            var y = layout_data.offset_y;\n            if (!node.isroot) {\n                var offset_p = this.get_node_offset(node.parent);\n                x += offset_p.x;\n                y += offset_p.y;\n            }\n            offset_cache.x = x;\n            offset_cache.y = y;\n        }\n        return offset_cache;\n    }\n    get_node_point(node) {\n        var view_data = node._data.view;\n        var offset_p = this.get_node_offset(node);\n        var p = {};\n        p.x = offset_p.x + view_data.width * (node._data.layout.direction - 1) / 2;\n        p.y = offset_p.y - view_data.height / 2;\n        return p;\n    }\n    get_node_point_in(node) {\n        var p = this.get_node_offset(node);\n        return p;\n    }\n    get_node_point_out(node) {\n        var layout_data = node._data.layout;\n        var pout_cache = null;\n        if (('_pout_' in layout_data) && this.cache_valid) {\n            pout_cache = layout_data._pout_;\n        } else {\n            pout_cache = { x: -1, y: -1 };\n            layout_data._pout_ = pout_cache;\n        }\n        if (pout_cache.x == -1 || pout_cache.y == -1) {\n            if (node.isroot) {\n                pout_cache.x = 0;\n                pout_cache.y = 0;\n            } else {\n                var view_data = node._data.view;\n                var offset_p = this.get_node_offset(node);\n                pout_cache.x = offset_p.x + (view_data.width + this.opts.pspace) * node._data.layout.direction;\n                pout_cache.y = offset_p.y;\n            }\n        }\n        return pout_cache;\n    }\n    get_expander_point(node) {\n        var p = this.get_node_point_out(node);\n        var ex_p = {};\n        if (node._data.layout.direction == Direction.right) {\n            ex_p.x = p.x - this.opts.pspace;\n        } else {\n            ex_p.x = p.x;\n        }\n        ex_p.y = p.y - Math.ceil(this.opts.pspace / 2);\n        return ex_p;\n    }\n    get_min_size() {\n        var nodes = this.jm.mind.nodes;\n        var node = null;\n        var pout = null;\n        for (var nodeid in nodes) {\n            node = nodes[nodeid];\n            pout = this.get_node_point_out(node);\n            if (pout.x > this.bounds.e) { this.bounds.e = pout.x; }\n            if (pout.x < this.bounds.w) { this.bounds.w = pout.x; }\n        }\n        return {\n            w: this.bounds.e - this.bounds.w,\n            h: this.bounds.s - this.bounds.n\n        };\n    }\n    toggle_node(node) {\n        if (node.isroot) {\n            return;\n        }\n        if (node.expanded) {\n            this.collapse_node(node);\n        } else {\n            this.expand_node(node);\n        }\n    }\n    expand_node(node) {\n        node.expanded = true;\n        this.part_layout(node);\n        this.set_visible(node.children, true);\n        this.jm.invoke_event_handle(EventType.show, { evt: 'expand_node', data: [], node: node.id });\n    }\n    collapse_node(node) {\n        node.expanded = false;\n        this.part_layout(node);\n        this.set_visible(node.children, false);\n        this.jm.invoke_event_handle(EventType.show, { evt: 'collapse_node', data: [], node: node.id });\n    }\n    expand_all() {\n        var nodes = this.jm.mind.nodes;\n        var c = 0;\n        var node;\n        for (var nodeid in nodes) {\n            node = nodes[nodeid];\n            if (!node.expanded) {\n                node.expanded = true;\n                c++;\n            }\n        }\n        if (c > 0) {\n            var root = this.jm.mind.root;\n            this.part_layout(root);\n            this.set_visible(root.children, true);\n        }\n    }\n    collapse_all() {\n        var nodes = this.jm.mind.nodes;\n        var c = 0;\n        var node;\n        for (var nodeid in nodes) {\n            node = nodes[nodeid];\n            if (node.expanded && !node.isroot) {\n                node.expanded = false;\n                c++;\n            }\n        }\n        if (c > 0) {\n            var root = this.jm.mind.root;\n            this.part_layout(root);\n            this.set_visible(root.children, true);\n        }\n    }\n    expand_to_depth(target_depth, curr_nodes, curr_depth) {\n        if (target_depth < 1) { return; }\n        var nodes = curr_nodes || this.jm.mind.root.children;\n        var depth = curr_depth || 1;\n        var i = nodes.length;\n        var node = null;\n        while (i--) {\n            node = nodes[i];\n            if (depth < target_depth) {\n                if (!node.expanded) {\n                    this.expand_node(node);\n                }\n                this.expand_to_depth(target_depth, node.children, depth + 1);\n            }\n            if (depth == target_depth) {\n                if (node.expanded) {\n                    this.collapse_node(node);\n                }\n            }\n        }\n    }\n    part_layout(node) {\n        var root = this.jm.mind.root;\n        if (!!root) {\n            var root_layout_data = root._data.layout;\n            if (node.isroot) {\n                root_layout_data.outer_height_right = this._layout_offset_subnodes_height(root_layout_data.right_nodes);\n                root_layout_data.outer_height_left = this._layout_offset_subnodes_height(root_layout_data.left_nodes);\n            } else {\n                if (node._data.layout.direction == Direction.right) {\n                    root_layout_data.outer_height_right = this._layout_offset_subnodes_height(root_layout_data.right_nodes);\n                } else {\n                    root_layout_data.outer_height_left = this._layout_offset_subnodes_height(root_layout_data.left_nodes);\n                }\n            }\n            this.bounds.s = Math.max(root_layout_data.outer_height_left, root_layout_data.outer_height_right);\n            this.cache_valid = false;\n        } else {\n            logger.warn('can not found root node');\n        }\n    }\n    set_visible(nodes, visible) {\n        var i = nodes.length;\n        var node = null;\n        var layout_data = null;\n        while (i--) {\n            node = nodes[i];\n            layout_data = node._data.layout;\n            if (node.expanded) {\n                this.set_visible(node.children, visible);\n            } else {\n                this.set_visible(node.children, false);\n            }\n            if (!node.isroot) {\n                node._data.layout.visible = visible;\n            }\n        }\n    }\n    is_expand(node) {\n        return node.expanded;\n    }\n    is_visible(node) {\n        var layout_data = node._data.layout;\n        if (('visible' in layout_data) && !layout_data.visible) {\n            return false;\n        } else {\n            return true;\n        }\n    }\n}\n\n\n","/**\n * @license BSD\n * @copyright 2014-2022 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\n\nimport { $ } from \"./jsmind.dom.js\";\n\nclass graph_svg {\n    constructor(view) {\n        this.view = view;\n        this.opts = view.opts;\n        this.e_svg = graph_svg.c('svg');\n        this.e_svg.setAttribute('class', 'jsmind');\n        this.size = { w: 0, h: 0 };\n        this.lines = [];\n    }\n    static c(tag) {\n        return $.d.createElementNS('http://www.w3.org/2000/svg', tag);\n    }\n    element() {\n        return this.e_svg;\n    }\n    set_size(w, h) {\n        this.size.w = w;\n        this.size.h = h;\n        this.e_svg.setAttribute('width', w);\n        this.e_svg.setAttribute('height', h);\n    }\n    clear() {\n        var len = this.lines.length;\n        while (len--) {\n            this.e_svg.removeChild(this.lines[len]);\n        }\n        this.lines.length = 0;\n    }\n    draw_line(pout, pin, offset) {\n        var line = graph_svg.c('path');\n        line.setAttribute('stroke', this.opts.line_color);\n        line.setAttribute('stroke-width', this.opts.line_width);\n        line.setAttribute('fill', 'transparent');\n        this.lines.push(line);\n        this.e_svg.appendChild(line);\n        this._bezier_to(line, pin.x + offset.x, pin.y + offset.y, pout.x + offset.x, pout.y + offset.y);\n    }\n    copy_to(dest_canvas_ctx, callback) {\n        var img = new Image();\n        img.onload = function () {\n            dest_canvas_ctx.drawImage(img, 0, 0);\n            !!callback && callback();\n        };\n        img.src = 'data:image/svg+xml;base64,' + btoa(new XMLSerializer().serializeToString(this.e_svg));\n    }\n    _bezier_to(path, x1, y1, x2, y2) {\n        path.setAttribute('d', 'M' + x1 + ' ' + y1 + ' C ' + (x1 + (x2 - x1) * 2 / 3) + ' ' + y1 + ', ' + x1 + ' ' + y2 + ', ' + x2 + ' ' + y2);\n    }\n    _line_to(path, x1, y1, x2, y2) {\n        path.setAttribute('d', 'M ' + x1 + ' ' + y1 + ' L ' + x2 + ' ' + y2);\n    }\n}\n\n\nclass graph_canvas {\n    constructor(view) {\n        this.opts = view.opts;\n        this.e_canvas = $.c('canvas');\n        this.e_canvas.className = 'jsmind';\n        this.canvas_ctx = this.e_canvas.getContext('2d');\n        this.size = { w: 0, h: 0 };\n    }\n    element() {\n        return this.e_canvas;\n    }\n    set_size(w, h) {\n        this.size.w = w;\n        this.size.h = h;\n        this.e_canvas.width = w;\n        this.e_canvas.height = h;\n    }\n    clear() {\n        this.canvas_ctx.clearRect(0, 0, this.size.w, this.size.h);\n    }\n    draw_line(pout, pin, offset) {\n        var ctx = this.canvas_ctx;\n        ctx.strokeStyle = this.opts.line_color;\n        ctx.lineWidth = this.opts.line_width;\n        ctx.lineCap = 'round';\n\n        this._bezier_to(ctx,\n            pin.x + offset.x,\n            pin.y + offset.y,\n            pout.x + offset.x,\n            pout.y + offset.y);\n    }\n    copy_to(dest_canvas_ctx, callback) {\n        dest_canvas_ctx.drawImage(this.e_canvas, 0, 0);\n        !!callback && callback();\n    }\n    _bezier_to(ctx, x1, y1, x2, y2) {\n        ctx.beginPath();\n        ctx.moveTo(x1, y1);\n        ctx.bezierCurveTo(x1 + (x2 - x1) * 2 / 3, y1, x1, y2, x2, y2);\n        ctx.stroke();\n    }\n    _line_to(ctx, x1, y1, x2, y2) {\n        ctx.beginPath();\n        ctx.moveTo(x1, y1);\n        ctx.lineTo(x2, y2);\n        ctx.stroke();\n    }\n}\n\nexport const graph = { svg: graph_svg, canvas: graph_canvas };\n","/**\n * @license BSD\n * @copyright 2014-2022 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\nimport { logger, EventType } from \"./jsmind.common.js\";\nimport { $ } from \"./jsmind.dom.js\";\nimport { graph } from \"./jsmind.graph.js\";\nimport { util } from \"./jsmind.util.js\";\n\nexport class ViewProvider {\n    constructor(jm, options) {\n        this.opts = options;\n        this.jm = jm;\n        this.layout = jm.layout;\n\n        this.container = null;\n        this.e_panel = null;\n        this.e_nodes = null;\n\n        this.size = { w: 0, h: 0 };\n\n        this.selected_node = null;\n        this.editing_node = null;\n\n        this.graph = null;\n    }\n    init() {\n        logger.debug('view.init');\n\n        this.container = $.i(this.opts.container) ? this.opts.container : $.g(this.opts.container);\n        if (!this.container) {\n            logger.error('the options.view.container was not be found in dom');\n            return;\n        }\n        this.e_panel = $.c('div');\n        this.e_nodes = $.c('jmnodes');\n        this.e_editor = $.c('input');\n\n        this.graph = this.opts.engine.toLowerCase() === 'svg' ? new graph.svg(this) : new graph.canvas(this);\n\n        this.e_panel.className = 'jsmind-inner';\n        this.e_panel.tabIndex = 1;\n        this.e_panel.appendChild(this.graph.element());\n        this.e_panel.appendChild(this.e_nodes);\n\n        this.e_editor.className = 'jsmind-editor';\n        this.e_editor.type = 'text';\n\n        this.actualZoom = 1;\n        this.zoomStep = 0.1;\n        this.minZoom = 0.5;\n        this.maxZoom = 2;\n\n        var v = this;\n        $.on(this.e_editor, 'keydown', function (e) {\n            var evt = e || event;\n            if (evt.keyCode == 13) { v.edit_node_end(); evt.stopPropagation(); }\n        });\n        $.on(this.e_editor, 'blur', function (e) {\n            v.edit_node_end();\n        });\n\n        this.container.appendChild(this.e_panel);\n\n        this.enable_draggable_canvas();\n    }\n    add_event(obj, event_name, event_handle) {\n        $.on(this.e_nodes, event_name, function (e) {\n            var evt = e || event;\n            event_handle.call(obj, evt);\n        });\n    }\n    get_binded_nodeid(element) {\n        if (element == null) {\n            return null;\n        }\n        var tagName = element.tagName.toLowerCase();\n        if (tagName == 'jmnodes' || tagName == 'body' || tagName == 'html') {\n            return null;\n        }\n        if (tagName == 'jmnode' || tagName == 'jmexpander') {\n            return element.getAttribute('nodeid');\n        } else {\n            return this.get_binded_nodeid(element.parentElement);\n        }\n    }\n    is_expander(element) {\n        return (element.tagName.toLowerCase() == 'jmexpander');\n    }\n    reset() {\n        logger.debug('view.reset');\n        this.selected_node = null;\n        this.clear_lines();\n        this.clear_nodes();\n        this.reset_theme();\n    }\n    reset_theme() {\n        var theme_name = this.jm.options.theme;\n        if (!!theme_name) {\n            this.e_nodes.className = 'theme-' + theme_name;\n        } else {\n            this.e_nodes.className = '';\n        }\n    }\n    reset_custom_style() {\n        var nodes = this.jm.mind.nodes;\n        for (var nodeid in nodes) {\n            this.reset_node_custom_style(nodes[nodeid]);\n        }\n    }\n    load() {\n        logger.debug('view.load');\n        this.init_nodes();\n    }\n    expand_size() {\n        var min_size = this.layout.get_min_size();\n        var min_width = min_size.w + this.opts.hmargin * 2;\n        var min_height = min_size.h + this.opts.vmargin * 2;\n        var client_w = this.e_panel.clientWidth;\n        var client_h = this.e_panel.clientHeight;\n        if (client_w < min_width) { client_w = min_width; }\n        if (client_h < min_height) { client_h = min_height; }\n        this.size.w = client_w;\n        this.size.h = client_h;\n    }\n    init_nodes_size(node) {\n        var view_data = node._data.view;\n        view_data.width = view_data.element.clientWidth;\n        view_data.height = view_data.element.clientHeight;\n    }\n    init_nodes() {\n        var nodes = this.jm.mind.nodes;\n        var doc_frag = $.d.createDocumentFragment();\n        for (var nodeid in nodes) {\n            this.create_node_element(nodes[nodeid], doc_frag);\n        }\n        this.e_nodes.appendChild(doc_frag);\n        for (var nodeid in nodes) {\n            this.init_nodes_size(nodes[nodeid]);\n        }\n    }\n    add_node(node) {\n        this.create_node_element(node, this.e_nodes);\n        this.init_nodes_size(node);\n    }\n    create_node_element(node, parent_node) {\n        var view_data = null;\n        if ('view' in node._data) {\n            view_data = node._data.view;\n        } else {\n            view_data = {};\n            node._data.view = view_data;\n        }\n\n        var d = $.c('jmnode');\n        if (node.isroot) {\n            d.className = 'root';\n        } else {\n            var d_e = $.c('jmexpander');\n            $.t(d_e, '-');\n            d_e.setAttribute('nodeid', node.id);\n            d_e.style.visibility = 'hidden';\n            parent_node.appendChild(d_e);\n            view_data.expander = d_e;\n        }\n        if (!!node.topic) {\n            if (this.opts.support_html) {\n                $.h(d, node.topic);\n            } else {\n                $.t(d, node.topic);\n            }\n        }\n        d.setAttribute('nodeid', node.id);\n        d.style.visibility = 'hidden';\n        this._reset_node_custom_style(d, node.data);\n\n        parent_node.appendChild(d);\n        view_data.element = d;\n    }\n    remove_node(node) {\n        if (this.selected_node != null && this.selected_node.id == node.id) {\n            this.selected_node = null;\n        }\n        if (this.editing_node != null && this.editing_node.id == node.id) {\n            node._data.view.element.removeChild(this.e_editor);\n            this.editing_node = null;\n        }\n        var children = node.children;\n        var i = children.length;\n        while (i--) {\n            this.remove_node(children[i]);\n        }\n        if (node._data.view) {\n            var element = node._data.view.element;\n            var expander = node._data.view.expander;\n            this.e_nodes.removeChild(element);\n            this.e_nodes.removeChild(expander);\n            node._data.view.element = null;\n            node._data.view.expander = null;\n        }\n    }\n    update_node(node) {\n        var view_data = node._data.view;\n        var element = view_data.element;\n        if (!!node.topic) {\n            if (this.opts.support_html) {\n                $.h(element, node.topic);\n            } else {\n                $.t(element, node.topic);\n            }\n        }\n        view_data.width = element.clientWidth;\n        view_data.height = element.clientHeight;\n    }\n    select_node(node) {\n        if (!!this.selected_node) {\n            this.selected_node._data.view.element.className =\n                this.selected_node._data.view.element.className.replace(/\\s*selected\\b/i, '');\n            this.reset_node_custom_style(this.selected_node);\n        }\n        if (!!node) {\n            this.selected_node = node;\n            node._data.view.element.className += ' selected';\n            this.clear_node_custom_style(node);\n        }\n    }\n    select_clear() {\n        this.select_node(null);\n    }\n    get_editing_node() {\n        return this.editing_node;\n    }\n    is_editing() {\n        return (!!this.editing_node);\n    }\n    edit_node_begin(node) {\n        if (!node.topic) {\n            logger.warn(\"don't edit image nodes\");\n            return;\n        }\n        if (this.editing_node != null) {\n            this.edit_node_end();\n        }\n        this.editing_node = node;\n        var view_data = node._data.view;\n        var element = view_data.element;\n        var topic = node.topic;\n        var ncs = getComputedStyle(element);\n        this.e_editor.value = topic;\n        this.e_editor.style.width = (element.clientWidth - parseInt(ncs.getPropertyValue('padding-left')) - parseInt(ncs.getPropertyValue('padding-right'))) + 'px';\n        element.innerHTML = '';\n        element.appendChild(this.e_editor);\n        element.style.zIndex = 5;\n        this.e_editor.focus();\n        this.e_editor.select();\n    }\n    edit_node_end() {\n        if (this.editing_node != null) {\n            var node = this.editing_node;\n            this.editing_node = null;\n            var view_data = node._data.view;\n            var element = view_data.element;\n            var topic = this.e_editor.value;\n            element.style.zIndex = 'auto';\n            element.removeChild(this.e_editor);\n            if (util.text.is_empty(topic) || node.topic === topic) {\n                if (this.opts.support_html) {\n                    $.h(element, node.topic);\n                } else {\n                    $.t(element, node.topic);\n                }\n            } else {\n                this.jm.update_node(node.id, topic);\n            }\n        }\n        this.e_panel.focus();\n    }\n    get_view_offset() {\n        var bounds = this.layout.bounds;\n        var _x = (this.size.w - bounds.e - bounds.w) / 2;\n        var _y = this.size.h / 2;\n        return { x: _x, y: _y };\n    }\n    resize() {\n        this.graph.set_size(1, 1);\n        this.e_nodes.style.width = '1px';\n        this.e_nodes.style.height = '1px';\n\n        this.expand_size();\n        this._show();\n    }\n    _show() {\n        this.graph.set_size(this.size.w, this.size.h);\n        this.e_nodes.style.width = this.size.w + 'px';\n        this.e_nodes.style.height = this.size.h + 'px';\n        this.show_nodes();\n        this.show_lines();\n        //this.layout.cache_valid = true;\n        this.jm.invoke_event_handle(EventType.resize, { data: [] });\n    }\n    zoomIn() {\n        return this.setZoom(this.actualZoom + this.zoomStep);\n    }\n    zoomOut() {\n        return this.setZoom(this.actualZoom - this.zoomStep);\n    }\n    setZoom(zoom) {\n        if ((zoom < this.minZoom) || (zoom > this.maxZoom)) {\n            return false;\n        }\n        this.actualZoom = zoom;\n        for (var i = 0; i < this.e_panel.children.length; i++) {\n            this.e_panel.children[i].style.transform = 'scale(' + zoom + ')';\n        };\n        this.show(true);\n        return true;\n\n    }\n    _center_root() {\n        // center root node\n        var outer_w = this.e_panel.clientWidth;\n        var outer_h = this.e_panel.clientHeight;\n        if (this.size.w > outer_w) {\n            var _offset = this.get_view_offset();\n            this.e_panel.scrollLeft = _offset.x - outer_w / 2;\n        }\n        if (this.size.h > outer_h) {\n            this.e_panel.scrollTop = (this.size.h - outer_h) / 2;\n        }\n    }\n    show(keep_center) {\n        logger.debug('view.show');\n        this.expand_size();\n        this._show();\n        if (!!keep_center) {\n            this._center_root();\n        }\n    }\n    relayout() {\n        this.expand_size();\n        this._show();\n    }\n    save_location(node) {\n        var vd = node._data.view;\n        vd._saved_location = {\n            x: parseInt(vd.element.style.left) - this.e_panel.scrollLeft,\n            y: parseInt(vd.element.style.top) - this.e_panel.scrollTop,\n        };\n    }\n    restore_location(node) {\n        var vd = node._data.view;\n        this.e_panel.scrollLeft = parseInt(vd.element.style.left) - vd._saved_location.x;\n        this.e_panel.scrollTop = parseInt(vd.element.style.top) - vd._saved_location.y;\n    }\n    clear_nodes() {\n        var mind = this.jm.mind;\n        if (mind == null) {\n            return;\n        }\n        var nodes = mind.nodes;\n        var node = null;\n        for (var nodeid in nodes) {\n            node = nodes[nodeid];\n            node._data.view.element = null;\n            node._data.view.expander = null;\n        }\n        this.e_nodes.innerHTML = '';\n    }\n    show_nodes() {\n        var nodes = this.jm.mind.nodes;\n        var node = null;\n        var node_element = null;\n        var expander = null;\n        var p = null;\n        var p_expander = null;\n        var expander_text = '-';\n        var view_data = null;\n        var _offset = this.get_view_offset();\n        for (var nodeid in nodes) {\n            node = nodes[nodeid];\n            view_data = node._data.view;\n            node_element = view_data.element;\n            expander = view_data.expander;\n            if (!this.layout.is_visible(node)) {\n                node_element.style.display = 'none';\n                expander.style.display = 'none';\n                continue;\n            }\n            this.reset_node_custom_style(node);\n            p = this.layout.get_node_point(node);\n            view_data.abs_x = _offset.x + p.x;\n            view_data.abs_y = _offset.y + p.y;\n            node_element.style.left = (_offset.x + p.x) + 'px';\n            node_element.style.top = (_offset.y + p.y) + 'px';\n            node_element.style.display = '';\n            node_element.style.visibility = 'visible';\n            if (!node.isroot && node.children.length > 0) {\n                expander_text = node.expanded ? '-' : '+';\n                p_expander = this.layout.get_expander_point(node);\n                expander.style.left = (_offset.x + p_expander.x) + 'px';\n                expander.style.top = (_offset.y + p_expander.y) + 'px';\n                expander.style.display = '';\n                expander.style.visibility = 'visible';\n                $.t(expander, expander_text);\n            }\n            // hide expander while all children have been removed\n            if (!node.isroot && node.children.length == 0) {\n                expander.style.display = 'none';\n                expander.style.visibility = 'hidden';\n            }\n        }\n    }\n    reset_node_custom_style(node) {\n        this._reset_node_custom_style(node._data.view.element, node.data);\n    }\n    _reset_node_custom_style(node_element, node_data) {\n        if ('background-color' in node_data) {\n            node_element.style.backgroundColor = node_data['background-color'];\n        }\n        if ('foreground-color' in node_data) {\n            node_element.style.color = node_data['foreground-color'];\n        }\n        if ('width' in node_data) {\n            node_element.style.width = node_data['width'] + 'px';\n        }\n        if ('height' in node_data) {\n            node_element.style.height = node_data['height'] + 'px';\n        }\n        if ('font-size' in node_data) {\n            node_element.style.fontSize = node_data['font-size'] + 'px';\n        }\n        if ('font-weight' in node_data) {\n            node_element.style.fontWeight = node_data['font-weight'];\n        }\n        if ('font-style' in node_data) {\n            node_element.style.fontStyle = node_data['font-style'];\n        }\n        if ('background-image' in node_data) {\n            var backgroundImage = node_data['background-image'];\n            if (backgroundImage.startsWith('data') && node_data['width'] && node_data['height']) {\n                var img = new Image();\n\n                img.onload = function () {\n                    var c = $.c('canvas');\n                    c.width = node_element.clientWidth;\n                    c.height = node_element.clientHeight;\n                    var img = this;\n                    if (c.getContext) {\n                        var ctx = c.getContext('2d');\n                        ctx.drawImage(img, 2, 2, node_element.clientWidth, node_element.clientHeight);\n                        var scaledImageData = c.toDataURL();\n                        node_element.style.backgroundImage = 'url(' + scaledImageData + ')';\n                    }\n                };\n                img.src = backgroundImage;\n\n            } else {\n                node_element.style.backgroundImage = 'url(' + backgroundImage + ')';\n            }\n            node_element.style.backgroundSize = '99%';\n\n            if ('background-rotation' in node_data) {\n                node_element.style.transform = 'rotate(' + node_data['background-rotation'] + 'deg)';\n            }\n        }\n    }\n    clear_node_custom_style(node) {\n        var node_element = node._data.view.element;\n        node_element.style.backgroundColor = \"\";\n        node_element.style.color = \"\";\n    }\n    clear_lines() {\n        this.graph.clear();\n    }\n    show_lines() {\n        this.clear_lines();\n        var nodes = this.jm.mind.nodes;\n        var node = null;\n        var pin = null;\n        var pout = null;\n        var _offset = this.get_view_offset();\n        for (var nodeid in nodes) {\n            node = nodes[nodeid];\n            if (!!node.isroot) { continue; }\n            if (('visible' in node._data.layout) && !node._data.layout.visible) { continue; }\n            pin = this.layout.get_node_point_in(node);\n            pout = this.layout.get_node_point_out(node.parent);\n            this.graph.draw_line(pout, pin, _offset);\n        }\n    }\n    // Drag the whole mind map with your mouse, when it's larger that the container\n    enable_draggable_canvas() {\n        // If draggable option is true.\n        if (this.opts.draggable) {\n            // Dragging disabled by default.\n            let dragging = false;\n            let x, y;\n            if (this.opts.hide_scrollbars_when_draggable) {\n                // Avoid scrollbars when mind map is larger than the container (e_panel = id jsmind-inner)\n                this.e_panel.style = 'overflow: hidden';\n            }\n            // Move the whole mind map with mouse moves, while button is down.\n            $.on(this.container, 'mousedown', (eventDown) => {\n                dragging = true;\n                // Record current mouse position.\n                x = eventDown.clientX;\n                y = eventDown.clientY;\n            });\n            // Stop moving mind map once mouse button is released.\n            $.on(this.container, 'mouseup', () => {\n                dragging = false;\n            });\n            // Follow current mouse position and move mind map accordingly.\n            $.on(this.container, 'mousemove', (eventMove) => {\n                if (dragging) {\n                    this.e_panel.scrollBy(x - eventMove.clientX, y - eventMove.clientY);\n                    // Record new current position.\n                    x = eventMove.clientX;\n                    y = eventMove.clientY;\n                }\n            });\n        }\n    }\n}\n\n\n","/**\n * @license BSD\n * @copyright 2014-2022 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\n\nimport { $ } from \"./jsmind.dom.js\";\nimport { util } from \"./jsmind.util.js\";\nimport { Direction } from \"./jsmind.common.js\";\n\nexport class ShortcutProvider {\n    constructor(jm, options) {\n        this.jm = jm;\n        this.opts = options;\n        this.mapping = options.mapping;\n        this.handles = options.handles;\n        this._newid = null;\n        this._mapping = {};\n    }\n    init() {\n        $.on(this.jm.view.e_panel, 'keydown', this.handler.bind(this));\n\n        this.handles['addchild'] = this.handle_addchild;\n        this.handles['addbrother'] = this.handle_addbrother;\n        this.handles['editnode'] = this.handle_editnode;\n        this.handles['delnode'] = this.handle_delnode;\n        this.handles['toggle'] = this.handle_toggle;\n        this.handles['up'] = this.handle_up;\n        this.handles['down'] = this.handle_down;\n        this.handles['left'] = this.handle_left;\n        this.handles['right'] = this.handle_right;\n\n        for (var handle in this.mapping) {\n            if (!!this.mapping[handle] && (handle in this.handles)) {\n                this._mapping[this.mapping[handle]] = this.handles[handle];\n            }\n        }\n\n        if (typeof this.opts.id_generator === 'function') {\n            this._newid = this.opts.id_generator;\n        } else {\n            this._newid = util.uuid.newid;\n        }\n    }\n    enable_shortcut() {\n        this.opts.enable = true;\n    }\n    disable_shortcut() {\n        this.opts.enable = false;\n    }\n    handler(e) {\n        if (e.which == 9) { e.preventDefault(); } //prevent tab to change focus in browser\n        if (this.jm.view.is_editing()) { return; }\n        var evt = e || event;\n        if (!this.opts.enable) { return true; }\n        var kc = evt.keyCode + (evt.metaKey << 13) + (evt.ctrlKey << 12) + (evt.altKey << 11) + (evt.shiftKey << 10);\n        if (kc in this._mapping) {\n            this._mapping[kc].call(this, this.jm, e);\n        }\n    }\n    handle_addchild(_jm, e) {\n        var selected_node = _jm.get_selected_node();\n        if (!!selected_node) {\n            var nodeid = this._newid();\n            var node = _jm.add_node(selected_node, nodeid, 'New Node');\n            if (!!node) {\n                _jm.select_node(nodeid);\n                _jm.begin_edit(nodeid);\n            }\n        }\n    }\n    handle_addbrother(_jm, e) {\n        var selected_node = _jm.get_selected_node();\n        if (!!selected_node && !selected_node.isroot) {\n            var nodeid = this._newid();\n            var node = _jm.insert_node_after(selected_node, nodeid, 'New Node');\n            if (!!node) {\n                _jm.select_node(nodeid);\n                _jm.begin_edit(nodeid);\n            }\n        }\n    }\n    handle_editnode(_jm, e) {\n        var selected_node = _jm.get_selected_node();\n        if (!!selected_node) {\n            _jm.begin_edit(selected_node);\n        }\n    }\n    handle_delnode(_jm, e) {\n        var selected_node = _jm.get_selected_node();\n        if (!!selected_node && !selected_node.isroot) {\n            _jm.select_node(selected_node.parent);\n            _jm.remove_node(selected_node);\n        }\n    }\n    handle_toggle(_jm, e) {\n        var evt = e || event;\n        var selected_node = _jm.get_selected_node();\n        if (!!selected_node) {\n            _jm.toggle_node(selected_node.id);\n            evt.stopPropagation();\n            evt.preventDefault();\n        }\n    }\n    handle_up(_jm, e) {\n        var evt = e || event;\n        var selected_node = _jm.get_selected_node();\n        if (!!selected_node) {\n            var up_node = _jm.find_node_before(selected_node);\n            if (!up_node) {\n                var np = _jm.find_node_before(selected_node.parent);\n                if (!!np && np.children.length > 0) {\n                    up_node = np.children[np.children.length - 1];\n                }\n            }\n            if (!!up_node) {\n                _jm.select_node(up_node);\n            }\n            evt.stopPropagation();\n            evt.preventDefault();\n        }\n    }\n    handle_down(_jm, e) {\n        var evt = e || event;\n        var selected_node = _jm.get_selected_node();\n        if (!!selected_node) {\n            var down_node = _jm.find_node_after(selected_node);\n            if (!down_node) {\n                var np = _jm.find_node_after(selected_node.parent);\n                if (!!np && np.children.length > 0) {\n                    down_node = np.children[0];\n                }\n            }\n            if (!!down_node) {\n                _jm.select_node(down_node);\n            }\n            evt.stopPropagation();\n            evt.preventDefault();\n        }\n    }\n    handle_left(_jm, e) {\n        this._handle_direction(_jm, e, Direction.left);\n    }\n    handle_right(_jm, e) {\n        this._handle_direction(_jm, e, Direction.right);\n    }\n    _handle_direction(_jm, e, d) {\n        var evt = e || event;\n        var selected_node = _jm.get_selected_node();\n        var node = null;\n        if (!!selected_node) {\n            if (selected_node.isroot) {\n                var c = selected_node.children;\n                var children = [];\n                for (var i = 0; i < c.length; i++) {\n                    if (c[i].direction === d) {\n                        children.push(i);\n                    }\n                }\n                node = c[children[Math.floor((children.length - 1) / 2)]];\n            }\n            else if (selected_node.direction === d) {\n                var children = selected_node.children;\n                var childrencount = children.length;\n                if (childrencount > 0) {\n                    node = children[Math.floor((childrencount - 1) / 2)];\n                }\n            } else {\n                node = selected_node.parent;\n            }\n            if (!!node) {\n                _jm.select_node(node);\n            }\n            evt.stopPropagation();\n            evt.preventDefault();\n        }\n    }\n}\n\n\n","/**\n * @license BSD\n * @copyright 2014-2022 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\n\nimport { $ } from \"./jsmind.dom.js\";\n\nconst plugin_data = {\n    plugins: []\n}\n\nexport function register(plugin) {\n    if (!plugin instanceof Plugin) {\n        throw new Error('plugin ' + plugin + ' is not a supported plugin')\n    }\n    plugin_data.plugins.push(plugin);\n}\n\nexport function apply(jm) {\n    $.w.setTimeout(function () {\n        _apply(jm);\n    }, 0);\n}\n\nfunction _apply(jm) {\n    var l = plugin_data.plugins.length;\n    var fn_init = null;\n    for (var i = 0; i < l; i++) {\n        fn_init = plugin_data.plugins[i].init;\n        if (typeof fn_init === 'function') {\n            fn_init(jm);\n        }\n    }\n}\n\nexport class Plugin {\n    constructor(name, init) {\n        this.name = name;\n        this.init = init;\n    }\n}\n","/**\n * @license BSD\n * @copyright 2014-2022 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\n\nimport { __version__, logger, EventType, Direction } from \"./jsmind.common.js\";\nimport { merge_option } from \"./jsmind.option.js\";\nimport { Mind } from \"./jsmind.mind.js\";\nimport { Node } from \"./jsmind.node.js\";\nimport { DataProvider } from \"./jsmind.data_provider.js\";\nimport { LayoutProvider } from \"./jsmind.layout_provider.js\";\nimport { ViewProvider } from \"./jsmind.view_provider.js\";\nimport { ShortcutProvider } from \"./jsmind.shortcut_provider.js\";\nimport { Plugin, register as _register_plugin, apply as apply_plugins } from \"./jsmind.plugin.js\";\nimport { format } from \"./jsmind.format.js\";\nimport { $ } from \"./jsmind.dom.js\";\nimport { util as _util } from \"./jsmind.util.js\"\n\n\nclass jm {\n    static mind = Mind;\n    static node = Node;\n    static direction = Direction;\n    static event_type = EventType;\n    static $ = $;\n    static plugin = Plugin\n    static register_plugin = _register_plugin\n    static util = _util\n\n    constructor(options) {\n        jm.current = this;\n        this.version = __version__;\n        this.initialized = false;\n        this.mind = null;\n        this.event_handles = [];\n        this.options = merge_option(options);\n        this.init();\n    }\n\n    init() {\n        if (!!this.initialized) { return; }\n        this.initialized = true;\n        var opts_layout = {\n            mode: this.options.mode,\n            hspace: this.options.layout.hspace,\n            vspace: this.options.layout.vspace,\n            pspace: this.options.layout.pspace\n        };\n        var opts_view = {\n            container: this.options.container,\n            support_html: this.options.support_html,\n            engine: this.options.view.engine,\n            hmargin: this.options.view.hmargin,\n            vmargin: this.options.view.vmargin,\n            line_width: this.options.view.line_width,\n            line_color: this.options.view.line_color,\n            draggable: this.options.view.draggable,\n            hide_scrollbars_when_draggable: this.options.view.hide_scrollbars_when_draggable\n        };\n        // create instance of function provider\n        this.data = new DataProvider(this);\n        this.layout = new LayoutProvider(this, opts_layout);\n        this.view = new ViewProvider(this, opts_view);\n        this.shortcut = new ShortcutProvider(this, this.options.shortcut);\n\n        this.data.init();\n        this.layout.init();\n        this.view.init();\n        this.shortcut.init();\n\n        this._event_bind();\n\n        apply_plugins(this);\n    }\n    enable_edit() {\n        this.options.editable = true;\n    }\n    disable_edit() {\n        this.options.editable = false;\n    }\n    // call enable_event_handle('dblclick')\n    // options are 'mousedown', 'click', 'dblclick'\n    enable_event_handle(event_handle) {\n        this.options.default_event_handle['enable_' + event_handle + '_handle'] = true;\n    }\n    // call disable_event_handle('dblclick')\n    // options are 'mousedown', 'click', 'dblclick'\n    disable_event_handle(event_handle) {\n        this.options.default_event_handle['enable_' + event_handle + '_handle'] = false;\n    }\n    get_editable() {\n        return this.options.editable;\n    }\n    set_theme(theme) {\n        var theme_old = this.options.theme;\n        this.options.theme = (!!theme) ? theme : null;\n        if (theme_old != this.options.theme) {\n            this.view.reset_theme();\n            this.view.reset_custom_style();\n        }\n    }\n    _event_bind() {\n        this.view.add_event(this, 'mousedown', this.mousedown_handle);\n        this.view.add_event(this, 'click', this.click_handle);\n        this.view.add_event(this, 'dblclick', this.dblclick_handle);\n        this.view.add_event(this, \"mousewheel\", this.mousewheel_handle);\n    }\n    mousedown_handle(e) {\n        if (!this.options.default_event_handle['enable_mousedown_handle']) {\n            return;\n        }\n        var element = e.target || event.srcElement;\n        var nodeid = this.view.get_binded_nodeid(element);\n        if (!!nodeid) {\n            if (element.tagName.toLowerCase() == 'jmnode') {\n                this.select_node(nodeid);\n            }\n        } else {\n            this.select_clear();\n        }\n    }\n    click_handle(e) {\n        if (!this.options.default_event_handle['enable_click_handle']) {\n            return;\n        }\n        var element = e.target || event.srcElement;\n        var isexpander = this.view.is_expander(element);\n        if (isexpander) {\n            var nodeid = this.view.get_binded_nodeid(element);\n            if (!!nodeid) {\n                this.toggle_node(nodeid);\n            }\n        }\n    }\n    dblclick_handle(e) {\n        if (!this.options.default_event_handle['enable_dblclick_handle']) {\n            return;\n        }\n        if (this.get_editable()) {\n            var element = e.target || event.srcElement;\n            var nodeid = this.view.get_binded_nodeid(element);\n            if (!!nodeid) {\n                this.begin_edit(nodeid);\n            }\n        }\n    }\n    // Use [Ctrl] + Mousewheel, to zoom in/out.\n    mousewheel_handle(event) {\n        // Test if mousewheel option is enabled and Ctrl key is pressed.\n        if (!this.options.default_event_handle[\"enable_mousewheel_handle\"] || !window.event.ctrlKey) {\n            return;\n        }\n        // Avoid default page scrolling behavior.\n        event.preventDefault();\n\n        var dir = event.deltaY > 0 ? \"Up\" : \"Down\";\n        if (dir == \"Up\") {\n            this.view.zoomIn();\n        } else {\n            this.view.zoomOut();\n        }\n    }\n    begin_edit(node) {\n        if (!Node.is_node(node)) {\n            var the_node = this.get_node(node);\n            if (!the_node) {\n                logger.error('the node[id=' + node + '] can not be found.');\n                return false;\n            } else {\n                return this.begin_edit(the_node);\n            }\n        }\n        if (this.get_editable()) {\n            this.view.edit_node_begin(node);\n        } else {\n            logger.error('fail, this mind map is not editable.');\n            return;\n        }\n    }\n    end_edit() {\n        this.view.edit_node_end();\n    }\n    toggle_node(node) {\n        if (!Node.is_node(node)) {\n            var the_node = this.get_node(node);\n            if (!the_node) {\n                logger.error('the node[id=' + node + '] can not be found.');\n                return;\n            } else {\n                return this.toggle_node(the_node);\n            }\n        }\n        if (node.isroot) { return; }\n        this.view.save_location(node);\n        this.layout.toggle_node(node);\n        this.view.relayout();\n        this.view.restore_location(node);\n    }\n    expand_node(node) {\n        if (!Node.is_node(node)) {\n            var the_node = this.get_node(node);\n            if (!the_node) {\n                logger.error('the node[id=' + node + '] can not be found.');\n                return;\n            } else {\n                return this.expand_node(the_node);\n            }\n        }\n        if (node.isroot) { return; }\n        this.view.save_location(node);\n        this.layout.expand_node(node);\n        this.view.relayout();\n        this.view.restore_location(node);\n    }\n    collapse_node(node) {\n        if (!Node.is_node(node)) {\n            var the_node = this.get_node(node);\n            if (!the_node) {\n                logger.error('the node[id=' + node + '] can not be found.');\n                return;\n            } else {\n                return this.collapse_node(the_node);\n            }\n        }\n        if (node.isroot) { return; }\n        this.view.save_location(node);\n        this.layout.collapse_node(node);\n        this.view.relayout();\n        this.view.restore_location(node);\n    }\n    expand_all() {\n        this.layout.expand_all();\n        this.view.relayout();\n    }\n    collapse_all() {\n        this.layout.collapse_all();\n        this.view.relayout();\n    }\n    expand_to_depth(depth) {\n        this.layout.expand_to_depth(depth);\n        this.view.relayout();\n    }\n    _reset() {\n        this.view.reset();\n        this.layout.reset();\n        this.data.reset();\n    }\n    _show(mind) {\n        var m = mind || format.node_array.example;\n\n        this.mind = this.data.load(m);\n        if (!this.mind) {\n            logger.error('data.load error');\n            return;\n        } else {\n            logger.debug('data.load ok');\n        }\n\n        this.view.load();\n        logger.debug('view.load ok');\n\n        this.layout.layout();\n        logger.debug('layout.layout ok');\n\n        this.view.show(true);\n        logger.debug('view.show ok');\n\n        this.invoke_event_handle(EventType.show, { data: [mind] });\n    }\n    show(mind) {\n        this._reset();\n        this._show(mind);\n    }\n    get_meta() {\n        return {\n            name: this.mind.name,\n            author: this.mind.author,\n            version: this.mind.version\n        };\n    }\n    get_data(data_format) {\n        var df = data_format || 'node_tree';\n        return this.data.get_data(df);\n    }\n    get_root() {\n        return this.mind.root;\n    }\n    get_node(node) {\n        if (Node.is_node(node)) {\n            return node;\n        }\n        return this.mind.get_node(node);\n    }\n    add_node(parent_node, nodeid, topic, data) {\n        if (this.get_editable()) {\n            var the_parent_node = this.get_node(parent_node);\n            var direction = this.layout.calculate_next_child_direction(the_parent_node);\n            var node = this.mind.add_node(the_parent_node, nodeid, topic, data, direction);\n            if (!!node) {\n                this.view.add_node(node);\n                this.layout.layout();\n                this.view.show(false);\n                this.view.reset_node_custom_style(node);\n                this.expand_node(the_parent_node);\n                this.invoke_event_handle(EventType.edit, { evt: 'add_node', data: [the_parent_node.id, nodeid, topic, data], node: nodeid });\n            }\n            return node;\n        } else {\n            logger.error('fail, this mind map is not editable');\n            return null;\n        }\n    }\n    insert_node_before(node_before, nodeid, topic, data) {\n        if (this.get_editable()) {\n            var the_node_before = this.get_node(node_before);\n            var direction = this.layout.calculate_next_child_direction(the_node_before.parent);\n            var node = this.mind.insert_node_before(the_node_before, nodeid, topic, data, direction);\n            if (!!node) {\n                this.view.add_node(node);\n                this.layout.layout();\n                this.view.show(false);\n                this.invoke_event_handle(EventType.edit, { evt: 'insert_node_before', data: [the_node_before.id, nodeid, topic, data], node: nodeid });\n            }\n            return node;\n        } else {\n            logger.error('fail, this mind map is not editable');\n            return null;\n        }\n    }\n    insert_node_after(node_after, nodeid, topic, data) {\n        if (this.get_editable()) {\n            var the_node_after = this.get_node(node_after);\n            var direction = this.layout.calculate_next_child_direction(the_node_after.parent);\n            var node = this.mind.insert_node_after(the_node_after, nodeid, topic, data, direction);\n            if (!!node) {\n                this.view.add_node(node);\n                this.layout.layout();\n                this.view.show(false);\n                this.invoke_event_handle(EventType.edit, { evt: 'insert_node_after', data: [the_node_after.id, nodeid, topic, data], node: nodeid });\n            }\n            return node;\n        } else {\n            logger.error('fail, this mind map is not editable');\n            return null;\n        }\n    }\n    remove_node(node) {\n        if (!Node.is_node(node)) {\n            var the_node = this.get_node(node);\n            if (!the_node) {\n                logger.error('the node[id=' + node + '] can not be found.');\n                return false;\n            } else {\n                return this.remove_node(the_node);\n            }\n        }\n        if (this.get_editable()) {\n            if (node.isroot) {\n                logger.error('fail, can not remove root node');\n                return false;\n            }\n            var nodeid = node.id;\n            var parentid = node.parent.id;\n            var parent_node = this.get_node(parentid);\n            this.view.save_location(parent_node);\n            this.view.remove_node(node);\n            this.mind.remove_node(node);\n            this.layout.layout();\n            this.view.show(false);\n            this.view.restore_location(parent_node);\n            this.invoke_event_handle(EventType.edit, { evt: 'remove_node', data: [nodeid], node: parentid });\n            return true;\n        } else {\n            logger.error('fail, this mind map is not editable');\n            return false;\n        }\n    }\n    update_node(nodeid, topic) {\n        if (this.get_editable()) {\n            if (_util.text.is_empty(topic)) {\n                logger.warn('fail, topic can not be empty');\n                return;\n            }\n            var node = this.get_node(nodeid);\n            if (!!node) {\n                if (node.topic === topic) {\n                    logger.info('nothing changed');\n                    this.view.update_node(node);\n                    return;\n                }\n                node.topic = topic;\n                this.view.update_node(node);\n                this.layout.layout();\n                this.view.show(false);\n                this.invoke_event_handle(EventType.edit, { evt: 'update_node', data: [nodeid, topic], node: nodeid });\n            }\n        } else {\n            logger.error('fail, this mind map is not editable');\n            return;\n        }\n    }\n    move_node(nodeid, beforeid, parentid, direction) {\n        if (this.get_editable()) {\n            var node = this.get_node(nodeid);\n            var updated_node = this.mind.move_node(node, beforeid, parentid, direction);\n            if (!!updated_node) {\n                this.view.update_node(updated_node);\n                this.layout.layout();\n                this.view.show(false);\n                this.invoke_event_handle(EventType.edit, { evt: 'move_node', data: [nodeid, beforeid, parentid, direction], node: nodeid });\n            }\n        } else {\n            logger.error('fail, this mind map is not editable');\n            return;\n        }\n    }\n    select_node(node) {\n        if (!Node.is_node(node)) {\n            var the_node = this.get_node(node);\n            if (!the_node) {\n                logger.error('the node[id=' + node + '] can not be found.');\n                return;\n            } else {\n                return this.select_node(the_node);\n            }\n        }\n        if (!this.layout.is_visible(node)) {\n            return;\n        }\n        this.mind.selected = node;\n        this.view.select_node(node);\n        this.invoke_event_handle(EventType.select, { evt: 'select_node', data: [], node: node.id });\n    }\n    get_selected_node() {\n        if (!!this.mind) {\n            return this.mind.selected;\n        } else {\n            return null;\n        }\n    }\n    select_clear() {\n        if (!!this.mind) {\n            this.mind.selected = null;\n            this.view.select_clear();\n        }\n    }\n    is_node_visible(node) {\n        return this.layout.is_visible(node);\n    }\n    find_node_before(node) {\n        if (!Node.is_node(node)) {\n            var the_node = this.get_node(node);\n            if (!the_node) {\n                logger.error('the node[id=' + node + '] can not be found.');\n                return;\n            } else {\n                return this.find_node_before(the_node);\n            }\n        }\n        if (node.isroot) { return null; }\n        var n = null;\n        if (node.parent.isroot) {\n            var c = node.parent.children;\n            var prev = null;\n            var ni = null;\n            for (var i = 0; i < c.length; i++) {\n                ni = c[i];\n                if (node.direction === ni.direction) {\n                    if (node.id === ni.id) {\n                        n = prev;\n                    }\n                    prev = ni;\n                }\n            }\n        } else {\n            n = this.mind.get_node_before(node);\n        }\n        return n;\n    }\n    find_node_after(node) {\n        if (!Node.is_node(node)) {\n            var the_node = this.get_node(node);\n            if (!the_node) {\n                logger.error('the node[id=' + node + '] can not be found.');\n                return;\n            } else {\n                return this.find_node_after(the_node);\n            }\n        }\n        if (node.isroot) { return null; }\n        var n = null;\n        if (node.parent.isroot) {\n            var c = node.parent.children;\n            var getthis = false;\n            var ni = null;\n            for (var i = 0; i < c.length; i++) {\n                ni = c[i];\n                if (node.direction === ni.direction) {\n                    if (getthis) {\n                        n = ni;\n                        break;\n                    }\n                    if (node.id === ni.id) {\n                        getthis = true;\n                    }\n                }\n            }\n        } else {\n            n = this.mind.get_node_after(node);\n        }\n        return n;\n    }\n    set_node_color(nodeid, bgcolor, fgcolor) {\n        if (this.get_editable()) {\n            var node = this.mind.get_node(nodeid);\n            if (!!node) {\n                if (!!bgcolor) {\n                    node.data['background-color'] = bgcolor;\n                }\n                if (!!fgcolor) {\n                    node.data['foreground-color'] = fgcolor;\n                }\n                this.view.reset_node_custom_style(node);\n            }\n        } else {\n            logger.error('fail, this mind map is not editable');\n            return null;\n        }\n    }\n    set_node_font_style(nodeid, size, weight, style) {\n        if (this.get_editable()) {\n            var node = this.mind.get_node(nodeid);\n            if (!!node) {\n                if (!!size) {\n                    node.data['font-size'] = size;\n                }\n                if (!!weight) {\n                    node.data['font-weight'] = weight;\n                }\n                if (!!style) {\n                    node.data['font-style'] = style;\n                }\n                this.view.reset_node_custom_style(node);\n                this.view.update_node(node);\n                this.layout.layout();\n                this.view.show(false);\n            }\n        } else {\n            logger.error('fail, this mind map is not editable');\n            return null;\n        }\n    }\n    set_node_background_image(nodeid, image, width, height, rotation) {\n        if (this.get_editable()) {\n            var node = this.mind.get_node(nodeid);\n            if (!!node) {\n                if (!!image) {\n                    node.data['background-image'] = image;\n                }\n                if (!!width) {\n                    node.data['width'] = width;\n                }\n                if (!!height) {\n                    node.data['height'] = height;\n                }\n                if (!!rotation) {\n                    node.data['background-rotation'] = rotation;\n                }\n                this.view.reset_node_custom_style(node);\n                this.view.update_node(node);\n                this.layout.layout();\n                this.view.show(false);\n            }\n        } else {\n            logger.error('fail, this mind map is not editable');\n            return null;\n        }\n    }\n    set_node_background_rotation(nodeid, rotation) {\n        if (this.get_editable()) {\n            var node = this.mind.get_node(nodeid);\n            if (!!node) {\n                if (!node.data['background-image']) {\n                    logger.error('fail, only can change rotation angle of node with background image');\n                    return null;\n                }\n                node.data['background-rotation'] = rotation;\n                this.view.reset_node_custom_style(node);\n                this.view.update_node(node);\n                this.layout.layout();\n                this.view.show(false);\n            }\n        } else {\n            logger.error('fail, this mind map is not editable');\n            return null;\n        }\n    }\n    resize() {\n        this.view.resize();\n    }\n    // callback(type ,data)\n    add_event_listener(callback) {\n        if (typeof callback === 'function') {\n            this.event_handles.push(callback);\n        }\n    }\n    clear_event_listener() {\n        this.event_handles = [];\n    }\n    invoke_event_handle(type, data) {\n        var j = this;\n        $.w.setTimeout(function () {\n            j._invoke_event_handle(type, data);\n        }, 0);\n    }\n    _invoke_event_handle(type, data) {\n        var l = this.event_handles.length;\n        for (var i = 0; i < l; i++) {\n            this.event_handles[i](type, data);\n        }\n    }\n\n    // quick way\n    static show(options, mind) {\n        var _jm = new jm(options);\n        _jm.show(mind);\n        return _jm;\n    }\n}\n\nexport default jm;\n"],"names":["__version__","__author__","String","prototype","startsWith","p","this","slice","length","_noop","logger","console","log","debug","error","warn","info","Direction","left","center","right","EventType","show","resize","edit","select","$","constructor","w","d","document","g","id","getElementById","c","tag","createElement","t","n","hasChildNodes","firstChild","nodeValue","appendChild","createTextNode","h","HTMLElement","innerHTML","i","el","nodeType","style","ownerDocument","on","e","addEventListener","attachEvent","window","util","ajax","_xhr","xhr","XMLHttpRequest","ActiveXObject","_eurl","url","encodeURIComponent","request","param","method","callback","fail_callback","a","tmp_param","k","push","join","onreadystatechange","readyState","status","data","json","string2json","responseText","open","setRequestHeader","send","get","post","file","read","file_data","fn_callback","reader","FileReader","onload","result","name","readAsText","save","type","blob","Blob","bb","BlobBuilder","MozBlobBuilder","WebKitBlobBuilder","MSBlobBuilder","append","getBlob","navigator","msSaveBlob","bloburl","URL","webkitURL","createObjectURL","anchor","visibility","href","download","body","evt","createEvent","initEvent","dispatchEvent","removeChild","location","json2string","JSON","stringify","json_str","parse","merge","b","o","Object","toString","call","toLowerCase","uuid","newid","Date","getTime","Math","random","substr","text","is_empty","s","replace","default_options","container","editable","theme","mode","support_html","view","engine","hmargin","vmargin","line_width","line_color","draggable","hide_scrollbars_when_draggable","layout","hspace","vspace","pspace","default_event_handle","enable_mousedown_handle","enable_click_handle","enable_dblclick_handle","enable_mousewheel_handle","shortcut","enable","handles","mapping","addchild","addbrother","editnode","delnode","toggle","up","down","Node","sId","iIndex","sTopic","oData","bIsRoot","oParent","eDirection","bExpanded","index","topic","isroot","parent","direction","expanded","children","_data","get_location","vd","x","abs_x","y","abs_y","get_size","width","height","static","node1","node2","i1","i2","pnode","node","pid","Mind","author","version","root","selected","nodes","get_node","nodeid","set_root","_put_node","add_node","parent_node","idx","is_node","_reindex","insert_node_before","node_before","node_index","get_node_before","the_node","insert_node_after","node_after","get_node_after","move_node","before_id","parent_id","_move_node","_flow_node_direction","len","_move_node_internal","beforeid","parentid","inherited","sibling","si","splice","remove_node","ci","sort","compare","format","node_tree","example","meta","get_mind","source","df","mind","_parse","get_data","_buildnode","node_root","_extract_data","_extract_subnode","node_json","node_parent","node_data","node_array","_array","narray","reverse","root_node","_extract_root","root_json","extract_count","node_direction","sub_extract_count","_array_node","freemind","xml","xml_doc","_parse_xml","xml_root","_find_root","_load_node","xmllines","_buildmap","DOMParser","parseFromString","async","loadXML","childNodes","tagName","ns","xml_node","node_id","getAttribute","node_topic","topic_children","topic_child","textContent","_load_attributes","node_expanded","node_position","child","attr","attr_data","pos","DataProvider","jm","init","reset","load","mind_data","data_format","LayoutProvider","options","opts","isside","bounds","cache_valid","calculate_next_child_direction","children_len","r","layout_direction","layout_offset","_layout_direction_root","layout_data","children_count","side_index","_layout_direction_side","subnode","offset_x","offset_y","outer_height","left_nodes","right_nodes","unshift","outer_height_left","_layout_offset_subnodes","outer_height_right","max","total_height","nodes_count","node_outer_height","base_y","pd","set_visible","middle_height","_layout_offset_subnodes_height","get_node_offset","offset_cache","_offset_","offset_p","get_node_point","view_data","get_node_point_in","get_node_point_out","pout_cache","_pout_","get_expander_point","ex_p","ceil","get_min_size","pout","toggle_node","collapse_node","expand_node","part_layout","invoke_event_handle","expand_all","collapse_all","expand_to_depth","target_depth","curr_nodes","curr_depth","depth","root_layout_data","visible","is_expand","is_visible","graph_svg","e_svg","setAttribute","size","lines","createElementNS","element","set_size","clear","draw_line","pin","offset","line","_bezier_to","copy_to","dest_canvas_ctx","img","Image","drawImage","src","btoa","XMLSerializer","serializeToString","path","x1","y1","x2","y2","_line_to","graph","svg","canvas","e_canvas","className","canvas_ctx","getContext","clearRect","ctx","strokeStyle","lineWidth","lineCap","beginPath","moveTo","bezierCurveTo","stroke","lineTo","ViewProvider","e_panel","e_nodes","selected_node","editing_node","e_editor","tabIndex","actualZoom","zoomStep","minZoom","maxZoom","v","event","keyCode","edit_node_end","stopPropagation","enable_draggable_canvas","add_event","obj","event_name","event_handle","get_binded_nodeid","parentElement","is_expander","clear_lines","clear_nodes","reset_theme","theme_name","reset_custom_style","reset_node_custom_style","init_nodes","expand_size","min_size","min_width","min_height","client_w","clientWidth","client_h","clientHeight","init_nodes_size","doc_frag","createDocumentFragment","create_node_element","d_e","expander","_reset_node_custom_style","update_node","select_node","clear_node_custom_style","select_clear","get_editing_node","is_editing","edit_node_begin","ncs","getComputedStyle","value","parseInt","getPropertyValue","zIndex","focus","get_view_offset","_show","show_nodes","show_lines","zoomIn","setZoom","zoomOut","zoom","transform","_center_root","outer_w","outer_h","_offset","scrollLeft","scrollTop","keep_center","relayout","save_location","_saved_location","top","restore_location","node_element","p_expander","expander_text","display","backgroundColor","color","fontSize","fontWeight","fontStyle","backgroundImage","scaledImageData","toDataURL","backgroundSize","dragging","eventDown","clientX","clientY","eventMove","scrollBy","ShortcutProvider","_newid","_mapping","handle","handler","bind","handle_addchild","handle_addbrother","handle_editnode","handle_delnode","handle_toggle","handle_up","handle_down","handle_left","handle_right","id_generator","enable_shortcut","disable_shortcut","which","preventDefault","kc","metaKey","ctrlKey","altKey","shiftKey","_jm","get_selected_node","begin_edit","up_node","find_node_before","np","down_node","find_node_after","_handle_direction","floor","childrencount","plugin_data","plugins","register","plugin","Plugin","Error","apply","setTimeout","l","fn_init","_apply","_register_plugin","_util","current","initialized","event_handles","merge_option","opts_layout","opts_view","_event_bind","apply_plugins","enable_edit","disable_edit","enable_event_handle","disable_event_handle","get_editable","set_theme","theme_old","mousedown_handle","click_handle","dblclick_handle","mousewheel_handle","target","srcElement","deltaY","end_edit","_reset","m","get_meta","get_root","the_parent_node","the_node_before","the_node_after","updated_node","is_node_visible","prev","ni","getthis","set_node_color","bgcolor","fgcolor","set_node_font_style","weight","set_node_background_image","image","rotation","set_node_background_rotation","add_event_listener","clear_event_listener","j","_invoke_event_handle"],"mappings":"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"}