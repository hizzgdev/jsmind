<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Test Batch Add Nodes</title>
        <link type="text/css" rel="stylesheet" href="../style/jsmind.css" />
        <style type="text/css">
            #jsmind_container {
                width: 100%;
                height: 500px;
                border: solid 1px #ccc;
                background: #f4f4f4;
            }
            .controls {
                margin: 20px 0;
            }
            button {
                margin: 5px;
                padding: 10px 15px;
                font-size: 14px;
            }
            .info {
                margin: 10px 0;
                padding: 10px;
                background: #e8f4f8;
                border-radius: 4px;
            }
        </style>
    </head>
    <body>
        <h1>Test Batch Add Nodes Function</h1>

        <div class="info">
            <p><strong>Instructions:</strong></p>
            <ol>
                <li>Select a node by clicking on it</li>
                <li>Click "Batch Add Nodes" to add 10 nodes with 2 sub-nodes</li>
                <li>Check the console for performance information</li>
            </ol>
        </div>

        <div class="controls">
            <button onclick="testBatchAdd()">Batch Add Nodes</button>
            <button onclick="clearMindMap()">Reset Mind Map</button>
            <button onclick="showSelectedNode()">Show Selected Node</button>
        </div>

        <div id="result-info" class="info" style="background: #f0f8f0">
            Ready to test batch add functionality...
        </div>

        <div id="jsmind_container"></div>

        <script type="text/javascript" src="../js-legacy/jsmind.js"></script>
        <script type="text/javascript">
            var mind = {
                meta: {
                    name: 'Batch Add Test',
                    author: 'jsMind',
                    version: '0.2',
                },
                format: 'node_tree',
                data: {
                    id: 'root',
                    topic: 'Root Node',
                    children: [
                        {
                            id: 'node1',
                            topic: 'Node 1',
                            direction: 'right',
                        },
                        {
                            id: 'node2',
                            topic: 'Node 2',
                            direction: 'left',
                        },
                    ],
                },
            };

            var options = {
                container: 'jsmind_container',
                editable: true,
                theme: 'orange',
            };

            var jm = new jsMind(options);
            jm.show(mind);

            function testBatchAdd() {
                var selected_node = jm.get_selected_node();
                if (!selected_node) {
                    updateResult('Please select a node first!', 'error');
                    return;
                }

                // Check if add_nodes method exists
                if (typeof jm.add_nodes !== 'function') {
                    updateResult(
                        'Error: add_nodes method not found! Make sure you are using the updated jsmind.js file.',
                        'error'
                    );
                    return;
                }

                var timestamp = Date.now();
                var nodes_data = [];

                // Create 10 main nodes
                for (var i = 0; i < 10; i++) {
                    nodes_data.push({
                        node_id: 'batch_' + timestamp + '_' + i,
                        topic: 'Batch Node ' + (i + 1),
                        data: {
                            'index': i,
                            'background-color': i % 2 === 0 ? '#e8f4f8' : '#f8e8e8',
                        },
                        direction: i % 2 === 0 ? 'right' : 'left',
                    });
                }

                // Measure performance
                var start_time = performance.now();
                var created_nodes = jm.add_nodes(selected_node, nodes_data);
                var end_time = performance.now();

                var success_count = created_nodes.filter(node => node !== null).length;
                var duration = (end_time - start_time).toFixed(2);

                updateResult(
                    'Successfully added ' + success_count + ' nodes in ' + duration + ' ms',
                    'success'
                );

                // Add sub-nodes to the first created node as a second batch
                if (created_nodes.length > 0 && created_nodes[0] !== null) {
                    var sub_nodes_data = [
                        {
                            node_id: 'sub_' + timestamp + '_1',
                            topic: 'Sub Node 1',
                        },
                        {
                            node_id: 'sub_' + timestamp + '_2',
                            topic: 'Sub Node 2',
                        },
                    ];

                    var sub_created_nodes = jm.add_nodes(created_nodes[0], sub_nodes_data);
                    var sub_success_count = sub_created_nodes.filter(node => node !== null).length;

                    if (sub_success_count > 0) {
                        updateResult(
                            'Successfully added ' +
                                success_count +
                                ' main nodes and ' +
                                sub_success_count +
                                ' sub-nodes in ' +
                                duration +
                                ' ms',
                            'success'
                        );
                    }
                }

                console.log('Batch add performance:', duration + ' ms');
                console.log('Created nodes:', created_nodes);
            }

            function clearMindMap() {
                jm.show(mind);
                updateResult('Mind map has been reset to initial state.', 'info');
            }

            function showSelectedNode() {
                var selected_node = jm.get_selected_node();
                if (selected_node) {
                    updateResult(
                        'Selected node: ' + selected_node.topic + ' (ID: ' + selected_node.id + ')',
                        'info'
                    );
                } else {
                    updateResult('No node is currently selected.', 'info');
                }
            }

            function updateResult(message, type) {
                var resultDiv = document.getElementById('result-info');
                resultDiv.innerHTML = message;

                // Change background color based on type
                switch (type) {
                    case 'success':
                        resultDiv.style.background = '#d4edda';
                        break;
                    case 'error':
                        resultDiv.style.background = '#f8d7da';
                        break;
                    case 'info':
                        resultDiv.style.background = '#d1ecf1';
                        break;
                    default:
                        resultDiv.style.background = '#f0f8f0';
                }
            }

            // Auto-select root node on load
            setTimeout(function () {
                jm.select_node('root');
                updateResult('Root node selected. Ready to test batch add!', 'info');
            }, 500);
        </script>
    </body>
</html>
