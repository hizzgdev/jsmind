{"version":3,"file":"jsmind.screenshot.js","sources":["../src/plugins/jsmind.screenshot.js"],"sourcesContent":["/**\n * @license BSD\n * @copyright 2014-2022 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\n\nif (!jsMind) {\n    throw new Error('jsMind is not defined');\n}\n\nconst $ = jsMind.$;\n\nvar css = function (cStyle, property_name) {\n    return cStyle.getPropertyValue(property_name);\n};\nvar is_visible = function (cStyle) {\n    var visibility = css(cStyle, 'visibility');\n    var display = css(cStyle, 'display');\n    return visibility !== 'hidden' && display !== 'none';\n};\nvar jcanvas = {};\njcanvas.rect = function (ctx, x, y, w, h, r) {\n    if (w < 2 * r) r = w / 2;\n    if (h < 2 * r) r = h / 2;\n    ctx.moveTo(x + r, y);\n    ctx.arcTo(x + w, y, x + w, y + h, r);\n    ctx.arcTo(x + w, y + h, x, y + h, r);\n    ctx.arcTo(x, y + h, x, y, r);\n    ctx.arcTo(x, y, x + w, y, r);\n};\n\njcanvas.text_multiline = function (ctx, text, x, y, w, h, lineheight) {\n    var line = '';\n    var text_len = text.length;\n    var chars = text.split('');\n    var test_line = null;\n    ctx.textAlign = 'left';\n    ctx.textBaseline = 'top';\n    for (var i = 0; i < text_len; i++) {\n        test_line = line + chars[i];\n        if (ctx.measureText(test_line).width > w && i > 0) {\n            ctx.fillText(line, x, y);\n            line = chars[i];\n            y += lineheight;\n        } else {\n            line = test_line;\n        }\n    }\n    ctx.fillText(line, x, y);\n};\n\njcanvas.text_ellipsis = function (ctx, text, x, y, w, h) {\n    var center_y = y + h / 2;\n    var text = jcanvas.fittingString(ctx, text, w);\n    ctx.textAlign = 'left';\n    ctx.textBaseline = 'middle';\n    ctx.fillText(text, x, center_y, w);\n};\n\njcanvas.fittingString = function (ctx, text, max_width) {\n    var width = ctx.measureText(text).width;\n    var ellipsis = 'â€¦';\n    var ellipsis_width = ctx.measureText(ellipsis).width;\n    if (width <= max_width || width <= ellipsis_width) {\n        return text;\n    } else {\n        var len = text.length;\n        while (width >= max_width - ellipsis_width && len-- > 0) {\n            text = text.substring(0, len);\n            width = ctx.measureText(text).width;\n        }\n        return text + ellipsis;\n    }\n};\n\njcanvas.image = function (ctx, url, x, y, w, h, r, rotation, callback) {\n    var img = new Image();\n    img.onload = function () {\n        ctx.save();\n        ctx.translate(x, y);\n        ctx.save();\n        ctx.beginPath();\n        jcanvas.rect(ctx, 0, 0, w, h, r);\n        ctx.closePath();\n        ctx.clip();\n        ctx.translate(w / 2, h / 2);\n        ctx.rotate((rotation * Math.PI) / 180);\n        ctx.drawImage(img, -w / 2, -h / 2);\n        ctx.restore();\n        ctx.restore();\n        !!callback && callback();\n    };\n    img.src = url;\n};\n\nclass screenshot {\n    constructor(jm) {\n        this.jm = jm;\n        this.canvas_elem = null;\n        this.canvas_ctx = null;\n        this._inited = false;\n    }\n    init() {\n        if (this._inited) {\n            return;\n        }\n        console.log('init');\n        var c = $.c('canvas');\n        var ctx = c.getContext('2d');\n\n        this.canvas_elem = c;\n        this.canvas_ctx = ctx;\n        this.jm.view.e_panel.appendChild(c);\n        this._inited = true;\n        this.resize();\n    }\n    shoot(callback) {\n        this.init();\n        this._draw(\n            function () {\n                !!callback && callback();\n                this.clean();\n            }.bind(this)\n        );\n        this._watermark();\n    }\n    shootDownload() {\n        this.shoot(\n            function () {\n                this._download();\n            }.bind(this)\n        );\n    }\n    shootAsDataURL(callback) {\n        this.shoot(\n            function () {\n                !!callback && callback(this.canvas_elem.toDataURL());\n            }.bind(this)\n        );\n    }\n    resize() {\n        if (this._inited) {\n            this.canvas_elem.width = this.jm.view.size.w;\n            this.canvas_elem.height = this.jm.view.size.h;\n        }\n    }\n    clean() {\n        var c = this.canvas_elem;\n        this.canvas_ctx.clearRect(0, 0, c.width, c.height);\n    }\n    _draw(callback) {\n        var ctx = this.canvas_ctx;\n        ctx.textAlign = 'left';\n        ctx.textBaseline = 'top';\n        this._draw_lines(\n            function () {\n                this._draw_nodes(callback);\n            }.bind(this)\n        );\n    }\n    _watermark() {\n        var c = this.canvas_elem;\n        var ctx = this.canvas_ctx;\n        ctx.textAlign = 'right';\n        ctx.textBaseline = 'bottom';\n        ctx.fillStyle = '#000';\n        ctx.font = '11px Verdana,Arial,Helvetica,sans-serif';\n        ctx.fillText('hizzgdev.github.io/jsmind', c.width - 5.5, c.height - 2.5);\n        ctx.textAlign = 'left';\n        ctx.fillText($.w.location, 5.5, c.height - 2.5);\n    }\n    _draw_lines(callback) {\n        this.jm.view.graph.copy_to(this.canvas_ctx, callback);\n    }\n    _draw_nodes(callback) {\n        var nodes = this.jm.mind.nodes;\n        var node;\n        for (var nodeid in nodes) {\n            node = nodes[nodeid];\n            this._draw_node(node);\n        }\n\n        function check_nodes_ready() {\n            console.log('check_node_ready' + new Date());\n            var allOk = true;\n            for (var nodeid in nodes) {\n                node = nodes[nodeid];\n                allOk = allOk & node.ready;\n            }\n\n            if (!allOk) {\n                $.w.setTimeout(check_nodes_ready, 200);\n            } else {\n                $.w.setTimeout(callback, 200);\n            }\n        }\n        check_nodes_ready();\n    }\n    _draw_node(node) {\n        var ctx = this.canvas_ctx;\n        var view_data = node._data.view;\n        var node_element = view_data.element;\n        var ncs = getComputedStyle(node_element);\n        if (!is_visible(ncs)) {\n            node.ready = true;\n            return;\n        }\n\n        var bgcolor = css(ncs, 'background-color');\n        var round_radius = parseInt(css(ncs, 'border-top-left-radius'));\n        var color = css(ncs, 'color');\n        var padding_left = parseInt(css(ncs, 'padding-left'));\n        var padding_right = parseInt(css(ncs, 'padding-right'));\n        var padding_top = parseInt(css(ncs, 'padding-top'));\n        var padding_bottom = parseInt(css(ncs, 'padding-bottom'));\n        var text_overflow = css(ncs, 'text-overflow');\n        var font =\n            css(ncs, 'font-style') +\n            ' ' +\n            css(ncs, 'font-variant') +\n            ' ' +\n            css(ncs, 'font-weight') +\n            ' ' +\n            css(ncs, 'font-size') +\n            '/' +\n            css(ncs, 'line-height') +\n            ' ' +\n            css(ncs, 'font-family');\n\n        var rb = {\n            x: view_data.abs_x,\n            y: view_data.abs_y,\n            w: view_data.width + 1,\n            h: view_data.height + 1,\n        };\n        var tb = {\n            x: rb.x + padding_left,\n            y: rb.y + padding_top,\n            w: rb.w - padding_left - padding_right,\n            h: rb.h - padding_top - padding_bottom,\n        };\n\n        ctx.font = font;\n        ctx.fillStyle = bgcolor;\n        ctx.beginPath();\n        jcanvas.rect(ctx, rb.x, rb.y, rb.w, rb.h, round_radius);\n        ctx.closePath();\n        ctx.fill();\n\n        ctx.fillStyle = color;\n        if ('background-image' in node.data) {\n            var backgroundUrl = css(ncs, 'background-image').slice(5, -2);\n            node.ready = false;\n            var rotation = 0;\n            if ('background-rotation' in node.data) {\n                rotation = node.data['background-rotation'];\n            }\n            jcanvas.image(\n                ctx,\n                backgroundUrl,\n                rb.x,\n                rb.y,\n                rb.w,\n                rb.h,\n                round_radius,\n                rotation,\n                function () {\n                    node.ready = true;\n                }\n            );\n        }\n        if (!!node.topic) {\n            if (text_overflow === 'ellipsis') {\n                jcanvas.text_ellipsis(ctx, node.topic, tb.x, tb.y, tb.w, tb.h);\n            } else {\n                var line_height = parseInt(css(ncs, 'line-height'));\n                jcanvas.text_multiline(ctx, node.topic, tb.x, tb.y, tb.w, tb.h, line_height);\n            }\n        }\n        if (!!view_data.expander) {\n            this._draw_expander(view_data.expander);\n        }\n        if (!('background-image' in node.data)) {\n            node.ready = true;\n        }\n    }\n    _draw_expander(expander) {\n        var ctx = this.canvas_ctx;\n        var ncs = getComputedStyle(expander);\n        if (!is_visible(ncs)) {\n            return;\n        }\n\n        var style_left = css(ncs, 'left');\n        var style_top = css(ncs, 'top');\n        var font = css(ncs, 'font');\n        var left = parseInt(style_left);\n        var top = parseInt(style_top);\n        var is_plus = expander.innerHTML === '+';\n\n        ctx.lineWidth = 1;\n\n        ctx.beginPath();\n        ctx.arc(left + 7, top + 7, 5, 0, Math.PI * 2, true);\n        ctx.moveTo(left + 10, top + 7);\n        ctx.lineTo(left + 4, top + 7);\n        if (is_plus) {\n            ctx.moveTo(left + 7, top + 4);\n            ctx.lineTo(left + 7, top + 10);\n        }\n        ctx.closePath();\n        ctx.stroke();\n    }\n    _download() {\n        var c = this.canvas_elem;\n        var name = this.jm.mind.name + '.png';\n\n        if (navigator.msSaveBlob && !!c.msToBlob) {\n            var blob = c.msToBlob();\n            navigator.msSaveBlob(blob, name);\n        } else {\n            var bloburl = this.canvas_elem.toDataURL();\n            var anchor = $.c('a');\n            if ('download' in anchor) {\n                anchor.style.visibility = 'hidden';\n                anchor.href = bloburl;\n                anchor.download = name;\n                $.d.body.appendChild(anchor);\n                var evt = $.d.createEvent('MouseEvents');\n                evt.initEvent('click', true, true);\n                anchor.dispatchEvent(evt);\n                $.d.body.removeChild(anchor);\n            } else {\n                location.href = bloburl;\n            }\n        }\n    }\n    jm_event_handle(type, data) {\n        if (type === jsMind.event_type.resize) {\n            this.resize();\n        }\n    }\n}\n\nvar screenshot_plugin = new jsMind.plugin('screenshot', function (jm) {\n    var jss = new screenshot(jm);\n    jm.screenshot = jss;\n    jm.shoot = function () {\n        jss.shoot();\n    };\n    jm.add_event_listener(function (type, data) {\n        jss.jm_event_handle.call(jss, type, data);\n    });\n});\n\njsMind.register_plugin(screenshot_plugin);\n"],"names":["jsMind","Error","$","css","cStyle","property_name","getPropertyValue","is_visible","visibility","display","jcanvas","ctx","x","y","w","h","r","moveTo","arcTo","text","lineheight","line","text_len","length","chars","split","test_line","textAlign","textBaseline","i","measureText","width","fillText","center_y","fittingString","max_width","ellipsis_width","len","substring","url","rotation","callback","img","Image","onload","save","translate","beginPath","rect","closePath","clip","rotate","Math","PI","drawImage","restore","src","screenshot","constructor","jm","this","canvas_elem","canvas_ctx","_inited","init","console","log","c","getContext","view","e_panel","appendChild","resize","shoot","_draw","clean","bind","_watermark","shootDownload","_download","shootAsDataURL","toDataURL","size","height","clearRect","_draw_lines","_draw_nodes","fillStyle","font","location","graph","copy_to","node","nodes","mind","nodeid","_draw_node","check_nodes_ready","Date","allOk","ready","setTimeout","view_data","_data","node_element","element","ncs","getComputedStyle","bgcolor","round_radius","parseInt","color","padding_left","padding_right","padding_top","padding_bottom","text_overflow","rb","abs_x","abs_y","tb","fill","data","backgroundUrl","slice","image","topic","text_ellipsis","line_height","text_multiline","expander","_draw_expander","style_left","style_top","left","top","is_plus","innerHTML","lineWidth","arc","lineTo","stroke","name","navigator","msSaveBlob","msToBlob","blob","bloburl","anchor","style","href","download","d","body","evt","createEvent","initEvent","dispatchEvent","removeChild","jm_event_handle","type","event_type","screenshot_plugin","plugin","jss","add_event_listener","call","register_plugin"],"mappings":"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"}