{"version":3,"file":"jsmind.draggable.js","sources":["../src/plugins/jsmind.draggable.js"],"sourcesContent":["/**\r\n * @license BSD\r\n * @copyright 2014-2022 hizzgdev@163.com\r\n *\r\n * Project Home:\r\n *   https://github.com/hizzgdev/jsmind/\r\n */\r\n\r\nif (!jsMind) {\r\n    throw new Error('jsMind is not defined');\r\n}\r\n\r\nconst jm = jsMind;\r\nconst $ = jm.$;\r\n\r\nconst clear_selection =\r\n    'getSelection' in $.w\r\n        ? function () {\r\n              $.w.getSelection().removeAllRanges();\r\n          }\r\n        : function () {\r\n              $.d.selection.empty();\r\n          };\r\n\r\nconst options = {\r\n    line_width: 5,\r\n    lookup_delay: 500,\r\n    lookup_interval: 80,\r\n};\r\n\r\nclass draggable {\r\n    constructor(jm) {\r\n        this.jm = jm;\r\n        this.e_canvas = null;\r\n        this.canvas_ctx = null;\r\n        this.shadow = null;\r\n        this.shadow_w = 0;\r\n        this.shadow_h = 0;\r\n        this.active_node = null;\r\n        this.target_node = null;\r\n        this.target_direct = null;\r\n        this.client_w = 0;\r\n        this.client_h = 0;\r\n        this.offset_x = 0;\r\n        this.offset_y = 0;\r\n        this.hlookup_delay = 0;\r\n        this.hlookup_timer = 0;\r\n        this.capture = false;\r\n        this.moved = false;\r\n    }\r\n    init() {\r\n        this._create_canvas();\r\n        this._create_shadow();\r\n        this._event_bind();\r\n    }\r\n    resize() {\r\n        this.jm.view.e_nodes.appendChild(this.shadow);\r\n        this.e_canvas.width = this.jm.view.size.w;\r\n        this.e_canvas.height = this.jm.view.size.h;\r\n    }\r\n    _create_canvas() {\r\n        var c = $.c('canvas');\r\n        this.jm.view.e_panel.appendChild(c);\r\n        var ctx = c.getContext('2d');\r\n        this.e_canvas = c;\r\n        this.canvas_ctx = ctx;\r\n    }\r\n    _create_shadow() {\r\n        var s = $.c('jmnode');\r\n        s.style.visibility = 'hidden';\r\n        s.style.zIndex = '3';\r\n        s.style.cursor = 'move';\r\n        s.style.opacity = '0.7';\r\n        this.shadow = s;\r\n    }\r\n    reset_shadow(el) {\r\n        var s = this.shadow.style;\r\n        this.shadow.innerHTML = el.innerHTML;\r\n        s.left = el.style.left;\r\n        s.top = el.style.top;\r\n        s.width = el.style.width;\r\n        s.height = el.style.height;\r\n        s.backgroundImage = el.style.backgroundImage;\r\n        s.backgroundSize = el.style.backgroundSize;\r\n        s.transform = el.style.transform;\r\n        this.shadow_w = this.shadow.clientWidth;\r\n        this.shadow_h = this.shadow.clientHeight;\r\n    }\r\n    show_shadow() {\r\n        if (!this.moved) {\r\n            this.shadow.style.visibility = 'visible';\r\n        }\r\n    }\r\n    hide_shadow() {\r\n        this.shadow.style.visibility = 'hidden';\r\n    }\r\n    _magnet_shadow(node) {\r\n        if (!!node) {\r\n            this.canvas_ctx.lineWidth = options.line_width;\r\n            this.canvas_ctx.strokeStyle = 'rgba(0,0,0,0.3)';\r\n            this.canvas_ctx.lineCap = 'round';\r\n            this._clear_lines();\r\n            this._canvas_lineto(node.sp.x, node.sp.y, node.np.x, node.np.y);\r\n        }\r\n    }\r\n    _clear_lines() {\r\n        this.canvas_ctx.clearRect(0, 0, this.jm.view.size.w, this.jm.view.size.h);\r\n    }\r\n    _canvas_lineto(x1, y1, x2, y2) {\r\n        this.canvas_ctx.beginPath();\r\n        this.canvas_ctx.moveTo(x1, y1);\r\n        this.canvas_ctx.lineTo(x2, y2);\r\n        this.canvas_ctx.stroke();\r\n    }\r\n    _lookup_close_node() {\r\n        var root = this.jm.get_root();\r\n        var root_location = root.get_location();\r\n        var root_size = root.get_size();\r\n        var root_x = root_location.x + root_size.w / 2;\r\n\r\n        var sw = this.shadow_w;\r\n        var sh = this.shadow_h;\r\n        var sx = this.shadow.offsetLeft;\r\n        var sy = this.shadow.offsetTop;\r\n\r\n        var ns, nl;\r\n\r\n        var direct = sx + sw / 2 >= root_x ? jsMind.direction.right : jsMind.direction.left;\r\n        var nodes = this.jm.mind.nodes;\r\n        var node = null;\r\n        var layout = this.jm.layout;\r\n        var min_distance = Number.MAX_VALUE;\r\n        var distance = 0;\r\n        var closest_node = null;\r\n        var closest_p = null;\r\n        var shadow_p = null;\r\n        for (var nodeid in nodes) {\r\n            var np, sp;\r\n            node = nodes[nodeid];\r\n            if (node.isroot || node.direction == direct) {\r\n                if (node.id == this.active_node.id) {\r\n                    continue;\r\n                }\r\n                if (!layout.is_visible(node)) {\r\n                    continue;\r\n                }\r\n                ns = node.get_size();\r\n                nl = node.get_location();\r\n                if (direct == jsMind.direction.right) {\r\n                    if (sx - nl.x - ns.w <= 0) {\r\n                        continue;\r\n                    }\r\n                    distance = Math.abs(sx - nl.x - ns.w) + Math.abs(sy + sh / 2 - nl.y - ns.h / 2);\r\n                    np = { x: nl.x + ns.w - options.line_width, y: nl.y + ns.h / 2 };\r\n                    sp = { x: sx + options.line_width, y: sy + sh / 2 };\r\n                } else {\r\n                    if (nl.x - sx - sw <= 0) {\r\n                        continue;\r\n                    }\r\n                    distance = Math.abs(sx + sw - nl.x) + Math.abs(sy + sh / 2 - nl.y - ns.h / 2);\r\n                    np = { x: nl.x + options.line_width, y: nl.y + ns.h / 2 };\r\n                    sp = { x: sx + sw - options.line_width, y: sy + sh / 2 };\r\n                }\r\n                if (distance < min_distance) {\r\n                    closest_node = node;\r\n                    closest_p = np;\r\n                    shadow_p = sp;\r\n                    min_distance = distance;\r\n                }\r\n            }\r\n        }\r\n        var result_node = null;\r\n        if (!!closest_node) {\r\n            result_node = {\r\n                node: closest_node,\r\n                direction: direct,\r\n                sp: shadow_p,\r\n                np: closest_p,\r\n            };\r\n        }\r\n        return result_node;\r\n    }\r\n    lookup_close_node() {\r\n        var node_data = this._lookup_close_node();\r\n        if (!!node_data) {\r\n            this._magnet_shadow(node_data);\r\n            this.target_node = node_data.node;\r\n            this.target_direct = node_data.direction;\r\n        }\r\n    }\r\n    _event_bind() {\r\n        var jd = this;\r\n        var container = this.jm.view.container;\r\n        $.on(container, 'mousedown', function (e) {\r\n            var evt = e || event;\r\n            jd.dragstart.call(jd, evt);\r\n        });\r\n        $.on(container, 'mousemove', function (e) {\r\n            var evt = e || event;\r\n            jd.drag.call(jd, evt);\r\n        });\r\n        $.on(container, 'mouseup', function (e) {\r\n            var evt = e || event;\r\n            jd.dragend.call(jd, evt);\r\n        });\r\n        $.on(container, 'touchstart', function (e) {\r\n            var evt = e || event;\r\n            jd.dragstart.call(jd, evt);\r\n        });\r\n        $.on(container, 'touchmove', function (e) {\r\n            var evt = e || event;\r\n            jd.drag.call(jd, evt);\r\n        });\r\n        $.on(container, 'touchend', function (e) {\r\n            var evt = e || event;\r\n            jd.dragend.call(jd, evt);\r\n        });\r\n    }\r\n    dragstart(e) {\r\n        if (!this.jm.get_editable()) {\r\n            return;\r\n        }\r\n        if (this.capture) {\r\n            return;\r\n        }\r\n        this.active_node = null;\r\n\r\n        var jview = this.jm.view;\r\n        var el = e.target || event.srcElement;\r\n        if (el.tagName.toLowerCase() != 'jmnode') {\r\n            return;\r\n        }\r\n        var nodeid = jview.get_binded_nodeid(el);\r\n        if (!!nodeid) {\r\n            var node = this.jm.get_node(nodeid);\r\n            if (!node.isroot) {\r\n                this.reset_shadow(el);\r\n                this.active_node = node;\r\n                this.offset_x =\r\n                    (e.clientX || e.touches[0].clientX) / jview.actualZoom - el.offsetLeft;\r\n                this.offset_y =\r\n                    (e.clientY || e.touches[0].clientY) / jview.actualZoom - el.offsetTop;\r\n                this.client_hw = Math.floor(el.clientWidth / 2);\r\n                this.client_hh = Math.floor(el.clientHeight / 2);\r\n                if (this.hlookup_delay != 0) {\r\n                    $.w.clearTimeout(this.hlookup_delay);\r\n                }\r\n                if (this.hlookup_timer != 0) {\r\n                    $.w.clearInterval(this.hlookup_timer);\r\n                }\r\n                var jd = this;\r\n                this.hlookup_delay = $.w.setTimeout(function () {\r\n                    jd.hlookup_delay = 0;\r\n                    jd.hlookup_timer = $.w.setInterval(function () {\r\n                        jd.lookup_close_node.call(jd);\r\n                    }, options.lookup_interval);\r\n                }, options.lookup_delay);\r\n                this.capture = true;\r\n            }\r\n        }\r\n    }\r\n    drag(e) {\r\n        if (!this.jm.get_editable()) {\r\n            return;\r\n        }\r\n        if (this.capture) {\r\n            e.preventDefault();\r\n            this.show_shadow();\r\n            this.moved = true;\r\n            clear_selection();\r\n            var jview = this.jm.view;\r\n            var px = (e.clientX || e.touches[0].clientX) / jview.actualZoom - this.offset_x;\r\n            var py = (e.clientY || e.touches[0].clientY) / jview.actualZoom - this.offset_y;\r\n            this.shadow.style.left = px + 'px';\r\n            this.shadow.style.top = py + 'px';\r\n            clear_selection();\r\n        }\r\n    }\r\n    dragend(e) {\r\n        if (!this.jm.get_editable()) {\r\n            return;\r\n        }\r\n        if (this.capture) {\r\n            if (this.hlookup_delay != 0) {\r\n                $.w.clearTimeout(this.hlookup_delay);\r\n                this.hlookup_delay = 0;\r\n                this._clear_lines();\r\n            }\r\n            if (this.hlookup_timer != 0) {\r\n                $.w.clearInterval(this.hlookup_timer);\r\n                this.hlookup_timer = 0;\r\n                this._clear_lines();\r\n            }\r\n            if (this.moved) {\r\n                var src_node = this.active_node;\r\n                var target_node = this.target_node;\r\n                var target_direct = this.target_direct;\r\n                this.move_node(src_node, target_node, target_direct);\r\n            }\r\n            this.hide_shadow();\r\n        }\r\n        this.moved = false;\r\n        this.capture = false;\r\n    }\r\n    move_node(src_node, target_node, target_direct) {\r\n        var shadow_h = this.shadow.offsetTop;\r\n        if (!!target_node && !!src_node && !jsMind.node.inherited(src_node, target_node)) {\r\n            // lookup before_node\r\n            var sibling_nodes = target_node.children;\r\n            var sc = sibling_nodes.length;\r\n            var node = null;\r\n            var delta_y = Number.MAX_VALUE;\r\n            var node_before = null;\r\n            var beforeid = '_last_';\r\n            while (sc--) {\r\n                node = sibling_nodes[sc];\r\n                if (node.direction == target_direct && node.id != src_node.id) {\r\n                    var dy = node.get_location().y - shadow_h;\r\n                    if (dy > 0 && dy < delta_y) {\r\n                        delta_y = dy;\r\n                        node_before = node;\r\n                        beforeid = '_first_';\r\n                    }\r\n                }\r\n            }\r\n            if (!!node_before) {\r\n                beforeid = node_before.id;\r\n            }\r\n            this.jm.move_node(src_node.id, beforeid, target_node.id, target_direct);\r\n        }\r\n        this.active_node = null;\r\n        this.target_node = null;\r\n        this.target_direct = null;\r\n    }\r\n    jm_event_handle(type, data) {\r\n        if (type === jsMind.event_type.resize) {\r\n            this.resize();\r\n        }\r\n    }\r\n}\r\n\r\nvar draggable_plugin = new jm.plugin('draggable', function (jm) {\r\n    var jd = new draggable(jm);\r\n    jd.init();\r\n    jm.add_event_listener(function (type, data) {\r\n        jd.jm_event_handle.call(jd, type, data);\r\n    });\r\n});\r\n\r\njsMind.register_plugin(draggable_plugin);\r\n"],"names":["jsMind","Error","jm","$","clear_selection","w","getSelection","removeAllRanges","d","selection","empty","options","draggable","constructor","this","e_canvas","canvas_ctx","shadow","shadow_w","shadow_h","active_node","target_node","target_direct","client_w","client_h","offset_x","offset_y","hlookup_delay","hlookup_timer","capture","moved","init","_create_canvas","_create_shadow","_event_bind","resize","view","e_nodes","appendChild","width","size","height","h","c","e_panel","ctx","getContext","s","style","visibility","zIndex","cursor","opacity","reset_shadow","el","innerHTML","left","top","backgroundImage","backgroundSize","transform","clientWidth","clientHeight","show_shadow","hide_shadow","_magnet_shadow","node","lineWidth","strokeStyle","lineCap","_clear_lines","_canvas_lineto","sp","x","y","np","clearRect","x1","y1","x2","y2","beginPath","moveTo","lineTo","stroke","_lookup_close_node","ns","nl","root","get_root","root_location","get_location","root_size","get_size","root_x","sw","sh","sx","offsetLeft","sy","offsetTop","direct","direction","right","nodes","mind","layout","min_distance","Number","MAX_VALUE","distance","closest_node","closest_p","shadow_p","nodeid","isroot","id","is_visible","Math","abs","result_node","lookup_close_node","node_data","jd","container","on","e","evt","event","dragstart","call","drag","dragend","get_editable","jview","target","srcElement","tagName","toLowerCase","get_binded_nodeid","get_node","clientX","touches","actualZoom","clientY","client_hw","floor","client_hh","clearTimeout","clearInterval","setTimeout","setInterval","preventDefault","px","py","src_node","move_node","inherited","sibling_nodes","children","sc","length","delta_y","node_before","beforeid","dy","jm_event_handle","type","data","event_type","draggable_plugin","plugin","add_event_listener","register_plugin"],"mappings":"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"}